\vspace{1ex}

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\epsilon & = & \epsilon \\
w & = & w \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\bigoplus}\, \epsilon & = & \epsilon \\
{\bigoplus}\, ({w^\ast})~{({{w'}^\ast})^\ast} & = & {w^\ast} \oplus {\bigoplus}\, {({{w'}^\ast})^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\{~K}{^* \}} & ::= & {\{~{K^\ast}}{\}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\epsilon~{\mathrm{distinct}} & = & \mathsf{true} \\
w~{{w'}^\ast}~{\mathrm{distinct}} & = & {\neg(w \in {{w'}^\ast})} \land {{w'}^\ast}~{\mathrm{distinct}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\epsilon \setminus {w^\ast} & = & \epsilon \\
w_1~{{w'}^\ast} \setminus {w^\ast} & = & {{\mathrm{setminus{\kern-0.1em\scriptstyle 1}}}}_{X}(w_1, {w^\ast}) \oplus {{w'}^\ast} \setminus {w^\ast} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathrm{setminus{\kern-0.1em\scriptstyle 1}}}}_{X}(w, \epsilon) & = & w \\
{{\mathrm{setminus{\kern-0.1em\scriptstyle 1}}}}_{X}(w, w_1~{{w'}^\ast}) & = & \epsilon & \quad \mbox{if}~ w = w_1 \\
{{\mathrm{setminus{\kern-0.1em\scriptstyle 1}}}}_{X}(w, w_1~{{w'}^\ast}) & = & {{\mathrm{setminus{\kern-0.1em\scriptstyle 1}}}}_{X}(w, {{w'}^\ast}) & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\Large\times~\epsilon & = & (\epsilon) \\
\Large\times~({w_1^\ast})~{({w^\ast})^\ast} & = & {{\mathrm{setproduct{\kern-0.1em\scriptstyle 1}}}}_{X}({w_1^\ast}, \Large\times~{({w^\ast})^\ast}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathrm{setproduct{\kern-0.1em\scriptstyle 1}}}}_{X}(\epsilon, {({w^\ast})^\ast}) & = & \epsilon \\
{{\mathrm{setproduct{\kern-0.1em\scriptstyle 1}}}}_{X}(w_1~{{w'}^\ast}, {({w^\ast})^\ast}) & = & {{\mathrm{setproduct{\kern-0.1em\scriptstyle 2}}}}_{X}(w_1, {({w^\ast})^\ast}) \oplus {{\mathrm{setproduct{\kern-0.1em\scriptstyle 1}}}}_{X}({{w'}^\ast}, {({w^\ast})^\ast}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathrm{setproduct{\kern-0.1em\scriptstyle 2}}}}_{X}(w_1, \epsilon) & = & \epsilon \\
{{\mathrm{setproduct{\kern-0.1em\scriptstyle 2}}}}_{X}(w_1, ({{w'}^\ast})~{({w^\ast})^\ast}) & = & (w_1~{{w'}^\ast}) \oplus {{\mathrm{setproduct{\kern-0.1em\scriptstyle 2}}}}_{X}(w_1, {({w^\ast})^\ast}) \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& (K~\mapsto~V) & ::= & K~\mapsto~V \\
& {{\{(}{K}~\mapsto~V}{)^*\}} & ::= & {\{}{{(K~\mapsto~V)^\ast}}{\}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\{~\} & = & {\{}{\epsilon}{\}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{bits}} & ::= & \dots ~|~ {-2} ~|~ {-1} ~|~ 0 ~|~ 1 ~|~ 2 ~|~ \dots \\
& {\mathit{width}} & ::= & 0 ~|~ 1 ~|~ 2 ~|~ \dots \\
& {\mathit{num}} & ::= & \mathbb{Z} \\
& & | & {{\mathit{width}}}{\mathsf{s}}{{\mathit{bits}}} \\
& & | & {{\mathit{width}}}{\mathsf{w}}{{\mathit{bits}}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{id}} & ::= & \mathbb{T} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{name}} & ::= & {{.}}\, {\mathit{id}} \\
& & | & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{member}} & ::= & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{matchkind}} & ::= & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{statelabel}} & ::= & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{unop}} & ::= & \sim \\
& & | & ! \\
& & | & + \\
& & | & - \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{binop}} & ::= & + \\
& & | & {|}{+}{|} \\
& & | & - \\
& & | & {|}{-}{|} \\
& & | & * \\
& & | & / \\
& & | & \% \\
& & | & <\!< \\
& & | & >\!> \\
& & | & \leq \\
& & | & \geq \\
& & | & < \\
& & | & > \\
& & | & == \\
& & | & !\!= \\
& & | & \& \\
& & | & \wedge \\
& & | & | \\
& & | & ++ \\
& & | & \&\& \\
& & | & || \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{dir}} & ::= & \mathsf{no} ~|~ \mathsf{in} ~|~ \mathsf{out} ~|~ \mathsf{inout} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{type}} & ::= & \mathsf{void} \\
& & | & \mathsf{error} \\
& & | & \mathsf{match\_kind} \\
& & | & \mathsf{string} \\
& & | & \mathsf{bool} \\
& & | & \mathsf{int} \\
& & | & {\mathsf{int}}{\langle}{{\mathit{expr}}}{\rangle} \\
& & | & {\mathsf{bit}}{\langle}{{\mathit{expr}}}{\rangle} \\
& & | & {\mathsf{varbit}}{\langle}{{\mathit{expr}}}{\rangle} \\
& & | & {{\mathit{type}}}{{}[ {\mathit{expr}} ]} \\
& & | & {\mathsf{list}}{\langle}{{\mathit{type}}}{\rangle} \\
& & | & {\mathsf{tuple}}{\langle}{{{\mathit{type}}^\ast}}{\rangle} \\
& & | & {\mathit{name}} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{type}}^\ast}}{\rangle} \\
& & | & \mathsf{\_} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tparam}} & ::= & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{param}} & ::= & {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~{{\mathit{expr}}^?} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{cparam}} & ::= & {\mathit{param}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{targ}} & ::= & {\mathit{type}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{arg}} & ::= & {\mathit{expr}} \\
& & | & {\mathit{id}} = {{\mathit{expr}}^?} \\
& & | & \mathsf{\_} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{keyset}} & ::= & {\mathit{expr}} \\
& & | & \mathsf{default} \\
& & | & \mathsf{\_} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{selectcase}} & ::= & {{\mathit{keyset}}^\ast}~{\mathit{statelabel}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{expr}} & ::= & \mathbb{B} \\
& & | & \mathbb{T} \\
& & | & {\mathit{num}} \\
& & | & {\mathit{name}} \\
& & | & {\{}{{{\mathit{expr}}^\ast}}{\}} \\
& & | & {\{}{{{\mathit{expr}}^\ast}}, {\ldots}\, \} \\
& & | & {\{}{{({\mathit{member}}, {\mathit{expr}})^\ast}}{\}} \\
& & | & {\{}{{({\mathit{member}}, {\mathit{expr}})^\ast}}, {\ldots}\, \} \\
& & | & {\ldots}\,  \\
& & | & \mathsf{invalid} \\
& & | & {{\mathit{unop}}}{{\mathit{expr}}} \\
& & | & {\mathit{expr}}~{\mathit{binop}}~{\mathit{expr}} \\
& & | & ({\mathit{expr}}~?~{\mathit{expr}}~:~{\mathit{expr}}) \\
& & | & ({\mathit{type}})~{\mathit{expr}} \\
& & | & {\mathit{expr}}~\&\&\&~{\mathit{expr}} \\
& & | & {\mathit{expr}} \ldots {\mathit{expr}} \\
& & | & {\mathsf{select}~({{\mathit{expr}}^\ast})~\{}{{{\mathit{selectcase}}^\ast}}{\}} \\
& & | & {\mathit{expr}}~{}[ {\mathit{expr}} ] \\
& & | & {\mathit{expr}}~{}[ {\mathit{expr}}~:~{\mathit{expr}} ] \\
& & | & \mathsf{error} {.} {\mathit{member}} \\
& & | & {\mathit{name}} {.} {\mathit{member}} \\
& & | & {\mathit{expr}} {.} {\mathit{member}} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{({{\mathit{arg}}^\ast})}{} \\
& & | & {{\mathit{expr}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle} {.} {{\mathit{member}}}{({{\mathit{arg}}^\ast})}{} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle} {.} {{\mathit{member}}}{({{\mathit{arg}}^\ast})}{} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{({{\mathit{arg}}^\ast})}{} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{block}} & ::= & {\{}{{{\mathit{stmt}}^\ast}}{\}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{stmt}} & ::= & \mathsf{empty} \\
& & | & {\mathit{expr}} = {\mathit{expr}} \\
& & | & {\mathsf{switch}~({\mathit{expr}})~\{}{{{\mathit{switchcase}}^\ast}}{\}} \\
& & | & \mathsf{if}~({\mathit{expr}})~\mathsf{then}~{\mathit{stmt}}~\mathsf{else}~{\mathit{stmt}} \\
& & | & {\mathit{block}} \\
& & | & \mathsf{exit} \\
& & | & \mathsf{return}~{{\mathit{expr}}^?} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}{} \\
& & | & {{\mathit{expr}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle} {.} {{\mathit{member}}}{({{\mathit{arg}}^\ast})}{} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle{.}\mathsf{apply}}{({{\mathit{arg}}^\ast})}{} \\
& & | & \mathsf{transition}~{\mathit{expr}} \\
& & | & {\mathit{decl}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{switchlabel}} & ::= & {\mathit{expr}} \\
& & | & \mathsf{default} \\
& {\mathit{switchcase}} & ::= & \mathsf{case}~{\mathit{switchlabel}}~{\mathit{block}} \\
& & | & \mathsf{case}~{\mathit{switchlabel}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{parserstate}} & ::= & {\mathit{statelabel}}~{\mathit{block}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tbl}} & ::= & {{\mathit{tblprop}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblkey}} & ::= & {\mathit{expr}}~{\mathit{matchkind}} \\
& {\mathit{tblkeyprop}} & ::= & {{\mathit{tblkey}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblaction}} & ::= & {\mathit{name}}~{{\mathit{arg}}^\ast} \\
& {\mathit{tblactionprop}} & ::= & {{\mathit{tblaction}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblentry}} & ::= & \mathbb{B}~{{\mathit{keyset}}^\ast}~{\mathit{tblaction}}~{{\mathit{expr}}^?} \\
& {\mathit{tblentryprop}} & ::= & \mathbb{B}~{{\mathit{tblentry}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tbldefaultprop}} & ::= & \mathbb{B}~{\mathit{tblaction}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblcustomprop}} & ::= & \mathbb{B}~{\mathit{member}}~{\mathit{expr}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblprop}} & ::= & {\mathsf{keys}~\{}{{\mathit{tblkeyprop}}}{\}} \\
& & | & {\mathsf{actions}~\{}{{\mathit{tblactionprop}}}{\}} \\
& & | & {\mathsf{entries}~\{}{{\mathit{tblentryprop}}}{\}} \\
& & | & {{\mathsf{default}}{\mathsf{\_}}{\mathsf{action}}~\{}{{\mathit{tbldefaultprop}}}{\}} \\
& & | & {\mathsf{custom}~\{}{{\mathit{tblcustomprop}}}{\}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{method}} & ::= & {\mathit{id}}~({{\mathit{cparam}}^\ast}) \\
& & | & {\mathsf{abstract}~{\mathit{type}}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} \\
& & | & {{\mathit{type}}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{decl}} & ::= & \mathsf{const}~{\mathit{type}}~{\mathit{id}} = {\mathit{expr}} \\
& & | & {\mathit{type}}~{\mathit{id}} = {{\mathit{expr}}^?} \\
& & | & {\mathsf{error}~\{}{{{\mathit{member}}^\ast}}{\}} \\
& & | & {{\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}~\{}{{{\mathit{member}}^\ast}}{\}} \\
& & | & {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}~{\mathit{id}} = {\{}{{{\mathit{decl}}^\ast}}{\}} \\
& & | & {{\mathsf{struct}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{({\mathit{member}}, {\mathit{type}})^\ast}}{\}} \\
& & | & {{\mathsf{header}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{({\mathit{member}}, {\mathit{type}})^\ast}}{\}} \\
& & | & {{\mathsf{union}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{({\mathit{member}}, {\mathit{type}})^\ast}}{\}} \\
& & | & {\mathsf{enum}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}} \\
& & | & {\mathsf{enum}~{\mathit{id}}~{\mathit{type}}~\{}{{({\mathit{member}}, {\mathit{expr}})^\ast}}{\}} \\
& & | & \mathsf{type}~{\mathit{id}}~{\mathit{type}} \\
& & | & \mathsf{typedef}~{\mathit{id}}~{\mathit{type}} \\
& & | & {\mathsf{value}}{\mathsf{\_}}{\mathsf{set}}{\langle}{{\mathit{type}}}{\rangle}{({\mathit{expr}})}{}~{\mathit{id}} \\
& & | & {\mathsf{parser}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} \\
& & | & {{\mathsf{parser}~{\mathit{id}}}{({{\mathit{param}}^\ast})}{({{\mathit{cparam}}^\ast})}{}~\{}{{{\mathit{decl}}^\ast}~{{\mathit{parserstate}}^\ast}}{\}} \\
& & | & {\mathsf{table}~{\mathit{id}}~\{}{{\mathit{tbl}}}{\}} \\
& & | & {\mathsf{control}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} \\
& & | & {{{\mathsf{control}~{\mathit{id}}}{({{\mathit{param}}^\ast})}{({{\mathit{cparam}}^\ast})}{}~\{}{{{\mathit{decl}}^\ast}}~\mathsf{apply}~{\mathit{block}}}{\}} \\
& & | & \mathsf{action}~{\mathit{id}}~({{\mathit{param}}^\ast})~{\mathit{block}} \\
& & | & {{\mathit{type}}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{}~{\mathit{block}} \\
& & | & {\mathsf{extern}~{\mathit{type}}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} \\
& & | & {{\mathsf{extern}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{{\mathit{method}}^\ast}}{\}} \\
& & | & {\mathsf{package}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{cparam}}^\ast})}{} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{program}} & ::= & {{\mathit{decl}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathit{name}} & = & \mbox{\texttt{`.'}}~{\mathit{id}} & \quad \mbox{if}~ {{.}}\, {\mathit{id}} = {\mathit{name}} \\
{\mathit{name}} & = & {\mathit{id}} & \quad \mbox{if}~ {\mathit{id}} = {\mathit{name}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tid}} & ::= & {\mathit{id}} \\
& \mathcal{B} & ::= & {\{~{\mathit{tid}}}{^* \}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{fid}} & ::= & {\mathit{id}}~{({\mathit{id}}, \mathbb{B})^\ast} \\
& {\mathit{cid}} & ::= & {\mathit{fid}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast}) & = & {\mathit{id}}~{\mathrm{to}}_{\mathit{fid}'}({{\mathit{param}}^\ast}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{to}}_{\mathit{fid}'}(\epsilon) & = & \epsilon \\
{\mathrm{to}}_{\mathit{fid}'}({\mathit{param}}_h~{{\mathit{param}}_t^\ast}) & = & t~{\mathrm{to}}_{\mathit{fid}'}({{\mathit{param}}_t^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~{\mathit{expr}} = {\mathit{param}}_h \\
{\land}~ t = ({\mathit{id}}, \mathsf{true}) \\
\end{array} \\
{\mathrm{to}}_{\mathit{fid}'}({\mathit{param}}_h~{{\mathit{param}}_t^\ast}) & = & t~{\mathrm{to}}_{\mathit{fid}'}({{\mathit{param}}_t^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~\epsilon = {\mathit{param}}_h \\
{\land}~ t = ({\mathit{id}}, \mathsf{false}) \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{to}}_{\mathit{cid}}({\mathit{id}}, {{\mathit{param}}^\ast}) & = & {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast}) \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{oid}} & ::= & {{\mathit{id}}^\ast} \\
& {\mathit{bitstr}} & ::= & \dots ~|~ {-2} ~|~ {-1} ~|~ 0 ~|~ 1 ~|~ 2 ~|~ \dots \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{val}} & ::= & {\mathsf{err}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{member}} \\
& & | & {\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{member}} \\
& & | & {\mathsf{str}}{\mathsf{\_}}{\mathsf{v}}~\mathbb{T} \\
& & | & {\mathsf{bool}}{\mathsf{\_}}{\mathsf{v}}~\mathbb{B} \\
& & | & {\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~\mathbb{Z} \\
& & | & {{\mathsf{fint}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{width}}}{\mathsf{s}}{{\mathit{bitstr}}} \\
& & | & {{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{width}}}{\mathsf{w}}{{\mathit{bitstr}}} \\
& & | & \mathsf{vbitv}~{\mathit{width}}~{\mathit{width}}~{\mathit{bitstr}} \\
& & | & {\mathsf{enum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}} {.} {\mathit{member}} \\
& & | & {\mathsf{senum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}} {.} {\mathit{member}}~({\mathit{val}}) \\
& & | & {\mathsf{list}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast} \\
& & | & {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast} \\
& & | & {\mathsf{stack}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast}~{}[ \mathbb{Z}~@~\mathbb{Z} ] \\
& & | & {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {{\mathsf{header}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {{\mathsf{union}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {\mathsf{ref}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{oid}} \\
& & | & {\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}} {.} {\mathit{member}} \\
& & | & {{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {\mathsf{seq}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast} \\
& & | & {\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast} \\
& & | & {{\mathsf{record}}{\mathsf{\_}}{\mathsf{v}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{v}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {\mathsf{default}}{\mathsf{\_}}{\mathsf{v}} \\
& & | & {\mathsf{invalid}}{\mathsf{\_}}{\mathsf{v}} \\
& & | & {\mathsf{set}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{setval}} \\
& {\mathit{setval}} & ::= & \{~{\mathit{val}}~\} \\
& & | & \{~{\mathit{val}}~\&\&\&~{\mathit{val}}~\} \\
& & | & \{~{\mathit{val}} \ldots {\mathit{val}}~\} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{get}}_{\mathit{num}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~i) & = & i \\
{\mathrm{get}}_{\mathit{num}}({{\mathsf{fint}}{\mathsf{\_}}{\mathsf{v}}~w}{\mathsf{s}}{{\mathit{bs}}}) & = & {\mathrm{to}}_{{\mathit{two}}_{\mathit{complement}}}(w, {\mathit{bs}}) \\
{\mathrm{get}}_{\mathit{num}}({{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{v}}~w}{\mathsf{w}}{{\mathit{bs}}}) & = & {\mathit{bs}} \\
{\mathrm{get}}_{\mathit{num}}(\mathsf{vbitv}~w_{\mathit{max}}~w~{\mathit{bs}}) & = & {\mathit{bs}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{param} & ::= & {\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{prim} & ::= & {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{err}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{str}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}} \\
& \tau_\texttt{num} & ::= & {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{{\mathit{width}}}{\rangle} \\
& & | & {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{{\mathit{width}}}{\rangle} \\
& & | & {\mathsf{vbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{{\mathit{width}}}{\rangle} \\
& \tau_\texttt{base} & ::= & \tau_\texttt{prim} ~|~ \tau_\texttt{num} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{abs} & ::= & {\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}} \\
& & | & {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~\delta_\texttt{polytyp}}{\langle}{{\tau^\ast}}{\rangle} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{alias} & ::= & {\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~\tau \\
& \tau_\texttt{data} & ::= & {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau \\
& & | & {{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}} \\
& & | & {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}} \\
& & | & {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~\tau \\
& & | & {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast} \\
& & | & {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~\tau}{{}[ \mathbb{Z} ]} \\
& & | & {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}} \\
& & | & {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}} \\
& & | & {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}} \\
& \tau_\texttt{obj} & ::= & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{{\{(}{{\mathit{fid}}}~\mapsto~\delta_\texttt{func}}{)^*\}} \\
& & | & {\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \\
& & | & {\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \\
& & | & {\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast} \\
& & | & {\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}} \\
& \tau_\texttt{def} & ::= & \tau_\texttt{alias} ~|~ \tau_\texttt{data} ~|~ \tau_\texttt{obj} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{synth} & ::= & {\mathsf{default}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast} \\
& & | & {\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast} \\
& & | & {{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}} \\
& & | & {{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}} \\
& & | & {\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau \\
& & | & {\mathsf{state}}{\mathsf{\_}}{\mathsf{t}} \\
& & | & {{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}} \\
& & | & {{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}} \\
& & | & {\mathsf{any}}{\mathsf{\_}}{\mathsf{t}} \\
& \tau & ::= & \tau_\texttt{base} ~|~ \tau_\texttt{abs} ~|~ \tau_\texttt{def} ~|~ \tau_\texttt{synth} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \delta_\texttt{monotyp} & ::= & \mathsf{monod}~\tau \\
& \delta_\texttt{polytyp} & ::= & \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}^\ast}) \rightarrow \tau \\
& \delta_\texttt{typ} & ::= & \delta_\texttt{monotyp} \\
& & | & \delta_\texttt{polytyp} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{f} & ::= & {\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \\
& & | & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau \\
& & | & {\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau \\
& & | & {\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau \\
& & | & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau \\
& & | & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau \\
& & | & {\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \\
& & | & {\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \\
& & | & {\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~\tau \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \delta_\texttt{monofunc} & ::= & {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~\tau_\texttt{f} \\
& \delta_\texttt{polyfunc} & ::= & \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}^\ast}) \rightarrow \tau_\texttt{f} \\
& \delta_\texttt{func} & ::= & \delta_\texttt{monofunc} \\
& & | & \delta_\texttt{polyfunc} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \tau_\texttt{cons} & ::= & {\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \delta_\texttt{cons} & ::= & \mathsf{consd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}^\ast}) \rightarrow \tau_\texttt{cons} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{styp}} & ::= & \tau~{\mathit{dir}}~{\mathit{ctk}}~{{\mathit{val}}^?} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \theta & ::= & {{\{(}{{\mathit{id}}}~\mapsto~\tau}{)^*\}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}}{/}{\theta} & = & {\theta}{{}[ {\mathit{id}} ]} & \quad \mbox{if}~ {\mathit{id}}~\in~{\texttt{Dom}(}{\theta}{)} \\
{{{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{{\tau^\ast}}{\rangle}}{/}{\theta} & = & {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}'}}{\langle}{{{\tau'}^\ast}}{\rangle} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\delta_\texttt{polytyp}'} = {{\delta_\texttt{polytyp}}}{/}{\theta} \\
{\land}~ {{\tau'}^\ast} = {({\tau}{/}{\theta})^\ast} \\
\end{array} \\
{{\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~\tau}{/}{\theta} & = & {\tau}{/}{\theta} \\
{{\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau}{/}{\theta} & = & {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~({\tau}{/}{\theta}) \\
{{{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{\mathit{fields}}}{\}}}{/}{\theta} & = & {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~({\tau}{/}{\theta})~\{}{{\mathit{fields}}}{\}} \\
{{\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~\tau}{/}{\theta} & = & {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~({\tau}{/}{\theta}) \\
{{\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}}{/}{\theta} & = & {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{({\tau}{/}{\theta})^\ast} \\
{{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~\tau}{{}[ \mathbb{Z} ]}}{/}{\theta} & = & {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~({\tau}{/}{\theta})}{{}[ \mathbb{Z} ]} \\
{{{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}}{/}{\theta} & = & {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau}{/}{\theta})^\ast}}{\}} \\
{{{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}}{/}{\theta} & = & {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau}{/}{\theta})^\ast}}{\}} \\
{{{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}}{/}{\theta} & = & {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau}{/}{\theta})^\ast}}{\}} \\
{{\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}}}{/}{\theta} & = & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\{}{{({\mathit{fid}}~\mapsto~\delta_\texttt{func})^\ast}}{\}} = {\mathit{fmap}} \\
{\land}~ {\mathit{fmap}'} = {\{}{{({\mathit{fid}}~\mapsto~{\delta_\texttt{func}}{/}{\theta})^\ast}}{\}} \\
\end{array} \\
{{\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})}{/}{\theta} & = & {\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{\mathit{val}})^\ast} \\
\end{array} \\
{{\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})}{/}{\theta} & = & {\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{\mathit{val}})^\ast} \\
\end{array} \\
{{\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}}{/}{\theta} & = & {\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{({\tau}{/}{\theta})^\ast} \\
{{\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}}{/}{\theta} & = & {\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}} \\
{{{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}}{/}{\theta} & = & {{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau}{/}{\theta})^\ast}}{\}} \\
{{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}}{/}{\theta} & = & {\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{({\tau}{/}{\theta})^\ast} \\
{{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}}{/}{\theta} & = & {\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{({\tau}{/}{\theta})^\ast} \\
{{{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}}{/}{\theta} & = & {{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, {\tau}{/}{\theta})^\ast}}{\}} \\
{{{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}}{/}{\theta} & = & {{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, {\tau}{/}{\theta})^\ast}}{\}} \\
{{\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau}{/}{\theta} & = & {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~({\tau}{/}{\theta}) \\
{\tau}{/}{\theta} & = & \tau & \quad \mbox{otherwise} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau}{/}{\theta} & = & \mathsf{polyd}~({{\mathit{tparam}''}^\ast}, {{\mathit{tparam}''}_{\mathit{hidden}}^\ast}) \rightarrow {\tau'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\{~{{\mathit{tid}}_{\mathit{free}}^\ast}}{\}} = {FV(}{\tau}{)}~\setminus~{\{~({{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast})}{\}} \\
{\land}~ {\mathcal{B}}_{\mathit{capture}} = \bigcup~{({FV(}{{\theta}{{}[ {\mathit{tid}}_{\mathit{free}} ]}}{)})^\ast} \\[0.8ex]
{\land}~ (({\mathit{tparam}'} = {\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast \\
{\land}~ {|{{\mathit{tparam}'}^\ast}|} = {|{{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}|} \\
{\land}~ (({\mathit{tparam}'}~\notin~{\mathcal{B}}_{\mathit{capture}}))^\ast \\[0.8ex]
{\land}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}''}^\ast}~{{\mathit{tparam}''}_{\mathit{hidden}}^\ast} \\[0.8ex]
{\land}~ {\theta'} = {\theta}{\{}~{{\mathit{tparam}}^\ast}~\mapsto~{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}''})^\ast}~\} \\
{\land}~ {\theta''} = {{\theta'}}{\{}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}~\mapsto~{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}''}_{\mathit{hidden}})^\ast}~\} \\[0.8ex]
{\land}~ {\tau'} = {\tau}{/}{{\theta''}} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}}}{/}{\theta} & = & {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~({{\tau_\texttt{f}}}{/}{\theta}) \\
{\mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}}}{/}{\theta} & = & \mathsf{polyfd}~({{\mathit{tparam}''}^\ast}, {{\mathit{tparam}''}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\{~{{\mathit{tid}}_{\mathit{free}}^\ast}}{\}} = {FV(}{{\tau_\texttt{f}}}{)}~\setminus~{\{~({{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast})}{\}} \\
{\land}~ {\mathcal{B}}_{\mathit{capture}} = \bigcup~{({FV(}{{\theta}{{}[ {\mathit{tid}}_{\mathit{free}} ]}}{)})^\ast} \\[0.8ex]
{\land}~ (({\mathit{tparam}'} = {\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast \\
{\land}~ {|{{\mathit{tparam}'}^\ast}|} = {|{{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}|} \\
{\land}~ (({\mathit{tparam}'}~\notin~{\mathcal{B}}_{\mathit{capture}}))^\ast \\[0.8ex]
{\land}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}''}^\ast}~{{\mathit{tparam}''}_{\mathit{hidden}}^\ast} \\[0.8ex]
{\land}~ {\theta'} = {\theta}{\{}~{{\mathit{tparam}}^\ast}~\mapsto~{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}'})^\ast}~\} \\
{\land}~ {\theta''} = {{\theta'}}{\{}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}~\mapsto~{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}''}_{\mathit{hidden}})^\ast}~\} \\[0.8ex]
{\land}~ {\tau_\texttt{f}'} = {{\tau_\texttt{f}}}{/}{{\theta''}} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau}{/}{\theta} & = & {\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) \rightarrow ({\tau}{/}{\theta}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})}{/}{\theta} & = & {\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})}{/}{\theta} & = & {\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})}{/}{\theta} & = & {\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~\tau}{/}{\theta} & = & {\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau}{/}{\theta}) \\
{{\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau}{/}{\theta} & = & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) \rightarrow ({\tau}{/}{\theta}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau}{/}{\theta} & = & {\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) \rightarrow ({\tau}{/}{\theta}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau}{/}{\theta} & = & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) \rightarrow ({\tau}{/}{\theta}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
{{\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau}{/}{\theta} & = & {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) \rightarrow ({\tau}{/}{\theta}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau}{/}{\theta} & = & {\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) \rightarrow {\tau'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {{\tau_\texttt{param}'}^\ast} = {({\mathit{id}}~{\mathit{dir}}~({\tau}{/}{\theta})~{{\mathit{val}}^?})^\ast} \\[0.8ex]
{\land}~ {\tau'} = {\tau}{/}{\theta} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{monod}~\tau}{\langle}{\epsilon}{\rangle} & = & \tau \\
{\mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & {\tau}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~{\tau}_a)^\ast}}{\}}} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\mathit{tparam}'}^\ast}|} = {|{{\tau}_a^\ast}|} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}}}{\langle}{\epsilon}{\rangle} & = & ({\tau_\texttt{f}}, \epsilon) \\
{\mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}}}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & ({{\tau_\texttt{f}}}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~{\tau}_a)^\ast}}{\}}}, \epsilon) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\mathit{tparam}'}^\ast}|} = {|{{\tau}_a^\ast}|} \\
\end{array} \\
{\mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}}}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & ({{\tau_\texttt{f}}}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}_{\mathit{fresh}}))^\ast}}{\}}}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\tau}_a^\ast}|} = 0 \land {|{{\mathit{tparam}'}^\ast}|} > 0 \\[0.8ex]
{\land}~ (({\mathit{tid}}_{\mathit{fresh}} = \mbox{\texttt{`\_\_WILD\_'}}~{\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast \\
{\land}~ {|{{\mathit{tid}}_{\mathit{fresh}}^\ast}|} = {|{{\mathit{tparam}'}^\ast}|} \\
\end{array} \\
{\mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}}}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & ({{\tau_\texttt{f}}}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~{\tau}_{a'})^\ast}}{\}}}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\tau}_a^\ast}|} > 0 \land {|{{\mathit{tparam}}^\ast}|} = {|{{\tau}_a^\ast}|} \land {|{{\mathit{tparam}}_{\mathit{hidden}}^\ast}|} > 0 \\[0.8ex]
{\land}~ (({\mathit{tid}}_{\mathit{fresh}} = \mbox{\texttt{`\_\_WILD\_'}}~{\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast \\
{\land}~ {|{{\mathit{tid}}_{\mathit{fresh}}^\ast}|} = {|{{\mathit{tparam}}_{\mathit{hidden}}^\ast}|} \\[0.8ex]
{\land}~ {{\tau}_{a'}^\ast} = {{\tau}_a^\ast} \oplus {({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}_{\mathit{fresh}})^\ast} \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{consd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{cons}}}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & ({{\tau_\texttt{cons}}}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~{\tau}_a)^\ast}}{\}}}, \epsilon) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\mathit{tparam}'}^\ast}|} = {|{{\tau}_a^\ast}|} \\
\end{array} \\
{\mathsf{consd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{cons}}}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & ({{\tau_\texttt{cons}}}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}_{\mathit{fresh}}))^\ast}}{\}}}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\tau}_a^\ast}|} = 0 \land {|{{\mathit{tparam}'}^\ast}|} > 0 \\[0.8ex]
{\land}~ (({\mathit{tid}}_{\mathit{fresh}} = \mbox{\texttt{`\_\_WILD\_'}}~{\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast \\
{\land}~ {|{{\mathit{tid}}_{\mathit{fresh}}^\ast}|} = {|{{\mathit{tparam}'}^\ast}|} \\
\end{array} \\
{\mathsf{consd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{cons}}}{\langle}{{{\tau}_a^\ast}}{\rangle} & = & ({{\tau_\texttt{cons}}}{/}{{\{}{{({\mathit{tparam}'}~\mapsto~{\tau}_{a'})^\ast}}{\}}}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast} \oplus {{\mathit{tparam}}_{\mathit{hidden}}^\ast} \\
{\land}~ {|{{\tau}_a^\ast}|} > 0 \land {|{{\mathit{tparam}}^\ast}|} = {|{{\tau}_a^\ast}|} \land {|{{\mathit{tparam}}_{\mathit{hidden}}^\ast}|} > 0 \\[0.8ex]
{\land}~ (({\mathit{tid}}_{\mathit{fresh}} = \mbox{\texttt{`\_\_WILD\_'}}~{\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast \\
{\land}~ {|{{\mathit{tid}}_{\mathit{fresh}}^\ast}|} = {|{{\mathit{tparam}}_{\mathit{hidden}}^\ast}|} \\[0.8ex]
{\land}~ {{\tau}_{a'}^\ast} = {{\tau}_a^\ast} \oplus {({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}_{\mathit{fresh}})^\ast} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{{{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{{{\tau}_a^\ast}}{\rangle}}{|_{\mathtt{canon}}} & = & {\tau}{|_{\mathtt{canon}}} & \quad \mbox{if}~ \tau = {{\delta_\texttt{polytyp}}}{\langle}{{{\tau}_a^\ast}}{\rangle} \\
{{\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~\tau}{|_{\mathtt{canon}}} & = & {\tau}{|_{\mathtt{canon}}} \\
{\tau}{|_{\mathtt{canon}}} & = & \tau & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{get\_params\_functyp}~({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {{\tau_\texttt{param}}^\ast} \\
\mathsf{get\_params\_functyp}~({\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_r) & = & \epsilon \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{get\_params\_funcdef}~({\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}}) & = & \mathsf{get\_params\_functyp}~({\tau_\texttt{f}}) \\
\mathsf{get\_params\_funcdef}~(\mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}}) & = & \mathsf{get\_params\_functyp}~({\tau_\texttt{f}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})) & = & {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {\tau}_r \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {\tau}_r \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {\tau}_r \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {\tau}_r \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})) & = & {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})) & = & {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) & = & {\tau}_r \\
\mathsf{get\_typ\_ret\_functyp}~({\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_r) & = & {\tau}_r \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{get\_typ\_ret\_funcdef}~({\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}}) & = & \mathsf{get\_typ\_ret\_functyp}~({\tau_\texttt{f}}) \\
\mathsf{get\_typ\_ret\_funcdef}~(\mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau_\texttt{f}}) & = & \mathsf{get\_typ\_ret\_functyp}~({\tau_\texttt{f}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\tau~{\mathrm{nominal}} & = & {\mathrm{nominal}'}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nominal}'}({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau) & = & \mathsf{true} \\
{\mathrm{nominal}'}({{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}({{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}({{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}({{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}({{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}({\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}) & = & \mathsf{true} \\
{\mathrm{nominal}'}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

\vspace{1ex}

$\boxed{\tau \approx \tau}$

$\boxed{\delta_\texttt{func} \approx \delta_\texttt{func}}$

$\boxed{\tau_\texttt{f} \approx \tau_\texttt{f}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau_\texttt{base} = \tau_\texttt{base}
}{
\tau_\texttt{base} \approx \tau_\texttt{base}
} \, {[\textsc{\scriptsize Type\_alpha{-}basetyp}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}) \approx ({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}})
} \, {[\textsc{\scriptsize Type\_alpha{-}vart}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
{\tau}_{a'} = {{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_a^\ast}}{\rangle}
 \qquad
{\tau}_{b'} = {{\delta_\texttt{polytyp}}_b}{\langle}{{{\tau}_b^\ast}}{\rangle}
 \\
{\tau}_{a'} \approx {\tau}_{b'}
 \\
{\tau}_{a'}~{\mathrm{nominal}} \land {\tau}_{b'}~{\mathrm{nominal}}
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
\end{array}
}{
({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_a^\ast}}{\rangle}) \approx ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_b}{\langle}{{{\tau}_b^\ast}}{\rangle})
} \, {[\textsc{\scriptsize Type\_alpha{-}spect{-}nominal}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
{\tau}_{a'} = {{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_a^\ast}}{\rangle}
 \qquad
{\tau}_{b'} = {{\delta_\texttt{polytyp}}_b}{\langle}{{{\tau}_b^\ast}}{\rangle}
 \\
{\tau}_{a'} \approx {\tau}_{b'}
 \\
{\neg{\tau}_{a'}~{\mathrm{nominal}}} \land {\neg{\tau}_{b'}~{\mathrm{nominal}}}
\end{array}
}{
({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_a^\ast}}{\rangle}) \approx ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_b}{\langle}{{{\tau}_b^\ast}}{\rangle})
} \, {[\textsc{\scriptsize Type\_alpha{-}spect{-}structural}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_a \approx {\tau}_b
}{
({\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_a) \approx {\tau}_b
} \, {[\textsc{\scriptsize Type\_alpha{-}deft{-}left}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_a \approx {\tau}_b
}{
{\tau}_a \approx ({\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_b)
} \, {[\textsc{\scriptsize Type\_alpha{-}deft{-}right}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
{\tau}_a \approx {\tau}_b
}{
({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~{\tau}_a) \approx ({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~{\tau}_b)
} \, {[\textsc{\scriptsize Type\_alpha{-}newt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
}{
({{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{{\mathit{member}}_a^\ast}}{\}}) \approx ({{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{{\mathit{member}}_b^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}enumt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
{\tau}_a \approx {\tau}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
(({\mathit{val}}_a = {\mathit{val}}_b))^\ast
}{
({{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~{\tau}_a~\{}{{({\mathit{member}}_a, {\mathit{val}}_a)^\ast}}{\}}) \approx ({{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~{\tau}_b~\{}{{({\mathit{member}}_b, {\mathit{val}}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}senumt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_a \approx {\tau}_b
}{
({\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_a) \approx ({\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_b)
} \, {[\textsc{\scriptsize Type\_alpha{-}listt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau}_a \approx {\tau}_b)^\ast
}{
({\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_a^\ast}) \approx ({\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_b^\ast})
} \, {[\textsc{\scriptsize Type\_alpha{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_a \approx {\tau}_b
 \qquad
{\mathit{size}}_a = {\mathit{size}}_b
}{
({{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_a}{{}[ {\mathit{size}}_a ]}) \approx ({{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_b}{{}[ {\mathit{size}}_b ]})
} \, {[\textsc{\scriptsize Type\_alpha{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
}{
({{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_a)^\ast}}{\}}) \approx ({{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}_b, {\tau}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
}{
({{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_a)^\ast}}{\}}) \approx ({{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}_b, {\tau}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
}{
({{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_a)^\ast}}{\}}) \approx ({{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}_b, {\tau}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}uniont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{id}}_a = {\mathit{id}}_b
 \\
{\{}{{({\mathit{fid}}_a~\mapsto~{\delta_\texttt{func}}_a)^\ast}}{\}} = {\mathit{fmap}}_a
 \qquad
{\{}{{({\mathit{fid}}_b~\mapsto~{\delta_\texttt{func}}_b)^\ast}}{\}} = {\mathit{fmap}}_b
 \\
{\{~{{\mathit{fid}}_a^\ast}}{\}}~=~{\{~{{\mathit{fid}}_b^\ast}}{\}}
 \qquad
({{\mathit{fmap}}_a}{{}[ {\mathit{fid}}_a ]} \approx {{\mathit{fmap}}_b}{{}[ {\mathit{fid}}_a ]})^\ast
\end{array}
}{
({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~{\mathit{fmap}}_a) \approx ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~{\mathit{fmap}}_b)
} \, {[\textsc{\scriptsize Type\_alpha{-}externt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
(({\mathit{dir}}_a = {\mathit{dir}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
\end{array}
}{
({\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) \approx ({\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}))
} \, {[\textsc{\scriptsize Type\_alpha{-}parsert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
(({\mathit{dir}}_a = {\mathit{dir}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
\end{array}
}{
({\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) \approx ({\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}))
} \, {[\textsc{\scriptsize Type\_alpha{-}controlt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau}_a \approx {\tau}_b)^\ast
}{
({\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_a^\ast}) \approx ({\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_b^\ast})
} \, {[\textsc{\scriptsize Type\_alpha{-}packaget}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
{\tau}_a \approx {\tau}_b
}{
({\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a) \approx ({\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b)
} \, {[\textsc{\scriptsize Type\_alpha{-}tablet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}} \approx {\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_alpha{-}defaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau}_a \approx {\tau}_b)^\ast
}{
({\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_a^\ast}) \approx ({\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_b^\ast})
} \, {[\textsc{\scriptsize Type\_alpha{-}seqt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau}_a \approx {\tau}_b)^\ast
}{
({\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_a^\ast}) \approx ({\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_b^\ast})
} \, {[\textsc{\scriptsize Type\_alpha{-}seqdefaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
}{
({{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}_a, {\tau}_a)^\ast}}{\}}) \approx ({{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}_b, {\tau}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}recordt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
}{
({{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}_a, {\tau}_a)^\ast}}{\}}) \approx ({{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}_b, {\tau}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}recorddefaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}} \approx {\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_alpha{-}invalidt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_a \approx {\tau}_b
}{
({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_a) \approx ({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_b)
} \, {[\textsc{\scriptsize Type\_alpha{-}sett}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{state}}{\mathsf{\_}}{\mathsf{t}} \approx {\mathsf{state}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_alpha{-}statet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
}{
({{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{{\mathit{member}}_a^\ast}}{\}}) \approx ({{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{{\mathit{member}}_b^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}tableenumt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_a = {\mathit{id}}_b
 \qquad
(({\mathit{member}}_a = {\mathit{member}}_b))^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
}{
({{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_a)^\ast}}{\}}) \approx ({{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}_b, {\tau}_b)^\ast}}{\}})
} \, {[\textsc{\scriptsize Type\_alpha{-}tablestructt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{any}}{\mathsf{\_}}{\mathsf{t}} \approx {\mathsf{any}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_alpha{-}anyt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau_\texttt{f}}_a \approx {\tau_\texttt{f}}_b
}{
({\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}}_a) \approx ({\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}}_b)
} \, {[\textsc{\scriptsize FuncDef\_alpha{-}monofd}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\mathit{tparam}}_a^\ast}|} = {|{{\mathit{tparam}}_b^\ast}|}
 \qquad
{|{{\mathit{tparam}}_{{\mathit{hidden}}_a}^\ast}|} = {|{{\mathit{tparam}}_{{\mathit{hidden}}_b}^\ast}|}
 \\
(({\mathit{tid}}_{\mathit{fresh}} = {\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}))^\ast
 \qquad
{|{{\mathit{tid}}_{\mathit{fresh}}^\ast}|} = {|{{\mathit{tparam}}_a^\ast}~{{\mathit{tparam}}_{{\mathit{hidden}}_a}^\ast}|}
 \\
{{\mathit{tparam}}_{a'}^\ast} = {{\mathit{tparam}}_a^\ast} \oplus {{\mathit{tparam}}_{{\mathit{hidden}}_a}^\ast}
 \qquad
{\tau_\texttt{f}}_{a'} = {{\tau_\texttt{f}}_a}{/}{{\{}{{({\mathit{tparam}}_{a'}~\mapsto~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}_{\mathit{fresh}}))^\ast}}{\}}}
 \\
{{\mathit{tparam}}_{b'}^\ast} = {{\mathit{tparam}}_b^\ast} \oplus {{\mathit{tparam}}_{{\mathit{hidden}}_b}^\ast}
 \qquad
{\tau_\texttt{f}}_{b'} = {{\tau_\texttt{f}}_b}{/}{{\{}{{({\mathit{tparam}}_{b'}~\mapsto~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}_{\mathit{fresh}}))^\ast}}{\}}}
 \\
{\tau_\texttt{f}}_{a'} \approx {\tau_\texttt{f}}_{b'}
\end{array}
}{
(\mathsf{polyfd}~({{\mathit{tparam}}_a^\ast}, {{\mathit{tparam}}_{{\mathit{hidden}}_a}^\ast}) \rightarrow {\tau_\texttt{f}}_a) \approx (\mathsf{polyfd}~({{\mathit{tparam}}_b^\ast}, {{\mathit{tparam}}_{{\mathit{hidden}}_b}^\ast}) \rightarrow {\tau_\texttt{f}}_b)
} \, {[\textsc{\scriptsize FuncDef\_alpha{-}polyfd}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
 \qquad
{\tau}_{r_a} \approx {\tau}_{r_b}
\end{array}
}{
({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast}) \rightarrow {\tau}_{r_a}) \approx ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}) \rightarrow {\tau}_{r_b})
} \, {[\textsc{\scriptsize FuncType\_alpha{-}builtinmethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
\end{array}
}{
({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) \approx ({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}))
} \, {[\textsc{\scriptsize FuncType\_alpha{-}actiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
\end{array}
}{
({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) \approx ({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}))
} \, {[\textsc{\scriptsize FuncType\_alpha{-}parserapplymethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
\end{array}
}{
({\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) \approx ({\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}))
} \, {[\textsc{\scriptsize FuncType\_alpha{-}controlapplymethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_a \approx {\tau}_b
}{
({\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_a) \approx ({\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_b)
} \, {[\textsc{\scriptsize FuncType\_alpha{-}tableapplymethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
 \qquad
{\tau}_{r_a} \approx {\tau}_{r_b}
\end{array}
}{
({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast}) \rightarrow {\tau}_{r_a}) \approx ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}) \rightarrow {\tau}_{r_b})
} \, {[\textsc{\scriptsize FuncType\_alpha{-}externfunctiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
 \qquad
{\tau}_{r_a} \approx {\tau}_{r_b}
\end{array}
}{
({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast}) \rightarrow {\tau}_{r_a}) \approx ({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}) \rightarrow {\tau}_{r_b})
} \, {[\textsc{\scriptsize FuncType\_alpha{-}functiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
 \qquad
{\tau}_{r_a} \approx {\tau}_{r_b}
\end{array}
}{
({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast}) \rightarrow {\tau}_{r_a}) \approx ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}) \rightarrow {\tau}_{r_b})
} \, {[\textsc{\scriptsize FuncType\_alpha{-}externmethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{\mathit{val}}_a = {\tau_\texttt{param}}_a))^\ast
 \qquad
(({\mathit{id}}_b~{\mathit{dir}}_b~{\tau}_b~{\mathit{val}}_b = {\tau_\texttt{param}}_b))^\ast
 \\
({\mathit{dir}}_a = {\mathit{dir}}_b)^\ast
 \qquad
({\tau}_a \approx {\tau}_b)^\ast
 \qquad
{\tau}_{r_a} \approx {\tau}_{r_b}
\end{array}
}{
({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast}) \rightarrow {\tau}_{r_a}) \approx ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_b^\ast}) \rightarrow {\tau}_{r_b})
} \, {[\textsc{\scriptsize FuncType\_alpha{-}externabstractmethodt}]}
\qquad
\end{array}
$$

$\boxed{\mathcal{B} \vdash \tau}$

$\boxed{\mathcal{B} \vdash \delta_\texttt{typ}}$

$\boxed{\mathcal{B} \vdash \tau_\texttt{param}}$

$\boxed{\mathcal{B} \vdash {\tau_\texttt{param}^\ast}}$

$\boxed{\mathcal{B} \vdash \tau_\texttt{f}}$

$\boxed{\mathcal{B} \vdash \delta_\texttt{func}}$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \texttt{c} & ::= & \mathsf{\_} \\
\end{array}
$$

$\boxed{\mathcal{B}~\texttt{c} \vdash \tau_\texttt{param}}$

$\boxed{\mathcal{B}~\texttt{c} \vdash {\tau_\texttt{param}^\ast}}$

$\boxed{\mathcal{B} \vdash \tau_\texttt{cons}}$

$\boxed{\mathcal{B} \vdash \delta_\texttt{cons}}$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathcal{B} \vdash \tau_\texttt{base}
} \, {[\textsc{\scriptsize Type\_wf{-}baset}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{tid}}~\in~\mathcal{B}
}{
\mathcal{B} \vdash {\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}
} \, {[\textsc{\scriptsize Type\_wf{-}vart}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau = {{\delta_\texttt{polytyp}}}{\langle}{{{\tau}_a^\ast}}{\rangle}
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{{{\tau}_a^\ast}}{\rangle}
} \, {[\textsc{\scriptsize Type\_wf{-}spect}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{deft}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{deft}}({\tau}{|_{\mathtt{canon}}}) \\
{\mathrm{nestable}'}_{\mathit{deft}}(\tau_\texttt{base}) & = & {\neg\tau_\texttt{base}~\mathsf{is}~\mathsf{void\_t}} \land {\neg\tau_\texttt{base}~\mathsf{is}~\mathsf{match\_kind\_t}} \\
{\mathrm{nestable}'}_{\mathit{deft}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{deft}}(\tau_\texttt{data}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{deft}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathrm{nestable}}_{\mathit{deft}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~\tau
} \, {[\textsc{\scriptsize Type\_wf{-}deft}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{newt}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{newt}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{newt}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{newt}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{newt}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{newt}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{newt}}({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{newt}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathrm{nestable}}_{\mathit{newt}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau
} \, {[\textsc{\scriptsize Type\_wf{-}newt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
}{
\mathcal{B} \vdash {{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}enumt}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{senumt}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{senumt}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{senumt}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{senumt}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{senumt}}({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau) & = & {\mathrm{nestable}}_{{\mathit{newt}}_{{\mathit{in}}_{\mathit{senumt}}}}(\tau) \\
{\mathrm{nestable}'}_{\mathit{senumt}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \qquad
{\mathrm{nestable}}_{\mathit{senumt}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}senumt}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{listt}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{listt}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{listt}}(\tau_\texttt{base}) & = & {\neg\tau_\texttt{base}~\mathsf{is}~\mathsf{void\_t}} \\
{\mathrm{nestable}'}_{\mathit{listt}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{listt}}(\tau_\texttt{data}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{listt}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathrm{nestable}}_{\mathit{listt}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~\tau
} \, {[\textsc{\scriptsize Type\_wf{-}listt}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{tuplet}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{tuplet}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{tuplet}}({\mathsf{err}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{tuplet}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{tuplet}}(\tau_\texttt{num}) & = & {\neg\tau_\texttt{num}~\mathsf{is}~\mathsf{int\_t}} \\
{\mathrm{nestable}'}_{\mathit{tuplet}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{tuplet}}(\tau_\texttt{data}) & = & {\neg\tau_\texttt{data}~\mathsf{is}~\mathsf{list\_t}} \\
{\mathrm{nestable}'}_{\mathit{tuplet}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\mathrm{nestable}}_{\mathit{tuplet}}(\tau))^\ast
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}
} \, {[\textsc{\scriptsize Type\_wf{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{stackt}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{stackt}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{stackt}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{stackt}}({{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{stackt}}({{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{stackt}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{size}} \geq 0
 \qquad
{\mathrm{nestable}}_{\mathit{stackt}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~\tau}{{}[ {\mathit{size}} ]}
} \, {[\textsc{\scriptsize Type\_wf{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{structt}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{structt}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{structt}}({\mathsf{err}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{structt}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{structt}}(\tau_\texttt{num}) & = & {\neg\tau_\texttt{num}~\mathsf{is}~\mathsf{int\_t}} \\
{\mathrm{nestable}'}_{\mathit{structt}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{structt}}(\tau_\texttt{data}) & = & {\neg\tau_\texttt{data}~\mathsf{is}~\mathsf{list\_t}} \\
{\mathrm{nestable}'}_{\mathit{structt}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \qquad
({\mathrm{nestable}}_{\mathit{structt}}(\tau))^\ast
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{headert}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{headert}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{headert}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{headert}}(\tau_\texttt{num}) & = & {\neg\tau_\texttt{num}~\mathsf{is}~\mathsf{int\_t}} \\
{\mathrm{nestable}'}_{\mathit{headert}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{headert}}({{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{headert}}({{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} & \quad \mbox{if}~ ({\mathrm{nestable}}_{{\mathit{structt}}_{{\mathit{in}}_{\mathit{headert}}}}(\tau))^\ast \\
{\mathrm{nestable}'}_{\mathit{headert}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \qquad
({\mathrm{nestable}}_{\mathit{headert}}(\tau))^\ast
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{uniont}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{uniont}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{uniont}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{uniont}}({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{uniont}}({{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{uniont}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \qquad
({\mathrm{nestable}}_{\mathit{uniont}}(\tau))^\ast
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}uniont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\{}{{({\mathit{fid}}~\mapsto~\delta_\texttt{func})^\ast}}{\}} = {\mathit{fmap}}
 \qquad
(\mathcal{B} \vdash \delta_\texttt{func})^\ast
}{
\mathcal{B} \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}}
} \, {[\textsc{\scriptsize Type\_wf{-}externt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
} \, {[\textsc{\scriptsize Type\_wf{-}parsert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
} \, {[\textsc{\scriptsize Type\_wf{-}controlt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}
} \, {[\textsc{\scriptsize Type\_wf{-}packaget}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} = {\tau}{|_{\mathtt{canon}}}
 \qquad
{\tau'}~\mathsf{is}~\mathsf{table\_struct\_t}
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}
} \, {[\textsc{\scriptsize Type\_wf{-}tablet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathcal{B} \vdash {\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_wf{-}defaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}
} \, {[\textsc{\scriptsize Type\_wf{-}seqt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}
} \, {[\textsc{\scriptsize Type\_wf{-}seqdefaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}recordt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \qquad
(\mathcal{B} \vdash \tau)^\ast
}{
\mathcal{B} \vdash {{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}recorddefaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathcal{B} \vdash {\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_wf{-}invalidt}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{sett}}(\tau) & = & {\mathrm{nestable}'}_{\mathit{sett}}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}'}_{\mathit{sett}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{sett}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{sett}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{sett}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{sett}}({{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{sett}}({{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}'}_{\mathit{sett}}({\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}) & = & \mathsf{true} & \quad \mbox{if}~ ({\mathrm{nestable}}_{{\mathit{tuplet}}_{{\mathit{in}}_{\mathit{sett}}}}(\tau))^\ast \\
{\mathrm{nestable}'}_{\mathit{sett}}({\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}) & = & \mathsf{true} & \quad \mbox{if}~ ({\mathrm{nestable}}_{{\mathit{seqt}}_{{\mathit{in}}_{\mathit{sett}}}}(\tau))^\ast \\
{\mathrm{nestable}'}_{\mathit{sett}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} = {\tau}{|_{\mathtt{canon}}}
 \qquad
{\mathrm{nestable}}_{\mathit{sett}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau
} \, {[\textsc{\scriptsize Type\_wf{-}sett}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathcal{B} \vdash {\mathsf{state}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_wf{-}statet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
}{
\mathcal{B} \vdash {{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}tableenumt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{{\mathit{member}}^\ast} = \mbox{\texttt{`hit'}}~\mbox{\texttt{`miss'}}~\mbox{\texttt{`action\_run'}}
 \qquad
{\tau^\ast} = {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~({{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_e~\{}{{{\mathit{member}}_e^\ast}}{\}})
 \qquad
\mathcal{B} \vdash {{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_e~\{}{{{\mathit{member}}_e^\ast}}{\}}
}{
\mathcal{B} \vdash {{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}
} \, {[\textsc{\scriptsize Type\_wf{-}tablestructt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathcal{B} \vdash {\mathsf{any}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Type\_wf{-}anyt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{monod}}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{monod}}({\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{monod}}({{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{monod}}({{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{monod}}({\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{monod}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathrm{nestable}}_{\mathit{monod}}(\tau)
 \qquad
\mathcal{B} \vdash \tau
}{
\mathcal{B} \vdash \mathsf{monod}~\tau
} \, {[\textsc{\scriptsize TypeDef\_wf{-}monod}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{nestable}}_{\mathit{polyd}}({\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~\tau}{{}[ {\mathit{size}} ]}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}({\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}) & = & \mathsf{true} \\
{\mathrm{nestable}}_{\mathit{polyd}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathrm{nestable}}_{\mathit{polyd}}(\tau)
 \qquad
{{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}~{\mathrm{distinct}}
 \qquad
{\mathcal{B}'} = \mathcal{B}~\cup~{\{~({{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast})}{\}}
 \qquad
{\mathcal{B}'} \vdash \tau
}{
\mathcal{B} \vdash \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau
} \, {[\textsc{\scriptsize TypeDef\_wf{-}polyd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathcal{B} \vdash \tau
 \qquad
{\neg({\tau}{|_{\mathtt{canon}}} = {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_t~{\mathit{fmap}}_t \land {\mathit{dir}} \neq \mathsf{no})}
}{
\mathcal{B} \vdash {\mathit{id}}~{\mathit{dir}}~\tau~\epsilon
} \, {[\textsc{\scriptsize ParamType\_wf{-}none}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathcal{B} \vdash \tau
 \qquad
{\neg({\tau}{|_{\mathtt{canon}}} = {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_t~{\mathit{fmap}}_t \land {\mathit{dir}} \neq \mathsf{no})}
 \qquad
{\mathit{dir}} = \mathsf{in} \lor {\mathit{dir}} = \mathsf{no}
}{
\mathcal{B} \vdash {\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}}
} \, {[\textsc{\scriptsize ParamType\_wf{-}some}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
{{\mathit{id}}^\ast}~{\mathrm{distinct}}
 \qquad
(\mathcal{B} \vdash \tau_\texttt{param})^\ast
}{
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
} \, {[\textsc{\scriptsize ParamTypes\_wf}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash {\tau}_r
}{
\mathcal{B} \vdash {\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r
} \, {[\textsc{\scriptsize FuncType\_wf{-}builtinmethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
{{\mathit{dir}}^\ast}~\mathsf{is}~\mathsf{trailing}~\mathsf{action\_t}
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{int\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type}} \land ({\neg{\tau'}~\mathsf{is}~\mathsf{str\_t}} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
} \, {[\textsc{\scriptsize FuncType\_wf{-}actiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg({\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type} \land {\neg{\tau'}~\mathsf{is}~\mathsf{extern\_t}})} \land ({\neg({\tau'}~\mathsf{is}~\mathsf{str\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t})} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
} \, {[\textsc{\scriptsize FuncType\_wf{-}parserapplymethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg({\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type} \land {\neg{\tau'}~\mathsf{is}~\mathsf{extern\_t}})} \land ({\neg({\tau'}~\mathsf{is}~\mathsf{str\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t})} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
} \, {[\textsc{\scriptsize FuncType\_wf{-}controlapplymethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathcal{B} \vdash {\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}})
} \, {[\textsc{\scriptsize FuncType\_wf{-}tableapplymethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash {\tau}_r
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg({\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type} \land {\neg{\tau'}~\mathsf{is}~\mathsf{extern\_t}})} \land ({\neg({\tau'}~\mathsf{is}~\mathsf{str\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t})} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r
} \, {[\textsc{\scriptsize FuncType\_wf{-}externfunctiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash {\tau}_r
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type}} \land ({\neg({\tau'}~\mathsf{is}~\mathsf{str\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t})} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r
} \, {[\textsc{\scriptsize FuncType\_wf{-}functiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash {\tau}_r
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg({\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type} \land {\neg{\tau'}~\mathsf{is}~\mathsf{extern\_t}})} \land ({\neg({\tau'}~\mathsf{is}~\mathsf{str\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t})} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r
} \, {[\textsc{\scriptsize FuncType\_wf{-}externmethodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash {\tau}_r
 \qquad
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg({\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type} \land {\neg{\tau'}~\mathsf{is}~\mathsf{extern\_t}})} \land ({\neg({\tau'}~\mathsf{is}~\mathsf{str\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t})} \lor ({\mathit{dir}} = \mathsf{no}))))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r
} \, {[\textsc{\scriptsize FuncType\_wf{-}externabstractmethodt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\tau_\texttt{f}~\mathsf{is}~\mathsf{builtin\_method\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{action\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{parser\_apply\_method\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{control\_apply\_method\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{table\_apply\_method\_t}
 \\
\mathcal{B} \vdash \tau_\texttt{f}
\end{array}
}{
\mathcal{B} \vdash {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~\tau_\texttt{f}
} \, {[\textsc{\scriptsize FuncDef\_wf{-}monofd}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\tau_\texttt{f}~\mathsf{is}~\mathsf{extern\_func\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{func\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{extern\_method\_t} \lor \tau_\texttt{f}~\mathsf{is}~\mathsf{extern\_abstract\_method\_t}
 \\
{{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}~{\mathrm{distinct}}
 \qquad
{\mathcal{B}'} = \mathcal{B}~\cup~{\{~({{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast})}{\}}
 \qquad
{\mathcal{B}'} \vdash \tau_\texttt{f}
\end{array}
}{
\mathcal{B} \vdash \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau_\texttt{f}
} \, {[\textsc{\scriptsize FuncDef\_wf{-}polyfd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathcal{B} \vdash \tau
}{
\mathcal{B}~\texttt{c} \vdash {\mathit{id}}~\mathsf{no}~\tau~\epsilon
} \, {[\textsc{\scriptsize CParamType\_wf{-}none}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathcal{B} \vdash \tau
}{
\mathcal{B}~\texttt{c} \vdash {\mathit{id}}~\mathsf{no}~\tau~{\mathit{val}}
} \, {[\textsc{\scriptsize CParamType\_wf{-}some}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
{{\mathit{id}}^\ast}~{\mathrm{distinct}}
 \qquad
(\mathcal{B}~\texttt{c} \vdash \tau_\texttt{param})^\ast
}{
\mathcal{B}~\texttt{c} \vdash {\tau_\texttt{param}^\ast}
} \, {[\textsc{\scriptsize CParamTypes\_wf}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B}~\texttt{c} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash \tau
 \qquad
{\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}} = {\tau}{|_{\mathtt{canon}}}
 \\
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg({\tau'}~\mathsf{is}~\mathsf{object}~\mathsf{type} \land {\neg{\tau'}~\mathsf{is}~\mathsf{extern\_t}})}))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau
} \, {[\textsc{\scriptsize ConsType\_wf{-}externt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B}~\texttt{c} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash \tau
 \qquad
{\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) = {\tau}{|_{\mathtt{canon}}}
 \\
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{control\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{package\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{table\_t}}))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau
} \, {[\textsc{\scriptsize ConsType\_wf{-}parsert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B}~\texttt{c} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash \tau
 \qquad
{\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'}^\ast}) = {\tau}{|_{\mathtt{canon}}}
 \\
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{parser\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{package\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{table\_t}}))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau
} \, {[\textsc{\scriptsize ConsType\_wf{-}controlt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathcal{B}~\texttt{c} \vdash {\tau_\texttt{param}^\ast}
 \qquad
\mathcal{B} \vdash \tau
 \qquad
{\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\mathit{ty}}^\ast} = {\tau}{|_{\mathtt{canon}}}
 \\
(({\mathit{id}}~{\mathit{dir}}~\tau~{\mathit{val}} = \tau_\texttt{param}))^\ast
 \qquad
(({\tau'} = {\tau}{|_{\mathtt{canon}}}))^\ast
 \\
(({\neg{\tau'}~\mathsf{is}~\mathsf{def\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{spec\_t}} \land {\neg{\tau'}~\mathsf{is}~\mathsf{table\_t}}))^\ast
\end{array}
}{
\mathcal{B} \vdash {\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau
} \, {[\textsc{\scriptsize ConsType\_wf{-}packaget}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r = \tau_\texttt{cons}
 \qquad
{\tau}_{r'} = {{\tau}_r}{|_{\mathtt{canon}}}
 \\
{\tau}_{r'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{r'}~\mathsf{is}~\mathsf{parser\_t} \lor {\tau}_{r'}~\mathsf{is}~\mathsf{control\_t} \lor {\tau}_{r'}~\mathsf{is}~\mathsf{package\_t}
 \\
{{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}~{\mathrm{distinct}}
 \qquad
{\mathcal{B}'} = \mathcal{B}~\cup~{\{~({{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast})}{\}}
 \qquad
{\mathcal{B}'} \vdash \tau_\texttt{cons}
\end{array}
}{
\mathcal{B} \vdash \mathsf{consd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau_\texttt{cons}
} \, {[\textsc{\scriptsize ConsDef\_wf}]}
\qquad
\end{array}
$$

\vspace{1ex}

\vspace{1ex}

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& \Sigma & ::= & {{\{(}{{\mathit{id}}}~\mapsto~{\mathit{styp}}}{)^*\}} \\
& \Delta_\texttt{t} & ::= & {{\{(}{{\mathit{tid}}}~\mapsto~\delta_\texttt{typ}}{)^*\}} \\
& \Delta_\texttt{f} & ::= & {{\{(}{{\mathit{fid}}}~\mapsto~\delta_\texttt{func}}{)^*\}} \\
& \Delta_\texttt{c} & ::= & {{\{(}{{\mathit{fid}}}~\mapsto~\delta_\texttt{cons}}{)^*\}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{frame}} & = & \{~\} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{tdenv}} & = & \{~\} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{fdenv}} & = & \{~\} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{cdenv}} & = & \{~\} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'}) & = & {\mathit{id}}_f = {\mathit{id}}_{f'} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{check\_arity\_more}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) & = & \mathsf{true} & \quad \mbox{if}~ {|{({{\mathit{id}}_a^?})^\ast}|} > {|{{\mathit{id}}_p^\ast}|} \\
\mathsf{check\_arity\_more}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{check\_arity}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) & = & \mathsf{true} & \quad \mbox{if}~ {|{({{\mathit{id}}_a^?})^\ast}|} = {|{{\mathit{id}}_p^\ast}|} \\
\mathsf{check\_arity}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{check\_arity\_less}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) & = & \mathsf{true} & \quad \mbox{if}~ {|{({{\mathit{id}}_a^?})^\ast}|} < {|{{\mathit{id}}_p^\ast}|} \\
\mathsf{check\_arity\_less}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{get\_params\_missing\_names}~({\mathit{id}}_{\mathit{ph}}~{{\mathit{id}}_{\mathit{pt}}^\ast}, {{\mathit{id}}_a^\ast}) & = & {\mathit{id}}_{\mathit{ph}}~\mathsf{get\_params\_missing\_names}~({{\mathit{id}}_{\mathit{pt}}^\ast}, {{\mathit{id}}_a^\ast}) & \quad \mbox{if}~ {\neg{\mathit{id}}_{\mathit{ph}}~\in~{\{~{{\mathit{id}}_a^\ast}}{\}}} \\
\mathsf{get\_params\_missing\_names}~({\mathit{id}}_{\mathit{ph}}~{{\mathit{id}}_{\mathit{pt}}^\ast}, {{\mathit{id}}_a^\ast}) & = & \mathsf{get\_params\_missing\_names}~({{\mathit{id}}_{\mathit{pt}}^\ast}, {{\mathit{id}}_a^\ast}) & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{find\_match\_named}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_a^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & = & t & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\{~{{\mathit{id}}_a^\ast}}{\}}~=~{\{~{{\mathit{id}}_p^\ast}}{\}} \\
{\land}~ t = ({\mathit{fid}}, {\mathit{fv}}, \epsilon) \\
\end{array} \\
{\mathsf{find\_match\_named}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_a^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & = & \epsilon & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{find\_match\_named\_default}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_a^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & = & t & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{id}}_{\mathit{deft}}^\ast} = \mathsf{get\_params\_missing\_names}~({{\mathit{id}}_p^\ast}, {{\mathit{id}}_a^\ast}) \\
{\land}~ {\mathsf{find\_match\_named}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_a^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) \neq \epsilon \\
{\land}~ t = ({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) \\
\end{array} \\
{\mathsf{find\_match\_named\_default}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_a^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & = & \epsilon & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{find\_match\_unnamed\_default}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {({{\mathit{id}}_a^?})^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & = & t & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ ({{\mathit{prm}}^\ast}, {{\mathit{prm}'}^\ast}) = {\mathrm{partition}}(({\mathit{id}}, \mathbb{B}), {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {|{({{\mathit{id}}_a^?})^\ast}|}) \\
{\land}~ (({\mathit{prm}'} = ({\mathit{id}}_{\mathit{deft}}, \mathsf{true})))^\ast \\
{\land}~ t = ({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) \\
\end{array} \\
{\mathsf{find\_match\_unnamed\_default}}_{V}\,({\mathit{fid}}, {\mathit{fv}}, {({{\mathit{id}}_a^?})^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & = & \epsilon & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}) & = & \epsilon & \quad \mbox{if}~ {\neg\mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'})} \\
{\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}) & = & \epsilon & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ \mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'}) \\
{\land}~ \mathsf{check\_arity\_more}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) \\
\end{array} \\
{\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}) & = & {\mathsf{find\_match\_named}}_{V}\,({\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}, {{\mathit{id}}_{a'}^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ \mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'}) \\
{\land}~ \mathsf{check\_arity}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) \\
\end{array} \\
{\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, \epsilon, {\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}) & = & t & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ \mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'}) \\
{\land}~ \mathsf{check\_arity}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) \\
{\land}~ t = ({\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}, \epsilon) \\
\end{array} \\
{\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}) & = & {\mathsf{find\_match\_named\_default}}_{V}\,({\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}, {{\mathit{id}}_{a'}^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ \mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'}) \\
{\land}~ \mathsf{check\_arity\_less}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) \\
\end{array} \\
{\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, \epsilon, {\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}) & = & {\mathsf{find\_match\_unnamed\_default}}_{V}\,({\mathit{id}}_{f'}~{({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}, {\mathit{fv}}, {({{\mathit{id}}_a^?})^\ast}, {({\mathit{id}}_p, {\mathit{deft}}_p)^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ \mathsf{check\_func\_name}~({\mathit{id}}_f, {\mathit{id}}_{f'}) \\
{\land}~ \mathsf{check\_arity\_less}~({({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_p^\ast}) \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, \epsilon, \epsilon) & = & \epsilon \\
{\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{fid}}_h~{{\mathit{fid}}_t^\ast}, {\mathit{fv}}_h~{{\mathit{fv}}_t^\ast}) & = & {\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {{\mathit{fid}}_t^\ast}, {{\mathit{fv}}_t^\ast}) & \quad \mbox{if}~ {\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{fid}}_h, {\mathit{fv}}_h) = \epsilon \\
{\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{fid}}_h~{{\mathit{fid}}_t^\ast}, {\mathit{fv}}_h~{{\mathit{fv}}_t^\ast}) & = & t~{\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {{\mathit{fid}}_t^\ast}, {{\mathit{fv}}_t^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_{\mathit{deft}}^\ast})^?} = {\mathsf{find\_matching\_func}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {\mathit{fid}}_h, {\mathit{fv}}_h) \\
{\land}~ t = ({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\{}{{({\mathit{fid}}~\mapsto~{\mathit{fv}})^\ast}}{\}}~{}[ {{\mathit{id}}_f}{({({{\mathit{id}}_a^?})^\ast})}{} ]~\mathsf{opt} & = & \epsilon & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ (({{\mathit{id}}_a^?} = {\mathit{id}}_{a'}))^\ast \\
{\land}~ {\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {{\mathit{fid}}^\ast}, {{\mathit{fv}}^\ast}) = \epsilon \\
\end{array} \\
{\{}{{({\mathit{fid}}~\mapsto~{\mathit{fv}})^\ast}}{\}}~{}[ {{\mathit{id}}_f}{({({{\mathit{id}}_a^?})^\ast})}{} ]~\mathsf{opt} & = & t & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ (({{\mathit{id}}_a^?} = {\mathit{id}}_{a'}))^\ast \\
{\land}~ {({\mathit{fid}'}, {\mathit{fv}'}, {{\mathit{id}}_{\mathit{deft}}^\ast})^{1}} = {\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, {{\mathit{id}}_{a'}^\ast}, {{\mathit{fid}}^\ast}, {{\mathit{fv}}^\ast}) \\
{\land}~ t = {({\mathit{fid}'}, {\mathit{fv}'}, {{\mathit{id}}_{\mathit{deft}}^\ast})^{1}}{}[0] \\
\end{array} \\
{\{}{{({\mathit{fid}}~\mapsto~{\mathit{fv}})^\ast}}{\}}~{}[ {{\mathit{id}}_f}{({({{\mathit{id}}_a^?})^\ast})}{} ]~\mathsf{opt} & = & \epsilon & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ (({{\mathit{id}}_a^?} = \epsilon))^\ast \\
{\land}~ {\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, \epsilon, {{\mathit{fid}}^\ast}, {{\mathit{fv}}^\ast}) = \epsilon \\
\end{array} \\
{\{}{{({\mathit{fid}}~\mapsto~{\mathit{fv}})^\ast}}{\}}~{}[ {{\mathit{id}}_f}{({({{\mathit{id}}_a^?})^\ast})}{} ]~\mathsf{opt} & = & t & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ (({{\mathit{id}}_a^?} = \epsilon))^\ast \\
{\land}~ {({\mathit{fid}'}, {\mathit{fv}'}, {{\mathit{id}}_{\mathit{deft}}^\ast})^{1}} = {\mathsf{find\_matching\_funcs}}_{V}\,({\mathit{id}}_f, {({{\mathit{id}}_a^?})^\ast}, \epsilon, {{\mathit{fid}}^\ast}, {{\mathit{fv}}^\ast}) \\
{\land}~ t = {({\mathit{fid}'}, {\mathit{fv}'}, {{\mathit{id}}_{\mathit{deft}}^\ast})^{1}}{}[0] \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathit{fmap}}~{}[ {{\mathit{id}}_f}{({({{\mathit{id}}_a^?})^\ast})}{} ] & = & ({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) & \quad \mbox{if}~ {({\mathit{fid}}, {\mathit{fv}}, {{\mathit{id}}_{\mathit{deft}}^\ast})^?} = {\mathit{fmap}}~{}[ {{\mathit{id}}_f}{({({{\mathit{id}}_a^?})^\ast})}{} ]~\mathsf{opt} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{numIL}} & ::= & {\mathit{num}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{idIL}} & ::= & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{nameIL}} & ::= & {\mathit{name}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{memberIL}} & ::= & {\mathit{idIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{matchkindIL}} & ::= & {\mathit{idIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{statelabelIL}} & ::= & {\mathit{idIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{unopIL}} & ::= & {\mathit{unop}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{binopIL}} & ::= & {\mathit{binop}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{dirIL}} & ::= & {\mathit{dir}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{typeIL}} & ::= & \tau \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tparamIL}} & ::= & {\mathit{id}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{paramIL}} & ::= & {\mathit{idIL}}~{\mathit{dirIL}}~{\mathit{typeIL}}~{{\mathit{val}}^?} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{cparamIL}} & ::= & {\mathit{paramIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{targIL}} & ::= & {\mathit{typeIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{argIL}} & ::= & {\mathit{exprIL}} \\
& & | & {\mathit{idIL}} = {{\mathit{exprIL}}^?} \\
& & | & \mathsf{\_} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{keysetIL}} & ::= & {\mathit{exprIL}} \\
& & | & \mathsf{default} \\
& & | & \mathsf{\_} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{selectcaseIL}} & ::= & {{\mathit{keysetIL}}^\ast}~{\mathit{statelabelIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{exprIL}} & ::= & {\mathit{val}} \\
& & | & {\mathit{nameIL}} \\
& & | & {\{}{{{\mathit{exprIL}}^\ast}}{\}} \\
& & | & {\{}{{{\mathit{exprIL}}^\ast}}, {\ldots}\, \} \\
& & | & {\{}{{({\mathit{memberIL}}, {\mathit{exprIL}})^\ast}}{\}} \\
& & | & {\{}{{({\mathit{memberIL}}, {\mathit{exprIL}})^\ast}}, {\ldots}\, \} \\
& & | & {\ldots}\,  \\
& & | & {{\mathit{unopIL}}}{{\mathit{exprIL}}} \\
& & | & {\mathit{exprIL}}~{\mathit{binopIL}}~{\mathit{exprIL}} \\
& & | & ({\mathit{exprIL}}~?~{\mathit{exprIL}}~:~{\mathit{exprIL}}) \\
& & | & ({\mathit{typeIL}})~{\mathit{exprIL}} \\
& & | & {\mathit{exprIL}}~\&\&\&~{\mathit{exprIL}} \\
& & | & {\mathit{exprIL}} \ldots {\mathit{exprIL}} \\
& & | & {\mathsf{select}~({{\mathit{exprIL}}^\ast})~\{}{{{\mathit{selectcaseIL}}^\ast}}{\}} \\
& & | & {\mathit{exprIL}}~{}[ {\mathit{exprIL}} ] \\
& & | & {\mathit{exprIL}}~{}[ {\mathit{exprIL}}~:~{\mathit{exprIL}} ] \\
& & | & {\mathit{exprIL}} {.} {\mathit{memberIL}} \\
& & | & {{\mathit{nameIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}{({{\mathit{argIL}}^\ast})}{} \\
& & | & {\mathit{exprIL}} {.} {{\mathit{memberIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}{({{\mathit{argIL}}^\ast})}{} \\
& & | & {\mathit{nameIL}} {.} {{\mathit{memberIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}{({{\mathit{argIL}}^\ast})}{} \\
& & | & {{\mathit{nameIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}{({{\mathit{argIL}}^\ast})}{} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{blockIL}} & ::= & {\{}{{{\mathit{stmtIL}}^\ast}}{\}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{stmtIL}} & ::= & \mathsf{empty} \\
& & | & {\mathit{exprIL}} = {\mathit{exprIL}} \\
& & | & {\mathsf{switch}~({\mathit{exprIL}})~\{}{{{\mathit{switchcaseIL}}^\ast}}{\}} \\
& & | & \mathsf{if}~({\mathit{exprIL}})~\mathsf{then}~{\mathit{stmtIL}}~\mathsf{else}~{\mathit{stmtIL}} \\
& & | & {\mathit{blockIL}} \\
& & | & \mathsf{exit} \\
& & | & \mathsf{return}~{{\mathit{exprIL}}^?} \\
& & | & {{\mathit{nameIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}{({{\mathit{argIL}}^\ast})}{} \\
& & | & {{\mathit{exprIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle} {.} {{\mathit{memberIL}}}{({{\mathit{argIL}}^\ast})}{} \\
& & | & {{\mathit{nameIL}}~\langle}{{{\mathit{targIL}}^\ast}}{\rangle{.}\mathsf{apply}}{({{\mathit{argIL}}^\ast})}{}~/*~{\mathit{typeIL}}~*/ \\
& & | & \mathsf{transition}~{\mathit{exprIL}} \\
& & | & {\mathit{declIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{switchlabelIL}} & ::= & {\mathit{exprIL}} \\
& & | & \mathsf{default} \\
& {\mathit{switchcaseIL}} & ::= & \mathsf{case}~{\mathit{switchlabelIL}}~{\mathit{blockIL}} \\
& & | & \mathsf{case}~{\mathit{switchlabelIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{parserstateIL}} & ::= & {\mathit{statelabelIL}}~{\mathit{blockIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblIL}} & ::= & {{\mathit{tblpropIL}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblkeyIL}} & ::= & {\mathit{exprIL}}~{\mathit{matchkindIL}} \\
& {\mathit{tblkeypropIL}} & ::= & {{\mathit{tblkeyIL}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblactionIL}} & ::= & {\mathit{nameIL}}~{{\mathit{argIL}}^\ast}~{{\mathit{paramIL}}^\ast}~{{\mathit{paramIL}}^\ast} \\
& {\mathit{tblactionpropIL}} & ::= & {{\mathit{tblactionIL}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblentryIL}} & ::= & \mathbb{B}~{{\mathit{keysetIL}}^\ast}~{\mathit{tblactionIL}}~{{\mathit{val}}^?} \\
& {\mathit{tblentrypropIL}} & ::= & \mathbb{B}~{{\mathit{tblentryIL}}^\ast} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tbldefaultpropIL}} & ::= & \mathbb{B}~{\mathit{tblactionIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblcustompropIL}} & ::= & \mathbb{B}~{\mathit{memberIL}}~{\mathit{exprIL}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblpropIL}} & ::= & {\mathsf{keys}~\{}{{\mathit{tblkeypropIL}}}{\}} \\
& & | & {\mathsf{actions}~\{}{{\mathit{tblactionpropIL}}}{\}} \\
& & | & {\mathsf{entries}~\{}{{\mathit{tblentrypropIL}}}{\}} \\
& & | & {{\mathsf{default}}{\mathsf{\_}}{\mathsf{action}}~\{}{{\mathit{tbldefaultpropIL}}}{\}} \\
& & | & {\mathsf{custom}~\{}{{\mathit{tblcustompropIL}}}{\}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{methodIL}} & ::= & {{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{cparamIL}}^\ast})}{} \\
& & | & {\mathsf{abstract}~{\mathit{typeIL}}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{} \\
& & | & {{\mathit{typeIL}}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{declIL}} & ::= & \mathsf{const}~{\mathit{typeIL}}~{\mathit{idIL}} = {\mathit{val}} \\
& & | & {\mathit{typeIL}}~{\mathit{idIL}} = {{\mathit{exprIL}}^?} \\
& & | & {\mathsf{error}~\{}{{{\mathit{memberIL}}^\ast}}{\}} \\
& & | & {{\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}~\{}{{{\mathit{memberIL}}^\ast}}{\}} \\
& & | & {{\mathit{nameIL}}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}{{{\mathit{argIL}}^\ast}}~{\mathit{idIL}} = {\{}{{{\mathit{declIL}}^\ast}}{\}}~/*~{\mathit{typeIL}}~*/ \\
& & | & {\mathsf{struct}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{{\mathit{tparamIL}}^\ast}}{\rangle}~\{}{{({\mathit{memberIL}}, {\mathit{typeIL}})^\ast}}{\}} \\
& & | & {\mathsf{header}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{{\mathit{tparamIL}}^\ast}}{\rangle}~\{}{{({\mathit{memberIL}}, {\mathit{typeIL}})^\ast}}{\}} \\
& & | & {\mathsf{union}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{{\mathit{tparamIL}}^\ast}}{\rangle}~\{}{{({\mathit{memberIL}}, {\mathit{typeIL}})^\ast}}{\}} \\
& & | & {\mathsf{enum}~{\mathit{idIL}}~\{}{{{\mathit{memberIL}}^\ast}}{\}} \\
& & | & {\mathsf{enum}~{\mathit{idIL}}~{\mathit{typeIL}}~\{}{{({\mathit{memberIL}}, {\mathit{val}})^\ast}}{\}} \\
& & | & \mathsf{type}~{\mathit{idIL}}~{\mathit{typeIL}} \\
& & | & \mathsf{typedef}~{\mathit{idIL}}~{\mathit{typeIL}} \\
& & | & {\mathsf{value}}{\mathsf{\_}}{\mathsf{set}}{\langle}{{\mathit{typeIL}}}{\rangle}{({\mathit{exprIL}})}{}~{\mathit{idIL}} \\
& & | & {\mathsf{parser}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{} \\
& & | & {{\mathsf{parser}~{\mathit{idIL}}}{({{\mathit{paramIL}}^\ast})}{({{\mathit{cparamIL}}^\ast})}{}~\{}{{{\mathit{declIL}}^\ast}~{{\mathit{parserstateIL}}^\ast}}{\}} \\
& & | & {\mathsf{table}~{\mathit{idIL}}~\{}{{\mathit{tblIL}}}{\}}~/*~{\mathit{typeIL}}~*/ \\
& & | & {\mathsf{control}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{} \\
& & | & {{{\mathsf{control}~{\mathit{idIL}}}{({{\mathit{paramIL}}^\ast})}{({{\mathit{cparamIL}}^\ast})}{}~\{}{{{\mathit{declIL}}^\ast}}~\mathsf{apply}~{\mathit{blockIL}}}{\}} \\
& & | & \mathsf{action}~{\mathit{idIL}}~({{\mathit{paramIL}}^\ast})~{\mathit{blockIL}} \\
& & | & {{\mathit{typeIL}}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{}~{\mathit{blockIL}} \\
& & | & {\mathsf{extern}~{\mathit{typeIL}}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{} \\
& & | & {{\mathsf{extern}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}{\rangle}~\{}{{{\mathit{methodIL}}^\ast}}{\}} \\
& & | & {\mathsf{package}~{\mathit{idIL}}}{\langle}{{{\mathit{tparamIL}}^\ast}}, {{{\mathit{tparamIL}}^\ast}}{\rangle}{({{\mathit{cparamIL}}^\ast})}{} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{programIL}} & ::= & {{\mathit{declIL}}^\ast} \\
& {\mathit{ctk}} & ::= & \mathsf{lctk} ~|~ \mathsf{ctk} ~|~ \mathsf{dyn} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{lctk}~\sqcup_\texttt{ctk}~\mathsf{lctk} & = & \mathsf{lctk} \\
\mathsf{lctk}~\sqcup_\texttt{ctk}~\mathsf{ctk} & = & \mathsf{ctk} \\
\mathsf{ctk}~\sqcup_\texttt{ctk}~\mathsf{lctk} & = & \mathsf{ctk} \\
\mathsf{ctk}~\sqcup_\texttt{ctk}~\mathsf{ctk} & = & \mathsf{ctk} \\
{\mathit{ctk}}_a~\sqcup_\texttt{ctk}~{\mathit{ctk}}_b & = & \mathsf{dyn} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\sqcup_\texttt{ctk}}{\epsilon} & = & \mathsf{dyn} \\
{\sqcup_\texttt{ctk}}{{\mathit{ctk}}} & = & {\mathit{ctk}} \\
{\sqcup_\texttt{ctk}}{{\mathit{ctk}}_a~{\mathit{ctk}}_b} & = & {\mathit{ctk}}_a~\sqcup_\texttt{ctk}~{\mathit{ctk}}_b \\
{\sqcup_\texttt{ctk}}{{\mathit{ctk}}_a~{\mathit{ctk}}_b~{{\mathit{ctk}}_c^\ast}} & = & {\sqcup_\texttt{ctk}}{{\mathit{ctk}}_d~{{\mathit{ctk}}_c^\ast}} & \quad \mbox{if}~ {\mathit{ctk}}_d = {\mathit{ctk}}_a~\sqcup_\texttt{ctk}~{\mathit{ctk}}_b \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{flow}} & ::= & \mathsf{cont} ~|~ \mathsf{ret} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{ret}~\sqcup_\texttt{flow}~\mathsf{ret} & = & \mathsf{ret} \\
f_a~\sqcup_\texttt{flow}~f_b & = & \mathsf{cont} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{cursor}} & ::= & \mathsf{global} ~|~ \mathsf{block} ~|~ \mathsf{local} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{glayer}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{cdenv}~\Delta_\texttt{c} \\
\mathsf{tdenv}~\Delta_\texttt{t} \\
\mathsf{fdenv}~\Delta_\texttt{f} \\
\mathsf{frame}~\Sigma \} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{bkind}} & ::= & \mathsf{empty} ~|~ \mathsf{extern} ~|~ \mathsf{parser} ~|~ \mathsf{control} ~|~ \mathsf{package} \\
& {\mathit{blayer}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{id}~{\mathit{id}} \\
\mathsf{kind}~{\mathit{bkind}} \\
\mathsf{tdenv}~\Delta_\texttt{t} \\
\mathsf{fdenv}~\Delta_\texttt{f} \\
\mathsf{frame}~\Sigma \} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{lkind}} & ::= & \mathsf{empty} \\
& & | & \mathsf{externfunc} \\
& & | & \mathsf{func}~\tau \\
& & | & \mathsf{action} \\
& & | & \mathsf{externmethod} \\
& & | & \mathsf{externabstractmethod}~\tau \\
& & | & \mathsf{parserstate} \\
& & | & \mathsf{controlapplymethod} \\
& & | & \mathsf{tableapplymethod} \\
& {\mathit{llayer}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{id}~{\mathit{id}} \\
\mathsf{kind}~{\mathit{lkind}} \\
\mathsf{tdenv}~\Delta_\texttt{t} \\
\mathsf{frames}~{\Sigma^\ast} \} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{context}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{global}~{\mathit{glayer}} \\
\mathsf{block}~{\mathit{blayer}} \\
\mathsf{local}~{\mathit{llayer}} \} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{enter}~C & = & C{}[{.}\mathsf{local}{.}\mathsf{frames} = \{~\}~C{.}\mathsf{local}{.}\mathsf{frames}] \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{exit}~C & = & C{}[{.}\mathsf{local}{.}\mathsf{frames} = {{\Sigma}_t^\ast}] & \quad \mbox{if}~ {\Sigma}_h~{{\Sigma}_t^\ast} = C{.}\mathsf{local}{.}\mathsf{frames} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C{.}\mathsf{block}{.}\mathsf{kind} = {\mathit{bkind}} & = & C{}[{.}\mathsf{block}{.}\mathsf{kind} = {\mathit{bkind}}] \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C{.}\mathsf{local} .. \mathsf{kind} = {\mathit{lkind}} & = & C{}[{.}\mathsf{local}{.}\mathsf{kind} = {\mathit{lkind}}] \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{return}~\mathsf{type}~\mathsf{of}~\mathsf{func}~\tau & = & \tau \\
\mathsf{return}~\mathsf{type}~\mathsf{of}~\mathsf{action} & = & {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} \\
\mathsf{return}~\mathsf{type}~\mathsf{of}~\mathsf{externabstractmethod}~\tau & = & \tau \\
\mathsf{return}~\mathsf{type}~\mathsf{of}~\mathsf{controlapplymethod} & = & {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C) & = & {\{~\epsilon}{\}} \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{block}, C) & = & {\texttt{Dom}(}{C{.}\mathsf{block}{.}\mathsf{tdenv}}{)} \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{local}, C) & = & {\texttt{Dom}(}{C{.}\mathsf{local}{.}\mathsf{tdenv}}{)}~\cup~{\mathrm{bound}}_{\mathit{tid}}(\mathsf{block}, C) \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C {.} {\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\mathit{styp}}}{\}} & = & C{}[{.}\mathsf{global}{.}\mathsf{frame} = \Sigma] & \quad \mbox{if}~ \Sigma = {C{.}\mathsf{global}{.}\mathsf{frame}}{\{}~{\mathit{id}}~\mapsto~{\mathit{styp}}~\} \\
C {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\mathit{styp}}}{\}} & = & C{}[{.}\mathsf{block}{.}\mathsf{frame} = \Sigma] & \quad \mbox{if}~ \Sigma = {C{.}\mathsf{block}{.}\mathsf{frame}}{\{}~{\mathit{id}}~\mapsto~{\mathit{styp}}~\} \\
C {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\mathit{styp}}}{\}} & = & C{}[{.}\mathsf{local}{.}\mathsf{frames} = {\Sigma^\ast}] & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\Sigma}_h~{{\Sigma}_t^\ast} = C{.}\mathsf{local}{.}\mathsf{frames} \\
{\land}~ {\Sigma}_{h'} = {{\Sigma}_h}{\{}~{\mathit{id}}~\mapsto~{\mathit{styp}}~\} \\
{\land}~ {\Sigma^\ast} = {\Sigma}_{h'}~{{\Sigma}_t^\ast} \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{\epsilon}{\mapsto^{*}}{\epsilon}{\}} & = & C \\
C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}_h~{{\mathit{id}}_t^\ast}}{\mapsto^{*}}{{\mathit{styp}}_h~{{\mathit{styp}}_t^\ast}}{\}} & = & {C''} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}_h}{\mapsto}{{\mathit{styp}}_h}{\}} \\
{\land}~ {C''} = {C'} {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_t^\ast}}{\mapsto^{*}}{{{\mathit{styp}}_t^\ast}}{\}} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{add}}_{\mathit{param}}(p, C, {\tau_\texttt{param}}) & = & {C'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{id}}~\mathsf{no}~\tau~{{\mathit{val}}^?} = {\tau_\texttt{param}} \\
{\land}~ {C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{\tau~\mathsf{no}~\mathsf{ctk}~\epsilon}{\}} \\
\end{array} \\
{\mathrm{add}}_{\mathit{param}}(p, C, {\tau_\texttt{param}}) & = & {C'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?} = {\tau_\texttt{param}} \\
{\land}~ {\mathit{dir}} = \mathsf{in} \lor {\mathit{dir}} = \mathsf{out} \lor {\mathit{dir}} = \mathsf{inout} \\
{\land}~ {C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{\tau~{\mathit{dir}}~\mathsf{dyn}~\epsilon}{\}} \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{add}}_{\mathit{params}}(p, C, \epsilon) & = & C \\
{\mathrm{add}}_{\mathit{params}}(p, C, {\tau_\texttt{param}}_h~{{\tau_\texttt{param}}_t^\ast}) & = & {C''} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {C'} = {\mathrm{add}}_{\mathit{param}}(p, C, {\tau_\texttt{param}}_h) \\
{\land}~ {C''} = {\mathrm{add}}_{\mathit{params}}(p, {C'}, {{\tau_\texttt{param}}_t^\ast}) \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{tid}}}{\mapsto}{{\delta_\texttt{typ}}}{\}} & = & C{}[{.}\mathsf{global}{.}\mathsf{tdenv} = \Delta_\texttt{t}] & \quad \mbox{if}~ \Delta_\texttt{t} = {C{.}\mathsf{global}{.}\mathsf{tdenv}}{\{}~{\mathit{tid}}~\mapsto~{\delta_\texttt{typ}}~\} \\
C {.} {\mathsf{block}{.}\mathsf{tdenv}}{\{}{{\mathit{tid}}}{\mapsto}{{\delta_\texttt{typ}}}{\}} & = & C{}[{.}\mathsf{block}{.}\mathsf{tdenv} = \Delta_\texttt{t}] & \quad \mbox{if}~ \Delta_\texttt{t} = {C{.}\mathsf{block}{.}\mathsf{tdenv}}{\{}~{\mathit{tid}}~\mapsto~{\delta_\texttt{typ}}~\} \\
C {.} {\mathsf{local}{.}\mathsf{tdenv}}{\{}{{\mathit{tid}}}{\mapsto}{{\delta_\texttt{typ}}}{\}} & = & C{}[{.}\mathsf{local}{.}\mathsf{tdenv} = \Delta_\texttt{t}] & \quad \mbox{if}~ \Delta_\texttt{t} = {C{.}\mathsf{local}{.}\mathsf{tdenv}}{\{}~{\mathit{tid}}~\mapsto~{\delta_\texttt{typ}}~\} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C {.} {p{.}\mathsf{tdenv}}{\{}{\epsilon}{\mapsto^{*}}{\epsilon}{\}} & = & C \\
C {.} {p{.}\mathsf{tdenv}}{\{}{{\mathit{tid}}_h~{{\mathit{tid}}_t^\ast}}{\mapsto^{*}}{{\delta_\texttt{typ}}_h~{{\delta_\texttt{typ}}_t^\ast}}{\}} & = & {C''} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {C'} = C {.} {p{.}\mathsf{tdenv}}{\{}{{\mathit{tid}}_h}{\mapsto}{{\delta_\texttt{typ}}_h}{\}} \\
{\land}~ {C''} = {C'} {.} {p{.}\mathsf{tdenv}}{\{}{{{\mathit{tid}}_t^\ast}}{\mapsto^{*}}{{{\delta_\texttt{typ}}_t^\ast}}{\}} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C {.} {\mathsf{global}{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{{\delta_\texttt{func}}}{\}} & = & C{}[{.}\mathsf{global}{.}\mathsf{fdenv} = \Delta_\texttt{f}] & \quad \mbox{if}~ \Delta_\texttt{f} = {C{.}\mathsf{global}{.}\mathsf{fdenv}}{\{}~{\mathit{fid}}~\mapsto~{\delta_\texttt{func}}~\} \\
C {.} {\mathsf{block}{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{{\delta_\texttt{func}}}{\}} & = & C{}[{.}\mathsf{block}{.}\mathsf{fdenv} = \Delta_\texttt{f}] & \quad \mbox{if}~ \Delta_\texttt{f} = {C{.}\mathsf{block}{.}\mathsf{fdenv}}{\{}~{\mathit{fid}}~\mapsto~{\delta_\texttt{func}}~\} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
C {.} {\mathsf{global}{.}\mathsf{cdenv}}{\{}{{\mathit{cid}}}{\mapsto}{{\delta_\texttt{cons}}}{\}} & = & C{}[{.}\mathsf{global}{.}\mathsf{cdenv} = \Delta_\texttt{c}] & \quad \mbox{if}~ \Delta_\texttt{c} = {C{.}\mathsf{global}{.}\mathsf{cdenv}}{\{}~{\mathit{cid}}~\mapsto~{\delta_\texttt{cons}}~\} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{C}{@}{p{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {{.}}\, {\mathit{id}} ] & = & {C{.}\mathsf{global}{.}\mathsf{frame}}{{}[ {\mathit{id}} ]} \\
{C}{@}{\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & = & {C{.}\mathsf{global}{.}\mathsf{frame}}{{}[ {\mathit{id}} ]} \\
{C}{@}{\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & = & {\mathit{styp}} & \quad \mbox{if}~ {{\mathit{styp}}^?} = {C{.}\mathsf{global}{.}\mathsf{frame}}{{{}[ {\mathit{id}} ]^?}} \\
{C}{@}{\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & = & {C}{@}{\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & \quad \mbox{if}~ \epsilon = {C{.}\mathsf{global}{.}\mathsf{frame}}{{{}[ {\mathit{id}} ]^?}} \\
{C}{@}{\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & = & {\mathit{styp}} & \quad \mbox{if}~ {{\mathit{styp}}^?} = {C{.}\mathsf{local}{.}\mathsf{frames}}{{{}[ {\mathit{id}} ]^?}} \\
{C}{@}{\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & = & {C}{@}{\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}} ] & \quad \mbox{if}~ \epsilon = {C{.}\mathsf{local}{.}\mathsf{frames}}{{{}[ {\mathit{id}} ]^?}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{C}{@}{p{.}\mathsf{frame}}~{}[ {\mathit{name}} ] & = & {\mathit{val}} & \quad \mbox{if}~ \tau~{\mathit{dir}}~{\mathit{ctk}}~{{\mathit{val}}^?} = {C}{@}{p{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{name}} ] \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{C}{@}{p{.}\mathsf{tdenv}}~{}[ {{.}}\, {\mathit{id}} ] & = & {C{.}\mathsf{global}{.}\mathsf{tdenv}}{{}[ {\mathit{id}} ]} \\
{C}{@}{\mathsf{global}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & = & {C{.}\mathsf{global}{.}\mathsf{tdenv}}{{}[ {\mathit{id}} ]} \\
{C}{@}{\mathsf{block}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & = & {\delta_\texttt{typ}} & \quad \mbox{if}~ {{\delta_\texttt{typ}}^?} = {C{.}\mathsf{global}{.}\mathsf{tdenv}}{{{}[ {\mathit{id}} ]^?}} \\
{C}{@}{\mathsf{block}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & = & {C}{@}{\mathsf{global}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & \quad \mbox{if}~ \epsilon = {C{.}\mathsf{global}{.}\mathsf{tdenv}}{{{}[ {\mathit{id}} ]^?}} \\
{C}{@}{\mathsf{local}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & = & {\delta_\texttt{typ}} & \quad \mbox{if}~ {{\delta_\texttt{typ}}^?} = {C{.}\mathsf{local}{.}\mathsf{tdenv}}{{{}[ {\mathit{id}} ]^?}} \\
{C}{@}{\mathsf{block}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & = & {C}{@}{\mathsf{block}{.}\mathsf{tdenv}}~{}[ {\mathit{id}} ] & \quad \mbox{if}~ \epsilon = {C{.}\mathsf{local}{.}\mathsf{tdenv}}{{{}[ {\mathit{id}} ]^?}} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{to}}_{\mathit{fkey}}(\epsilon) & = & \epsilon \\
{\mathrm{to}}_{\mathit{fkey}}({\mathit{argIL}}_h~{{\mathit{argIL}}_t^\ast}) & = & {\mathit{id}}~{\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}_t^\ast}) & \quad \mbox{if}~ {\mathit{id}} = {{\mathit{exprIL}}^?} = {\mathit{argIL}}_h \\
{\mathrm{to}}_{\mathit{fkey}}({\mathit{argIL}}_h~{{\mathit{argIL}}_t^\ast}) & = & {\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}_t^\ast}) & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{C}{@}{p{.}\mathsf{fdenv}}~{}[ {{{.}}\, {\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & C{.}\mathsf{global}{.}\mathsf{fdenv}~{}[ {{\mathit{id}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ] \\
{C}{@}{\mathsf{global}{.}\mathsf{fdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & C{.}\mathsf{global}{.}\mathsf{fdenv}~{}[ {{\mathit{id}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ] \\
{C}{@}{\mathsf{block}{.}\mathsf{fdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & ({\mathit{fid}}, {\delta_\texttt{func}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) & \quad \mbox{if}~ {({\mathit{fid}}, {\delta_\texttt{func}}, {{\mathit{id}}_{\mathit{deft}}^\ast})^?} = C{.}\mathsf{block}{.}\mathsf{fdenv}~{}[ {{\mathit{id}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ]~\mathsf{opt} \\
{C}{@}{\mathsf{block}{.}\mathsf{fdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & {C}{@}{\mathsf{global}{.}\mathsf{fdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & \quad \mbox{if}~ \epsilon = C{.}\mathsf{block}{.}\mathsf{fdenv}~{}[ {{\mathit{id}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ]~\mathsf{opt} \\
{C}{@}{\mathsf{local}{.}\mathsf{fdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & {C}{@}{\mathsf{block}{.}\mathsf{fdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{C}{@}{p{.}\mathsf{cdenv}}~{}[ {{{.}}\, {\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & C{.}\mathsf{global}{.}\mathsf{cdenv}~{}[ {{\mathit{id}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ] \\
{C}{@}{\mathsf{global}{.}\mathsf{cdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & C{.}\mathsf{global}{.}\mathsf{cdenv}~{}[ {{\mathit{id}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ] \\
{C}{@}{\mathsf{block}{.}\mathsf{cdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & {C}{@}{\mathsf{global}{.}\mathsf{cdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] \\
{C}{@}{\mathsf{local}{.}\mathsf{cdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] & = & {C}{@}{\mathsf{block}{.}\mathsf{cdenv}}~{}[ {{\mathit{id}}}{({{\mathit{argIL}}^\ast})}{} ] \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{mode}} & ::= & \mathsf{nopri} \\
& & | & \mathsf{noprilpm}~\mathbb{Z} \\
& & | & \mathsf{pri} \\
& & | & \mathsf{prilpm} \\
& {\mathit{priority}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{values}~{\mathbb{Z}^\ast} \\
\mathsf{init}~\mathbb{B} \\
\mathsf{delta}~\mathbb{Z} \\
\mathsf{largest\_wins}~\mathbb{B} \} \\
\end{array} \\
& {\mathit{entry}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{size}~\mathbb{Z} \\
\mathsf{const}~\mathbb{B} \} \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{key}} & ::= & (\tau, {\mathit{matchkind}}) \\
& {\mathit{action}} & ::= & ({\mathit{name}}, {\tau_\texttt{param}^\ast}, {{\mathit{argIL}}^\ast}) \\
& {\mathit{tblctx}} & ::= & \{ \begin{array}[t]{@{}l@{}l@{}}
\mathsf{keys}~{{\mathit{key}}^\ast} \\
\mathsf{actions}~{{\mathit{action}}^\ast} \\
\mathsf{priorities}~{\mathit{priority}} \\
\mathsf{entries}~{\mathit{entry}} \\
\mathsf{mode}~{\mathit{mode}} \} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{tblstate}} & ::= & \mathsf{lpm}~\mathbb{Z} \\
& & | & \mathsf{nolpm} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{pt}} & = & & \\
 \multicolumn{4}{@{}l@{}}{\quad
\begin{array}[t]{@{}l@{}}
\{ \begin{array}[t]{@{}l@{}}
\mathsf{values}~\epsilon,\; \\
  \mathsf{init}~\mathsf{false},\; \\
  \mathsf{delta}~1,\; \\
  \mathsf{largest\_wins}~\mathsf{true} \}\end{array} \\
\end{array}
} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{et}} & = & & \\
 \multicolumn{4}{@{}l@{}}{\quad
\begin{array}[t]{@{}l@{}}
\{ \begin{array}[t]{@{}l@{}}
\mathsf{size}~0,\; \\
  \mathsf{const}~\mathsf{true} \}\end{array} \\
\end{array}
} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{empty}}_{\mathit{tblctx}} & = & & \\
 \multicolumn{4}{@{}l@{}}{\quad
\begin{array}[t]{@{}l@{}}
\{ \begin{array}[t]{@{}l@{}}
\mathsf{keys}~\epsilon,\; \\
  \mathsf{actions}~\epsilon,\; \\
  \mathsf{priorities}~{\mathrm{empty}}_{\mathit{pt}},\; \\
  \mathsf{entries}~{\mathrm{empty}}_{\mathit{et}},\; \\
  \mathsf{mode}~\mathsf{nopri} \}\end{array} \\
\end{array}
} \\
\end{array}
$$

\vspace{1ex}

\vspace{1ex}

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{update}}_{\mathit{state}}(\mathsf{nolpm}, \mathsf{lpm}~i) & = & \mathsf{lpm}~i \\
{\mathrm{update}}_{\mathit{state}}(\mathsf{lpm}~i, \mathsf{nolpm}) & = & \mathsf{lpm}~i \\
{\mathrm{update}}_{\mathit{state}}(\mathsf{nolpm}, \mathsf{nolpm}) & = & \mathsf{nolpm} \\
\end{array}
$$

\vspace{1ex}

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{keys}}_{{\mathit{of}}_{\mathit{table}}}(\epsilon) & = & \epsilon \\
{\mathrm{keys}}_{{\mathit{of}}_{\mathit{table}}}(({\mathsf{keys}~\{}{{\mathit{tblkeyprop}}}{\}})~{{\mathit{tblprop}}_t^\ast}) & = & {\mathit{tblkeyprop}}~{\mathrm{keys}}_{{\mathit{of}}_{\mathit{table}}}({{\mathit{tblprop}}_t^\ast}) \\
{\mathrm{keys}}_{{\mathit{of}}_{\mathit{table}}}({\mathit{tblprop}}_h~{{\mathit{tblprop}}_t^\ast}) & = & {\mathrm{keys}}_{{\mathit{of}}_{\mathit{table}}}({{\mathit{tblprop}}_t^\ast}) & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{actions}}_{{\mathit{of}}_{\mathit{table}}}(\epsilon) & = & \epsilon \\
{\mathrm{actions}}_{{\mathit{of}}_{\mathit{table}}}(({\mathsf{actions}~\{}{{\mathit{tblactionprop}}}{\}})~{{\mathit{tblprop}}_t^\ast}) & = & {\mathit{tblactionprop}}~{\mathrm{actions}}_{{\mathit{of}}_{\mathit{table}}}({{\mathit{tblprop}}_t^\ast}) \\
{\mathrm{actions}}_{{\mathit{of}}_{\mathit{table}}}({\mathit{tblprop}}_h~{{\mathit{tblprop}}_t^\ast}) & = & {\mathrm{actions}}_{{\mathit{of}}_{\mathit{table}}}({{\mathit{tblprop}}_t^\ast}) & \quad \mbox{otherwise} \\
\end{array}
$$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}}$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{type}} : \tau~{{\mathit{tid}}^\ast}}$

$\boxed{\tau \leq \tau}$

$\boxed{\tau \prec \tau}$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{arg}} : {\mathit{argIL}}~\tau}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{exprIL}}}$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{blkctxt}} & ::= & \mathsf{init} ~|~ \mathsf{noinit} \\
\end{array}
$$

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}}~{\mathit{blkctxt}} \vdash {\mathit{block}} : {\mathit{context}}~{\mathit{flow}}~{\mathit{blockIL}}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}} \vdash {\mathit{stmt}} : {\mathit{context}}~{\mathit{flow}}~{\mathit{stmtIL}}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}} \vdash {{\mathit{stmt}}^\ast} : {\mathit{context}}~{\mathit{flow}}~{{\mathit{stmtIL}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{cparam}} : {\mathit{cparamIL}}~{{\mathit{tid}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{decl}} : {\mathit{context}}~{\mathit{declIL}}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {{\mathit{decl}}^\ast} : {\mathit{context}}~{{\mathit{declIL}}^\ast}}$

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{actctxt}} & ::= & \mathsf{act} ~|~ \mathsf{noact} \\
\end{array}
$$

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{actctxt}} \vdash \tau_\texttt{param} \approx ({\mathit{exprIL}}, \tau) : {\mathit{exprIL}}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{actctxt}} \vdash \tau_\texttt{param} \approx ({\mathit{argIL}}, \tau) : {\mathit{argIL}}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash \tau_\texttt{f} : \mathsf{callsite\_ok}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash \tau_\texttt{f}~{{\mathit{tid}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, \tau)^\ast}~{{\mathit{id}}^\ast} : \tau~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{{\mathit{tid}}^\ast}~{{\mathit{id}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{expr}}~{\mathit{member}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{\mathit{exprIL}}~{{\mathit{tid}}^\ast}~{{\mathit{id}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{cons}~{{\mathit{tid}}^\ast}~{{\mathit{id}}^\ast}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash \tau_\texttt{cons} : \mathsf{instsite\_ok}}$

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash \tau_\texttt{cons}~{{\mathit{tid}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, \tau)^\ast}~{{\mathit{id}}^\ast} : \tau~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash {\mathit{val}} \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}valuee}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{val}} = {C}{@}{p{.}\mathsf{frame}}~{}[ {\mathit{name}} ]
}{
p~C \vdash {\mathit{name}} \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}namee}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}})^\ast
}{
p~C \vdash {\{}{{{\mathit{exprIL}}^\ast}}{\}} \hookrightarrow {\mathsf{seq}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast}
} \, {[\textsc{\scriptsize Eval\_static{-}seqe}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}})^\ast
}{
p~C \vdash {\{}{{({\mathit{member}}, {\mathit{exprIL}})^\ast}}{\}} \hookrightarrow {{\mathsf{record}}{\mathsf{\_}}{\mathsf{v}}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}
} \, {[\textsc{\scriptsize Eval\_static{-}recorde}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \qquad
{\mathit{val}'} = {{\mathit{unop}}}{({\mathit{val}})}{}
}{
p~C \vdash {{\mathit{unop}}}{{\mathit{exprIL}}} \hookrightarrow {\mathit{val}'}
} \, {[\textsc{\scriptsize Eval\_static{-}une}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_l \hookrightarrow {\mathit{val}}_l
 \qquad
p~C \vdash {\mathit{exprIL}}_r \hookrightarrow {\mathit{val}}_r
 \qquad
{\mathit{val}} = {{\mathit{binop}}}{({\mathit{val}}_l, {\mathit{val}}_r)}
}{
p~C \vdash {\mathit{exprIL}}_l~{\mathit{binop}}~{\mathit{exprIL}}_r \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}bine}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_c \hookrightarrow {\mathsf{bool}}{\mathsf{\_}}{\mathsf{v}}~\mathsf{true}
 \qquad
p~C \vdash {\mathit{exprIL}}_t \hookrightarrow {\mathit{val}}
}{
p~C \vdash ({\mathit{exprIL}}_c~?~{\mathit{exprIL}}_t~:~{\mathit{exprIL}}_f) \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}terne{-}true}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_c \hookrightarrow {\mathsf{bool}}{\mathsf{\_}}{\mathsf{v}}~\mathsf{false}
 \qquad
p~C \vdash {\mathit{exprIL}}_f \hookrightarrow {\mathit{val}}
}{
p~C \vdash ({\mathit{exprIL}}_c~?~{\mathit{exprIL}}_t~:~{\mathit{exprIL}}_f) \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}terne{-}false}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \qquad
{\mathit{val}'} = (\tau)~{\mathit{val}}
}{
p~C \vdash (\tau)~{\mathit{exprIL}} \hookrightarrow {\mathit{val}'}
} \, {[\textsc{\scriptsize Eval\_static{-}caste}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_b \hookrightarrow {\mathit{val}}_b
 \qquad
p~C \vdash {\mathit{exprIL}}_l \hookrightarrow {\mathit{val}}_l
 \qquad
p~C \vdash {\mathit{exprIL}}_h \hookrightarrow {\mathit{val}}_h
 \qquad
{\mathit{val}} = {\mathit{val}}_b~{}[ {\mathit{val}}_l~:~{\mathit{val}}_h ]
}{
p~C \vdash {\mathit{exprIL}}_b~{}[ {\mathit{exprIL}}_l~:~{\mathit{exprIL}}_h ] \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}bitacce}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_b \hookrightarrow {\mathsf{stack}}{\mathsf{\_}}{\mathsf{v}}~{{\mathit{val}}^\ast}~{}[ i~@~s ]
}{
p~C \vdash {\mathit{exprIL}}_b {.} \mbox{\texttt{`size'}} \hookrightarrow {\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~s
} \, {[\textsc{\scriptsize Eval\_static{-}expracce{-}stack}]}
\qquad
\end{array}
$$

\vspace{1ex}

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{member}} = \mbox{\texttt{`minSizeInBits'}} \lor {\mathit{member}} = \mbox{\texttt{`minSizeInBytes'}} \lor {\mathit{member}} = \mbox{\texttt{`maxSizeInBits'}} \lor {\mathit{member}} = \mbox{\texttt{`maxSizeInBytes'}}
 \\
\mathsf{monod}~\tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
 \qquad
{\mathit{val}} = {{\mathit{member}}}{(\tau)}{}
\end{array}
}{
p~C \vdash {\mathit{name}} {.} {{\mathit{member}}}{\langle}{\epsilon}{\rangle}{(\epsilon)}{} \hookrightarrow {\mathit{val}}
} \, {[\textsc{\scriptsize Eval\_static{-}calltypee}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{void} : {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}voidt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{error} : {\mathsf{err}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}errt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{match\_kind} : {\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}matchkindt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{string} : {\mathsf{str}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}strt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{bool} : {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}boolt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{int} : {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}intt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \qquad
{\mathit{width}} = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
}{
p~C \vdash {\mathsf{int}}{\langle}{{\mathit{expr}}}{\rangle} : ({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{{\mathit{width}}}{\rangle})~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}fintt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \qquad
{\mathit{width}} = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
}{
p~C \vdash {\mathsf{bit}}{\langle}{{\mathit{expr}}}{\rangle} : ({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{{\mathit{width}}}{\rangle})~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}fbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \qquad
{\mathit{width}} = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
}{
p~C \vdash {\mathsf{varbit}}{\langle}{{\mathit{expr}}}{\rangle} : ({\mathsf{vbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{{\mathit{width}}}{\rangle})~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}vbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{type}} : \tau~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
 \\
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \qquad
{\mathit{size}} = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
 \\
{\delta_\texttt{polytyp}} = \mathsf{polyd}~(\mbox{\texttt{`T'}}, \epsilon) \rightarrow ({{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~\mbox{\texttt{`T'}})}{{}[ {\mathit{size}} ]})
\end{array}
}{
p~C \vdash {{\mathit{type}}}{{}[ {\mathit{expr}} ]} : ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{\tau}{\rangle})~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize Type\_ok{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{type}} : \tau~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
 \\
{\delta_\texttt{polytyp}} = \mathsf{polyd}~(\mbox{\texttt{`T'}}, \epsilon) \rightarrow ({\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~\mbox{\texttt{`T'}}))
\end{array}
}{
p~C \vdash {\mathsf{list}}{\langle}{{\mathit{type}}}{\rangle} : ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{\tau}{\rangle})~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize Type\_ok{-}listt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{type}} : \tau~{{\mathit{tid}}_{{\mathit{fresh}}_i}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_i}^\ast}^\ast}
 \\
(({\mathit{tid}} = \mbox{\texttt{`T'}}~i))^{i<{|{\tau^\ast}|}}
 \qquad
{\delta_\texttt{polytyp}} = \mathsf{polyd}~({{\mathit{tid}}^\ast}, \epsilon) \rightarrow ({\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}})^\ast})
\end{array}
}{
p~C \vdash {\mathsf{tuple}}{\langle}{{{\mathit{type}}^\ast}}{\rangle} : ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{{\tau^\ast}}{\rangle})~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize Type\_ok{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{monod}~\tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
}{
p~C \vdash {\mathit{name}} : \tau~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}namet{-}mono}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
 \qquad
{\delta_\texttt{polytyp}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau
}{
p~C \vdash {\mathit{name}} : ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{\epsilon}{\rangle})~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}namet{-}poly}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{monod}~\tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
}{
p~C \vdash {{\mathit{name}}}{\langle}{\epsilon}{\rangle} : \tau~\epsilon
} \, {[\textsc{\scriptsize Type\_ok{-}spect{-}mono}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
 \qquad
{\delta_\texttt{polytyp}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow \tau
 \\
(p~C \vdash {\mathit{type}} : {\tau}_a~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
\end{array}
}{
p~C \vdash {{\mathit{name}}}{\langle}{{{\mathit{type}}^\ast}}{\rangle} : ({{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{{\tau^\ast}}{\rangle})~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize Type\_ok{-}spect{-}poly}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{tid}} = {\mathsf{fresh}}{\mathsf{\_}}{\mathsf{tid}}
}{
p~C \vdash \mathsf{\_} : ({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}})~{\mathit{tid}}
} \, {[\textsc{\scriptsize Type\_ok{-}anyt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}{|_{\mathtt{canon}}} \leq {{\tau'}}{|_{\mathtt{canon}}}
}{
\tau \leq {\tau'}
} \, {[\textsc{\scriptsize Sub\_expl{-}canon}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau \approx {\tau'}
}{
\tau \leq {\tau'}
} \, {[\textsc{\scriptsize Sub\_expl{-}eq}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{1}{\rangle} \leq {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Sub\_expl{-}fbitt{-}boolt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}} \leq {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{1}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}boolt{-}fbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}} \leq {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Sub\_expl{-}intt{-}boolt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle} \leq {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}fintt{-}fbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle} \leq {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}fbitt{-}fintt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle} \leq {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{j}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}fbitt{-}fbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle} \leq {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{j}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}fintt{-}fintt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle} \leq {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Sub\_expl{-}fbitt{-}intt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle} \leq {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Sub\_expl{-}fintt{-}intt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}} \leq {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}intt{-}fbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}} \leq {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle}
} \, {[\textsc{\scriptsize Sub\_expl{-}intt{-}fintt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} \prec \tau
}{
{\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau'} \leq \tau
} \, {[\textsc{\scriptsize Sub\_expl{-}newt{-}innert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau \prec {\tau'}
}{
\tau \leq {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau'}
} \, {[\textsc{\scriptsize Sub\_expl{-}innert{-}newt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} \prec \tau
}{
{{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau'}~\{}{{\mathit{fields}}}{\}} \leq \tau
} \, {[\textsc{\scriptsize Sub\_expl{-}senumt{-}innert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau \prec {\tau'}
}{
\tau \leq {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau'}~\{}{{\mathit{fields}}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}innert{-}senumt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \leq {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqt{-}list}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \leq {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau''}^\ast}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqt{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{|{{\tau'}^\ast}|} \leq i
 \qquad
({\tau'} \leq {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}}{{}[ i ]}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqt{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \leq {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \leq {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~=~{\{~{{\mathit{member}''}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \leq {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}''} ]})^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \leq {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}recordt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~=~{\{~{{\mathit{member}''}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \leq {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}''} ]})^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \leq {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}recordt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau~\mathsf{is}~\mathsf{defaultable}
}{
{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}} \leq \tau
} \, {[\textsc{\scriptsize Sub\_expl{-}defaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau'}^\ast}|} < {|{{\tau''}^\ast}|}
 \qquad
({{\tau'''}^\ast}, {{\tau''''}^\ast}) = {\mathrm{partition}}(\tau, {{\tau''}^\ast}, {|{{\tau'}^\ast}|})
 \\
({\tau'} \leq {\tau''''})^\ast
 \qquad
(({\tau'''}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau''}^\ast}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqdefaultt{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{|{{\tau'}^\ast}|} < i
 \qquad
({\tau'} \leq {\tau''})^\ast
 \qquad
{\tau''}~\mathsf{is}~\mathsf{defaultable}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}}{{}[ i ]}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqdefaultt{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau'}^\ast}|} < {|{{\tau''}^\ast}|}
 \qquad
({{\tau'''}^\ast}, {{\tau''''}^\ast}) = {\mathrm{partition}}(\tau, {{\tau''}^\ast}, {|{{\tau'}^\ast}|})
 \\
({\tau'} \leq {\tau''''})^\ast
 \qquad
(({\tau'''}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqdefaultt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau'}^\ast}|} < {|{{\tau''}^\ast}|}
 \qquad
({{\tau'''}^\ast}, {{\tau''''}^\ast}) = {\mathrm{partition}}(\tau, {{\tau''}^\ast}, {|{{\tau'}^\ast}|})
 \\
({\tau'} \leq {\tau''''})^\ast
 \qquad
(({\tau'''}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \leq {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}seqdefaultt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~\subset~{\{~{{\mathit{member}''}^\ast}}{\}}
 \qquad
{\{~{{\mathit{member}'''}^\ast}}{\}} = {\{~{{\mathit{member}''}^\ast}}{\}}~\setminus~{\{~{{\mathit{member}'}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \leq {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'} ]})^\ast
 \\
(({{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'''} ]}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \leq {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}recorddefaultt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~\subset~{\{~{{\mathit{member}''}^\ast}}{\}}
 \qquad
{\{~{{\mathit{member}'''}^\ast}}{\}} = {\{~{{\mathit{member}''}^\ast}}{\}}~\setminus~{\{~{{\mathit{member}'}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \leq {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'} ]})^\ast
 \\
(({{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'''} ]}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \leq {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}recorddefaultt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}} \leq {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{\mathit{fields}}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}invalidt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}} \leq {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{\mathit{fields}}}{\}}
} \, {[\textsc{\scriptsize Sub\_expl{-}invalidt{-}uniont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} \leq {\tau''}
}{
{\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau'} \leq {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}
} \, {[\textsc{\scriptsize Sub\_expl{-}sett{-}sett}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} \leq {\tau''}
}{
{\tau'} \leq {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}
} \, {[\textsc{\scriptsize Sub\_expl{-}non{-}sett{-}sett}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}{|_{\mathtt{canon}}} \prec {{\tau'}}{|_{\mathtt{canon}}}
}{
\tau \prec {\tau'}
} \, {[\textsc{\scriptsize Sub\_impl{-}canon}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau \approx {\tau'}
}{
\tau \prec {\tau'}
} \, {[\textsc{\scriptsize Sub\_impl{-}eq}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}} \prec {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle}
} \, {[\textsc{\scriptsize Sub\_impl{-}intt{-}fbitt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}} \prec {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i}{\rangle}
} \, {[\textsc{\scriptsize Sub\_impl{-}intt{-}fintt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} \prec \tau
}{
{{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau'}~\{}{{\mathit{fields}}}{\}} \prec \tau
} \, {[\textsc{\scriptsize Sub\_impl{-}senumt{-}innert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \prec {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqt{-}list}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \prec {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau''}^\ast}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqt{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{|{{\tau'}^\ast}|} \leq i
 \qquad
({\tau'} \prec {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}}{{}[ i ]}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqt{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \prec {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \prec {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\tau'} \prec {\tau''})^\ast
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau''}^\ast}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqt{-}seqt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~=~{\{~{{\mathit{member}''}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \prec {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}''} ]})^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \prec {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}recordt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~=~{\{~{{\mathit{member}''}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \prec {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}''} ]})^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \prec {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}recordt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau~\mathsf{is}~\mathsf{defaultable}
}{
{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}} \prec \tau
} \, {[\textsc{\scriptsize Sub\_impl{-}defaultt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau'}^\ast}|} < {|{{\tau''}^\ast}|}
 \qquad
({{\tau'''}^\ast}, {{\tau''''}^\ast}) = {\mathrm{partition}}(\tau, {{\tau''}^\ast}, {|{{\tau'}^\ast}|})
 \\
({\tau'} \prec {\tau''''})^\ast
 \qquad
(({\tau'''}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau''}^\ast}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqdefaultt{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{|{{\tau'}^\ast}|} < i
 \qquad
({\tau'} \prec {\tau''})^\ast
 \qquad
{\tau''}~\mathsf{is}~\mathsf{defaultable}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau''}}{{}[ i ]}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqdefaultt{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau'}^\ast}|} < {|{{\tau''}^\ast}|}
 \qquad
({{\tau'''}^\ast}, {{\tau''''}^\ast}) = {\mathrm{partition}}(\tau, {{\tau''}^\ast}, {|{{\tau'}^\ast}|})
 \\
({\tau'} \prec {\tau''''})^\ast
 \qquad
(({\tau'''}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqdefaultt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau'}^\ast}|} < {|{{\tau''}^\ast}|}
 \qquad
({{\tau'''}^\ast}, {{\tau''''}^\ast}) = {\mathrm{partition}}(\tau, {{\tau''}^\ast}, {|{{\tau'}^\ast}|})
 \\
({\tau'} \prec {\tau''''})^\ast
 \qquad
(({\tau'''}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{{\tau'}^\ast} \prec {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}seqdefaultt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~\subset~{\{~{{\mathit{member}''}^\ast}}{\}}
 \qquad
{\{~{{\mathit{member}'''}^\ast}}{\}} = {\{~{{\mathit{member}''}^\ast}}{\}}~\setminus~{\{~{{\mathit{member}'}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \prec {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'} ]})^\ast
 \\
(({{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'''} ]}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \prec {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}recorddefaultt{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\{~{{\mathit{member}'}^\ast}}{\}}~\subset~{\{~{{\mathit{member}''}^\ast}}{\}}
 \qquad
{\{~{{\mathit{member}'''}^\ast}}{\}} = {\{~{{\mathit{member}''}^\ast}}{\}}~\setminus~{\{~{{\mathit{member}'}^\ast}}{\}}
 \\
({{\{}{{({\mathit{member}'}~\mapsto~{\tau'})^\ast}}{\}}}{{}[ {\mathit{member}'} ]} \prec {{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'} ]})^\ast
 \\
(({{\{}{{({\mathit{member}''}~\mapsto~{\tau''})^\ast}}{\}}}{{}[ {\mathit{member}'''} ]}~\mathsf{is}~\mathsf{defaultable}))^\ast
\end{array}
}{
{{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}'}, {\tau'})^\ast}}{\}} \prec {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}''}, {\tau''})^\ast}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}recorddefaultt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}} \prec {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{\mathit{fields}}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}invalidt{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
{\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}} \prec {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{\mathit{fields}}}{\}}
} \, {[\textsc{\scriptsize Sub\_impl{-}invalidt{-}uniont}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash b : (({\mathsf{bool}}{\mathsf{\_}}{\mathsf{v}}~b))~{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}boole}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash t : (({\mathsf{str}}{\mathsf{\_}}{\mathsf{v}}~t))~{\mathsf{str}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}stre}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash (i) : (({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~i))~{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}nume{-}intt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{bs}} = {\mathrm{of}}_{{\mathit{two}}_{\mathit{complement}}}(w, i)
}{
p~C \vdash ({w}{\mathsf{s}}{i}) : (({{\mathsf{fint}}{\mathsf{\_}}{\mathsf{v}}~w}{\mathsf{s}}{{\mathit{bs}}}))~({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle})~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}nume{-}fintt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{bs}} = {\mathrm{of}}_{{\mathit{two}}_{\mathit{complement}}}(w, i)
}{
p~C \vdash ({w}{\mathsf{w}}{i}) : (({{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{v}}~w}{\mathsf{w}}{{\mathit{bs}}}))~({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle})~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}nume{-}fbitt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau~{\mathit{dir}}~{\mathit{ctk}}~{{\mathit{val}}^?} = {C}{@}{p{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{name}} ]
}{
p~C \vdash {\mathit{name}} : ({\mathit{name}})~\tau~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}namee}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}})^\ast
 \qquad
{\mathit{ctk}}_e = {\sqcup_\texttt{ctk}}{{{\mathit{ctk}}^\ast}}
}{
p~C \vdash {\{}{{{\mathit{expr}}^\ast}}{\}} : ({\{}{{{\mathit{exprIL}}^\ast}}{\}})~({\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast})~{\mathit{ctk}}_e
} \, {[\textsc{\scriptsize Expr\_ok{-}seqe}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}})^\ast
 \qquad
{\mathit{ctk}}_e = {\sqcup_\texttt{ctk}}{{{\mathit{ctk}}^\ast}}
}{
p~C \vdash {\{}{{{\mathit{expr}}^\ast}}, {\ldots}\, \} : ({\{}{{{\mathit{exprIL}}^\ast}}, {\ldots}\, \})~({\mathsf{seq}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast})~{\mathit{ctk}}_e
} \, {[\textsc{\scriptsize Expr\_ok{-}seqdefaulte}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}})^\ast
 \qquad
{\mathit{ctk}}_e = {\sqcup_\texttt{ctk}}{{{\mathit{ctk}}^\ast}}
}{
p~C \vdash {\{}{{({\mathit{member}}, {\mathit{expr}})^\ast}}{\}} : ({\{}{{({\mathit{member}}, {\mathit{exprIL}})^\ast}}{\}})~({{\mathsf{record}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, \tau)^\ast}}{\}})~{\mathit{ctk}}_e
} \, {[\textsc{\scriptsize Expr\_ok{-}recorde}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
(p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}})^\ast
 \qquad
{\mathit{ctk}}_e = {\sqcup_\texttt{ctk}}{{{\mathit{ctk}}^\ast}}
}{
p~C \vdash {\{}{{({\mathit{member}}, {\mathit{expr}})^\ast}}, {\ldots}\, \} : ({\{}{{({\mathit{member}}, {\mathit{exprIL}}_e)^\ast}}{\}})~({{\mathsf{record}}{\mathsf{\_}}{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\{}{{({\mathit{member}}, {\tau}_e)^\ast}}{\}})~{\mathit{ctk}}_e
} \, {[\textsc{\scriptsize Expr\_ok{-}recorddefaulte}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash {\ldots}\,  : {\ldots}\, ~{\mathsf{default}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}defaulte}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{invalid} : ({\mathsf{invalid}}{\mathsf{\_}}{\mathsf{v}})~{\mathsf{invalid}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}invalide}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{bnot}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bnot}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bnot}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
({\mathit{exprIL}}_e, {\tau}_e) = \mathsf{reduce}~({\mathit{exprIL}}, \tau)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{bnot}}
}{
p~C \vdash {\sim}{{\mathit{expr}}} : ({\sim}{{\mathit{exprIL}}_e})~{\tau}_e~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}une{-}bnot}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{lnot}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{lnot}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
({\mathit{exprIL}}_e, {\tau}_e) = \mathsf{reduce}~({\mathit{exprIL}}, \tau)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{lnot}}
}{
p~C \vdash {!}{{\mathit{expr}}} : ({!}{{\mathit{exprIL}}_e})~{\tau}_e~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}une{-}lnot}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{uplus}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{uplus}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{uplus}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{uplus}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
({\mathit{exprIL}}_e, {\tau}_e) = \mathsf{reduce}~({\mathit{exprIL}}, \tau)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{uplus}}
}{
p~C \vdash {+}{{\mathit{expr}}} : ({+}{{\mathit{exprIL}}_e})~{\tau}_e~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}une{-}uplus}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{uminus}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{uminus}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{uminus}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{uminus}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
({\mathit{exprIL}}_e, {\tau}_e) = \mathsf{reduce}~({\mathit{exprIL}}, \tau)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{uminus}}
}{
p~C \vdash {-}{{\mathit{expr}}} : ({+}{{\mathit{exprIL}}_e})~{\tau}_e~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}une{-}uminus}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{plusminusmult}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{plusminusmult}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{plusminusmult}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{plusminusmult}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~+}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
(({\mathit{exprIL}}_{l''}, {\tau''}), ({\mathit{exprIL}}_{r''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{l'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{r'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{plusminusmult}}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l''}~{\mathit{binop}}~{\mathit{exprIL}}_{r''})~{\tau''}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}plus{-}minus{-}mult}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{satplusminus}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{satplusminus}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{satplusminus}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~{|}{+}{|}}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
(({\mathit{exprIL}}_{l''}, {\tau''}), ({\mathit{exprIL}}_{r''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{l'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{r'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{satplusminus}}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l''}~{\mathit{binop}}~{\mathit{exprIL}}_{r''})~{\tau''}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}sat{-}plus{-}minus}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{divmod}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{divmod}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~/}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
(({\mathit{exprIL}}_{l''}, {\tau''}), ({\mathit{exprIL}}_{r''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{l'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{r'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{divmod}}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l''}~{\mathit{binop}}~{\mathit{exprIL}}_{r''})~\tau~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}div{-}mod}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{shift}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~<\!<}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
(({\mathit{exprIL}}_{l'}, {\tau}_{l'}), ({\mathit{exprIL}}_{r'}, {\tau}_{r'})) = \mathsf{reduce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{shift}}
 \\
{\tau}_{r'}~\mathsf{is}~\mathsf{fint\_t} \lor {\tau}_{r'}~\mathsf{is}~\mathsf{int\_t}~\Rightarrow~{\mathit{ctk}}_r = \mathsf{lctk}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l'}~{\mathit{binop}}~{\mathit{exprIL}}_{r'})~{\tau}_{l'}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}shift}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\tau~\mathsf{is}~\mathsf{equalable} & = & {\mathrm{equalable}'}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{equalable}'}({\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{false} \\
{\mathrm{equalable}'}({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}) & = & \mathsf{false} \\
{\mathrm{equalable}'}({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\mathit{fmap}}) & = & \mathsf{false} \\
{\mathrm{equalable}'}({\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})) & = & \mathsf{false} \\
{\mathrm{equalable}'}({\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})) & = & \mathsf{false} \\
{\mathrm{equalable}'}({\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{\tau^\ast}) & = & \mathsf{false} \\
{\mathrm{equalable}'}({\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}) & = & \mathsf{false} \\
{\mathrm{equalable}'}(\tau_\texttt{synth}) & = & \tau_\texttt{synth}~\mathsf{is}~\mathsf{seq\_t} \lor \tau_\texttt{synth}~\mathsf{is}~\mathsf{record\_t} \\
{\mathrm{equalable}'}(\tau) & = & \mathsf{true} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~==}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
{\tau'}~\mathsf{is}~\mathsf{equalable}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l'}~{\mathit{binop}}~{\mathit{exprIL}}_{r'})~\tau~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}compare{-}eq}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{compare}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{compare}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{compare}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{compare}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~\leq}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
(({\mathit{exprIL}}_{l''}, {\tau''}), ({\mathit{exprIL}}_{r''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{l'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{r'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{compare}}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l''}~{\mathit{binop}}~{\mathit{exprIL}}_{r''})~{\tau''}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}compare}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{bitwise}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitwise}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitwise}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~\&}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
(({\mathit{exprIL}}_{l''}, {\tau''}), ({\mathit{exprIL}}_{r''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{l'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{r'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{bitwise}}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l''}~{\mathit{binop}}~{\mathit{exprIL}}_{r''})~{\tau''}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}bitwise}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{concat}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{concat}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{concat}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{concat}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_l}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w_r}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{concat}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
(({\mathit{exprIL}}_{l'}, {\tau}_{l'}), ({\mathit{exprIL}}_{r'}, {\tau}_{r'})) = \mathsf{reduce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{concat}}
 \\
w = {\mathrm{get}}_{\mathit{width}}({\tau}_{l'}) + {\mathrm{get}}_{\mathit{width}}({\tau}_{r'})
 \qquad
{\tau}_{l'}~\mathsf{is}~\mathsf{fint\_t}~\Rightarrow~{\tau''} = {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}
 \qquad
{\tau}_{l'}~\mathsf{is}~\mathsf{fbit\_t}~\Rightarrow~{\tau''} = {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~++~{\mathit{expr}}_r : ({\mathit{exprIL}}_{l'}~{\mathit{binop}}~{\mathit{exprIL}}_{r'})~{\tau''}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}concat}]}
\qquad
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{logical}}({\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{logical}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{binop}}~\in~{\{~\&\&}{\}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~{\mathit{ctk}}_l
 \qquad
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
({\tau'}, {\mathit{exprIL}}_{l'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{and}~({\mathit{exprIL}}_r, {\tau}_r)
 \\
(({\mathit{exprIL}}_{l''}, {\tau}_{l''}), ({\mathit{exprIL}}_{r''}, {\tau}_{r''})) = \mathsf{reduce}~({\mathit{exprIL}}_{l'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{r'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{logical}}
 \\
{\mathit{ctk}} = {\mathit{ctk}}_l~\sqcup_\texttt{ctk}~{\mathit{ctk}}_r
\end{array}
}{
p~C \vdash {\mathit{expr}}_l~{\mathit{binop}}~{\mathit{expr}}_r : ({\mathit{exprIL}}_l~{\mathit{binop}}~{\mathit{exprIL}}_r)~{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}bine{-}logical}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_c : {\mathit{exprIL}}_c~{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{ctk}}_c
 \\
p~C \vdash {\mathit{expr}}_t : {\mathit{exprIL}}_t~{\tau}_t~{\mathit{ctk}}_t
 \qquad
p~C \vdash {\mathit{expr}}_f : {\mathit{exprIL}}_f~{\tau}_f~{\mathit{ctk}}_f
 \\
({\tau'}, {\mathit{exprIL}}_{t'}, {\mathit{exprIL}}_{r'}) = \mathsf{coerce}~({\mathit{exprIL}}_t, {\tau}_t)~\mathsf{and}~({\mathit{exprIL}}_f, {\tau}_f)
 \\
{\tau'}~\mathsf{is}~\mathsf{int\_t}~\Rightarrow~{\mathit{ctk}}_c = \mathsf{ctk} \lor {\mathit{ctk}}_c = \mathsf{lctk}
 \\
{\mathit{ctk}} = {\sqcup_\texttt{ctk}}{{\mathit{ctk}}_c~{\mathit{ctk}}_t~{\mathit{ctk}}_f}
\end{array}
}{
p~C \vdash ({\mathit{expr}}_c~?~{\mathit{expr}}_t~:~{\mathit{expr}}_f) : (({\mathit{exprIL}}_c~?~{\mathit{exprIL}}_{t'}~:~{\mathit{exprIL}}_{f'}))~{\tau'}~{\mathit{ctk}}
} \, {[\textsc{\scriptsize Expr\_ok{-}terne}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{type}} : \tau~\epsilon
 \qquad
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{\tau}_b \leq {\tau}_t
}{
p~C \vdash ({\mathit{type}})~{\mathit{expr}}_b : ((\tau)~{\mathit{exprIL}}_b)~\tau~{\mathit{ctk}}_b
} \, {[\textsc{\scriptsize Expr\_ok{-}caste}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{mask}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{mask}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{mask}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{mask}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
p~C \vdash {\mathit{expr}}_m : {\mathit{exprIL}}_m~{\tau}_m~{\mathit{ctk}}_m
 \\
({\tau'}, {\mathit{exprIL}}_{b'}, {\mathit{exprIL}}_{m'}) = \mathsf{coerce}~({\mathit{exprIL}}_b, {\tau}_b)~\mathsf{and}~({\mathit{exprIL}}_m, {\tau}_m)
 \\
(({\mathit{exprIL}}_{b''}, {\tau''}), ({\mathit{exprIL}}_{m''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{b'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{m'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{mask}}
 \\
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~\&\&\&~{\mathit{expr}}_m : ({\mathit{exprIL}}_{b''}~\&\&\&~{\mathit{exprIL}}_{m''})~({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau''})~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}maske}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{range}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}, {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{range}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{range}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}, {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{range}}({\tau}_l, {\tau}_r) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_{\mathit{lb}} : {\mathit{exprIL}}_{\mathit{lb}}~{\tau}_{\mathit{lb}}~{\mathit{ctk}}_{\mathit{lb}}
 \qquad
p~C \vdash {\mathit{expr}}_{\mathit{ub}} : {\mathit{exprIL}}_{\mathit{ub}}~{\tau}_{\mathit{ub}}~{\mathit{ctk}}_{\mathit{ub}}
 \\
({\tau'}, {\mathit{exprIL}}_{\mathit{ub}'}, {\mathit{exprIL}}_{\mathit{lb}'}) = \mathsf{coerce}~({\mathit{exprIL}}_{\mathit{lb}}, {\tau}_{\mathit{lb}})~\mathsf{and}~({\mathit{exprIL}}_{\mathit{ub}}, {\tau}_{\mathit{ub}})
 \\
(({\mathit{exprIL}}_{\mathit{lb}''}, {\tau''}), ({\mathit{exprIL}}_{\mathit{ub}''}, {\tau''})) = \mathsf{reduce}~({\mathit{exprIL}}_{\mathit{lb}'}, {\tau'})~\mathsf{and}~({\mathit{exprIL}}_{\mathit{ub}'}, {\tau'})~\mathsf{under}~{\mathrm{compatible}}_{\mathit{range}}
 \\
\end{array}
}{
p~C \vdash {\mathit{expr}}_{\mathit{lb}} \ldots {\mathit{expr}}_{\mathit{ub}} : ({\mathit{exprIL}}_{\mathit{lb}''} \ldots {\mathit{exprIL}}_{\mathit{ub}''})~({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau''})~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}rangee}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~\tau \vdash {\mathit{keyset}} : {\mathit{keysetIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathsf{local}~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau)~{\mathit{ctk}}
 \\
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau)~{\mathit{to}}~{\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_k
\end{array}
}{
\mathsf{local}~C~{\tau}_k \vdash {\mathit{expr}} : {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Select\_case\_keyset\_ok{-}exprk{-}sett}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathsf{local}~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
{\neg\tau~\mathsf{is}~\mathsf{set\_t}}
 \\
\tau \prec {\tau}_k
 \qquad
{\mathit{exprIL}'} = (({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_k))~{\mathit{exprIL}}
\end{array}
}{
\mathsf{local}~C~{\tau}_k \vdash {\mathit{expr}} : {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Select\_case\_keyset\_ok{-}exprk{-}not{-}sett}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathsf{local}~C~{\tau}_k \vdash \mathsf{default} : \mathsf{default}
} \, {[\textsc{\scriptsize Select\_case\_keyset\_ok{-}defaultk}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
\mathsf{local}~C~{\tau}_k \vdash \mathsf{\_} : \mathsf{\_}
} \, {[\textsc{\scriptsize Select\_case\_keyset\_ok{-}anyk}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\tau^\ast}~{{\mathit{keyset}}^\ast} : {{\mathit{keysetIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\tau}_k \vdash {\mathit{keyset}} : {\mathit{keysetIL}}
}{
p~C \vdash {\tau}_k~{\mathit{keyset}} : {\mathit{keysetIL}}
} \, {[\textsc{\scriptsize Select\_case\_keysets\_ok{-}one{-}to{-}one}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~({\mathsf{seq}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_k^\ast}) \vdash {\mathit{keyset}} : {\mathit{keysetIL}}
}{
p~C \vdash {{\tau}_k^\ast}~{\mathit{keyset}} : {\mathit{keysetIL}}
} \, {[\textsc{\scriptsize Select\_case\_keysets\_ok{-}many{-}to{-}one}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{|{{\tau}_k^\ast}|} = {|{{\mathit{keyset}}^\ast}|}
 \qquad
(p~C~{\tau}_k \vdash {\mathit{keyset}} : {\mathit{keysetIL}})^\ast
}{
p~C \vdash {{\tau}_k^\ast}~{{\mathit{keyset}}^\ast} : {{\mathit{keysetIL}}^\ast}
} \, {[\textsc{\scriptsize Select\_case\_keysets\_ok{-}many{-}to{-}many}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\tau^\ast} \vdash {\mathit{selectcase}} : {\mathit{selectcaseIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{local}~C \vdash {{\tau}_k^\ast}~{{\mathit{keyset}}^\ast} : {{\mathit{keysetIL}}^\ast}
 \qquad
{\mathsf{state}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{dir}''}~{\mathit{ctk}''}~\epsilon = {C}{@}{\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{statelabel}} ]
}{
\mathsf{local}~C~{{\tau}_k^\ast} \vdash {{\mathit{keyset}}^\ast}~{\mathit{statelabel}} : {{\mathit{keysetIL}}^\ast}~{\mathit{statelabel}}
} \, {[\textsc{\scriptsize Select\_case\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
C{.}\mathsf{local}{.}\mathsf{kind} = \mathsf{parserstate}
 \qquad
(\mathsf{local}~C \vdash {\mathit{expr}}_k : {\mathit{exprIL}}_k~{\tau}_k~{\mathit{ctk}}_k)^\ast
 \\
({\mathrm{bound}}_{\mathit{tid}}(\mathsf{local}, C) \vdash {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_k)^\ast
 \\
(\mathsf{local}~C~{{\tau}_k^\ast} \vdash {\mathit{selectcase}} : {\mathit{selectcaseIL}})^\ast
\end{array}
}{
\mathsf{local}~C \vdash {\mathsf{select}~({{\mathit{expr}}_k^\ast})~\{}{{{\mathit{selectcase}}^\ast}}{\}} : ({\mathsf{select}~({{\mathit{exprIL}}_k^\ast})~\{}{{{\mathit{selectcaseIL}}^\ast}}{\}})~{\mathsf{state}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}selecte}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{arrayindex}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{arrayindex}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{arrayindex}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{arrayindex}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
p~C \vdash {\mathit{expr}}_i : {\mathit{exprIL}}_i~{\tau}_i~{\mathit{ctk}}_i
 \\
({\mathit{exprIL}}_{i'}, {\tau}_{i'}) = \mathsf{reduce}~({\mathit{exprIL}}_i, {\tau}_i)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{arrayindex}}
 \\
{\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\mathit{typs}}_{b'}^\ast} = {{\tau}_b}{|_{\mathtt{canon}}}
 \qquad
p~C \vdash {\mathit{exprIL}}_{i'} \hookrightarrow {\mathit{val}}_i
 \qquad
i = {\mathrm{get}}_{\mathit{num}}({\mathit{val}}_i)
 \qquad
\tau = {{\mathit{typs}}_{b'}^\ast}{}[i]
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{}[ {\mathit{expr}}_i ] : ({\mathit{exprIL}}_b~{}[ {\mathit{exprIL}}_{i'} ])~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}arracce{-}tuplet}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
p~C \vdash {\mathit{expr}}_i : {\mathit{exprIL}}_i~{\tau}_i~\mathsf{lctk}
 \\
({\mathit{exprIL}}_{i'}, {\tau}_{i'}) = \mathsf{reduce}~({\mathit{exprIL}}_i, {\tau}_i)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{arrayindex}}
 \\
{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_{b'}}{{}[ {\mathit{size}} ]} = {{\tau}_b}{|_{\mathtt{canon}}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{}[ {\mathit{expr}}_i ] : ({\mathit{exprIL}}_b~{}[ {\mathit{exprIL}}_{i'} ])~{\tau}_{b'}~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}arracce{-}stackt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{bitstringbase}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitstringbase}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & w > 0 \\
{\mathrm{compatible}}_{\mathit{bitstringbase}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitstringbase}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{compatible}}_{\mathit{bitstringindex}}({\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitstringindex}}({\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitstringindex}}({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle}) & = & \mathsf{true} \\
{\mathrm{compatible}}_{\mathit{bitstringindex}}(\tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \\
({\mathit{exprIL}}_{b'}, {\tau}_{b'}) = \mathsf{reduce}~({\mathit{exprIL}}_b, {\tau}_b)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{bitstringbase}}
 \\
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~\mathsf{lctk}
 \\
({\mathit{exprIL}}_{l'}, {\tau}_{l'}) = \mathsf{reduce}~({\mathit{exprIL}}_l, {\tau}_l)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{bitstringindex}}
 \\
p~C \vdash {\mathit{exprIL}}_{l'} \hookrightarrow {\mathit{val}}_l
 \qquad
i_l = {\mathrm{get}}_{\mathit{num}}({\mathit{val}}_l)
 \\
p~C \vdash {\mathit{expr}}_h : {\mathit{exprIL}}_h~{\tau}_h~\mathsf{lctk}
 \\
({\mathit{exprIL}}_{h'}, {\tau}_{h'}) = \mathsf{reduce}~({\mathit{exprIL}}_h, {\tau}_h)~\mathsf{under}~{\mathrm{compatible}}_{\mathit{bitstringindex}}
 \\
p~C \vdash {\mathit{exprIL}}_{h'} \hookrightarrow {\mathit{val}}_h
 \qquad
i_h = {\mathrm{get}}_{\mathit{num}}({\mathit{val}}_h)
 \\
\tau = {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{i_h - i_l + 1}{\rangle}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{}[ {\mathit{expr}}_l~:~{\mathit{expr}}_h ] : ({\mathit{exprIL}}_{b'}~{}[ ({\mathit{val}}_l)~:~({\mathit{val}}_r) ])~\tau~{\mathit{ctk}}_b
} \, {[\textsc{\scriptsize Expr\_ok{-}bitacce}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}} = \mbox{\texttt{`error.'}}~{\mathit{member}}
 \qquad
{\mathsf{err}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{member}} = {C}{@}{p{.}\mathsf{frame}}~{}[ {{.}}\, {\mathit{id}} ]
}{
p~C \vdash \mathsf{error} {.} {\mathit{member}} : (({\mathsf{err}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{member}}))~{\mathsf{err}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}erracce}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{monod}~\tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
 \qquad
{{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_t~\{}{{{\mathit{member}}_t^\ast}}{\}} = {\tau}{|_{\mathtt{canon}}}
 \qquad
{\mathit{member}} \in {{\mathit{member}}_t^\ast}
}{
p~C \vdash {\mathit{name}} {.} {\mathit{member}} : (({\mathsf{enum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}_t {.} {\mathit{member}}))~\tau~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}typeacce{-}enumt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{monod}~\tau = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
 \qquad
{{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_t~{\tau}_t~\{}{{({\mathit{member}}_t, {\mathit{val}}_t)^\ast}}{\}} = {\tau}{|_{\mathtt{canon}}}
 \qquad
({\mathit{member}}, {\mathit{val}}) \in {({\mathit{member}}_t, {\mathit{val}}_t)^\ast}
}{
p~C \vdash {\mathit{name}} {.} {\mathit{member}} : (({\mathsf{senum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}_t {.} {\mathit{member}}~({\mathit{val}})))~\tau~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}typeacce{-}senumt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_s}{{}[ {\mathit{size}}_s ]} = {{\tau}_b}{|_{\mathtt{canon}}}
}{
p~C \vdash {\mathit{expr}}_b {.} \mbox{\texttt{`size'}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{32}{\rangle})~\mathsf{lctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}stackt{-}size}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p = \mathsf{block} \land C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{parser}) \lor (p = \mathsf{local} \land C{.}\mathsf{local}{.}\mathsf{kind} = \mathsf{parserstate})
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_s}{{}[ {\mathit{size}}_s ]} = {{\tau}_b}{|_{\mathtt{canon}}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b {.} \mbox{\texttt{`lastIndex'}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~({\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{32}{\rangle})~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}stackt{-}lastindex}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p = \mathsf{block} \land C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{parser}) \lor (p = \mathsf{local} \land C{.}\mathsf{local}{.}\mathsf{kind} = \mathsf{parserstate})
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_s}{{}[ {\mathit{size}}_s ]} = {{\tau}_b}{|_{\mathtt{canon}}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b {.} \mbox{\texttt{`last'}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~{\tau}_s~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}stackt{-}last}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_s}{{}[ {\mathit{size}}_s ]} = {{\tau}_b}{|_{\mathtt{canon}}}
}{
p~C \vdash {\mathit{expr}}_b {.} \mbox{\texttt{`next'}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~{\tau}_s~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}stackt{-}next}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_s~\{}{{({\mathit{member}}_s, {\tau}_s)^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
({\mathit{member}}, \tau) \in {({\mathit{member}}_s, {\tau}_s)^\ast}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b {.} {\mathit{member}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}structt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_h~\{}{{({\mathit{member}}_h, {\tau}_h)^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
({\mathit{member}}, \tau) \in {({\mathit{member}}_h, {\tau}_h)^\ast}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b {.} {\mathit{member}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}headert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_u~\{}{{({\mathit{member}}_u, {\tau}_u)^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
({\mathit{member}}, \tau) \in {({\mathit{member}}_u, {\tau}_u)^\ast}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b {.} {\mathit{member}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}uniont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_t~\{}{{({\mathit{member}}_t, {\tau}_t)^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
({\mathit{member}}, \tau) \in {({\mathit{member}}_t, {\tau}_t)^\ast}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b {.} {\mathit{member}} : ({\mathit{exprIL}}_b {.} {\mathit{member}})~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}expracce{-}tablestructt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
{{\mathit{tid}}_{\mathit{fresh}'}^\ast} = {\bigoplus}\, {{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}
 \\
p~C \vdash \tau_\texttt{f}~{{\mathit{tid}}_{\mathit{fresh}'}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
 \qquad
\tau \neq {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}
\end{array}
}{
p~C \vdash {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{({{\mathit{arg}}^\ast})}{} : ({{\mathit{name}}}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle}{({{\mathit{argIL}'}^\ast})}{})~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}callfunce}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{expr}}_b~{\mathit{member}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{\mathit{exprIL}}_b~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
{{\mathit{tid}}_{\mathit{fresh}'}^\ast} = {\bigoplus}\, {{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}
 \\
p~C \vdash \tau_\texttt{f}~{{\mathit{tid}}_{\mathit{fresh}'}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
 \qquad
\tau \neq {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}
\end{array}
}{
p~C \vdash {{\mathit{expr}}_b}{\langle}{{{\mathit{targ}}^\ast}}{\rangle} {.} {{\mathit{member}}}{({{\mathit{arg}}^\ast})}{} : ({\mathit{exprIL}}_b {.} {{\mathit{member}}}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle}{({{\mathit{argIL}'}^\ast})}{})~\tau~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}callmethode}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\delta_\texttt{typ} = {C}{@}{p{.}\mathsf{tdenv}}~{}[ {\mathit{name}} ]
 \\
{\mathit{member}}~\in~{\{~\mbox{\texttt{`minSizeInBits'}}}{\}}
 \\
\tau_\texttt{f} = {\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~(\epsilon) \rightarrow {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}
 \\
p~C \vdash \tau_\texttt{f}~\epsilon~\epsilon~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~\epsilon : {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}~\epsilon~{{\mathit{argIL}'}^\ast}
\end{array}
}{
p~C \vdash {{\mathit{name}}}{\langle}{\epsilon}{\rangle} {.} {{\mathit{member}}}{({{\mathit{arg}}^\ast})}{} : ({\mathit{name}} {.} {{\mathit{member}}}{\langle}{\epsilon}{\rangle}{({{\mathit{argIL}'}^\ast})}{})~{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{dyn}
} \, {[\textsc{\scriptsize Expr\_ok{-}calltypee}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{cons}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
{{\mathit{tid}}_{\mathit{fresh}'}^\ast} = {\bigoplus}\, {{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}
 \\
p~C \vdash \tau_\texttt{cons}~{{\mathit{tid}}_{\mathit{fresh}'}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
\end{array}
}{
p~C \vdash {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{({{\mathit{arg}}^\ast})}{} : ({{\mathit{name}}}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle}{({{\mathit{argIL}'}^\ast})}{})~\tau~\mathsf{ctk}
} \, {[\textsc{\scriptsize Expr\_ok{-}inste}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
}{
p~C \vdash {\mathit{expr}} : ({\mathit{exprIL}})~\tau
} \, {[\textsc{\scriptsize Arg\_ok{-}expra}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
}{
p~C \vdash {\mathit{id}} = {\mathit{expr}} : ({\mathit{id}} = {\mathit{exprIL}})~\tau
} \, {[\textsc{\scriptsize Arg\_ok{-}namea{-}some}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash {\mathit{id}} = \epsilon : ({\mathit{id}} = \epsilon)~{\mathsf{any}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Arg\_ok{-}expra{-}none}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \mathsf{\_} : \mathsf{\_}~{\mathsf{any}}{\mathsf{\_}}{\mathsf{t}}
} \, {[\textsc{\scriptsize Arg\_ok{-}anya}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~f \vdash \mathsf{empty} : C~f~\mathsf{empty}
} \, {[\textsc{\scriptsize Stmt\_ok{-}emptys}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\tau~\mathsf{is}~\mathsf{assignable} & = & {\mathrm{assignable}'}({\tau}{|_{\mathtt{canon}}}) \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathrm{assignable}'}({\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}) & = & \mathsf{false} \\
{\mathrm{assignable}'}(\tau_\texttt{obj}) & = & \mathsf{false} \\
{\mathrm{assignable}'}(\tau_\texttt{synth}) & = & \mathsf{false} \\
{\mathrm{assignable}'}(\tau) & = & \mathsf{true} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\tau~{\mathit{dir}}~{\mathit{ctk}}~{{\mathit{val}}^?} = {C}{@}{p{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{name}} ]
 \qquad
{\mathit{dir}} = \mathsf{out} \lor {\mathit{dir}} = \mathsf{inout}
 \qquad
\tau~\mathsf{is}~\mathsf{assignable}
}{
p~C \vdash {\mathit{name}}
} \, {[\textsc{\scriptsize Lval\_ok{-}namee}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_b
}{
p~C \vdash {\mathit{exprIL}}_b~{}[ {\mathit{exprIL}}_i ]
} \, {[\textsc{\scriptsize Lval\_ok{-}arracce}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_b
}{
p~C \vdash {\mathit{exprIL}}_b~{}[ {\mathit{exprIL}}_l~:~{\mathit{exprIL}}_h ]
} \, {[\textsc{\scriptsize Lval\_ok{-}bitacce}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{exprIL}}_b
}{
p~C \vdash {\mathit{exprIL}}_b {.} {\mathit{member}}
} \, {[\textsc{\scriptsize Lval\_ok{-}expracce}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_l : {\mathit{exprIL}}_l~{\tau}_l~\mathsf{dyn}
 \qquad
p~C \vdash {\mathit{exprIL}}_l
 \\
p~C \vdash {\mathit{expr}}_r : {\mathit{exprIL}}_r~{\tau}_r~{\mathit{ctk}}_r
 \\
{\mathit{exprIL}}_{r'} = \mathsf{coerce}~({\mathit{exprIL}}_r, {\tau}_r)~{\mathit{to}}~{\tau}_l
\end{array}
}{
p~C~f \vdash {\mathit{expr}}_l = {\mathit{expr}}_r : C~f~({\mathit{exprIL}}_l = {\mathit{exprIL}}_{r'})
} \, {[\textsc{\scriptsize Stmt\_ok{-}assigns}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{id}} \vdash {\mathit{switchlabel}} : {\mathit{switchlabelIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{id}}_e = \mbox{\texttt{`action\_list('}}~{\mathit{id}}_t~\mbox{\texttt{`)'}}
 \qquad
{\mathit{id}} = {\mathit{id}}_e~\mbox{\texttt{`.'}}~{\mathit{id}}_a
 \qquad
{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}_e {.} {\mathit{id}}_a = {C}{@}{p{.}\mathsf{frame}}~{}[ {\mathit{id}} ]
}{
p~C~{\mathit{id}}_t \vdash (({\mathit{id}}_a)) : (({\mathit{id}}_a))
} \, {[\textsc{\scriptsize Switch\_tbl\_label\_ok{-}exprl}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{id}}_t \vdash \mathsf{default} : \mathsf{default}
} \, {[\textsc{\scriptsize Switch\_tbl\_label\_ok{-}defaultl}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}}~{\mathit{id}} \vdash {\mathit{switchcase}} : {\mathit{flow}}~{\mathit{switchcaseIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{id}}_t \vdash {\mathit{switchlabel}} : {\mathit{switchlabelIL}}
 \qquad
p~C~f~\mathsf{noinit} \vdash {\mathit{block}} : {C'}~{f'}~{\mathit{blockIL}}
}{
p~C~f~{\mathit{id}}_t \vdash \mathsf{case}~{\mathit{switchlabel}}~{\mathit{block}} : {f'}~(\mathsf{case}~{\mathit{switchlabelIL}}~{\mathit{blockIL}})
} \, {[\textsc{\scriptsize Switch\_tbl\_case\_ok{-}matchc}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{id}}_t \vdash {\mathit{switchlabel}} : {\mathit{switchlabelIL}}
}{
p~C~f~{\mathit{id}}_t \vdash \mathsf{case}~{\mathit{switchlabel}} : f~(\mathsf{case}~{\mathit{switchlabelIL}})
} \, {[\textsc{\scriptsize Switch\_tbl\_case\_ok{-}fallc}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}}~{\mathit{id}} \vdash {{\mathit{switchcase}}^\ast} : {\mathit{flow}}~{{\mathit{switchcaseIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~f~{\mathit{id}}_t \vdash \epsilon : f~\epsilon
} \, {[\textsc{\scriptsize Switch\_tbl\_cases\_ok{-}empty}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~f~{\mathit{id}}_t \vdash {\mathit{switchcase}}_h : {f'}~{\mathit{switchcaseIL}}_h
 \qquad
p~C~{f'}~{\mathit{id}}_t \vdash {{\mathit{switchcase}}_t^\ast} : {f''}~{{\mathit{switchcaseIL}}_t^\ast}
}{
p~C~f~{\mathit{id}}_t \vdash {\mathit{switchcase}}_h~{{\mathit{switchcase}}_t^\ast} : {f''}~({\mathit{switchcaseIL}}_h~{{\mathit{switchcaseIL}}_t^\ast})
} \, {[\textsc{\scriptsize Switch\_tbl\_cases\_ok{-}seq}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~({{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{\mathit{member}}}{\}})~{\mathit{ctk}}
 \qquad
{\mathit{id}} = \mbox{\texttt{`action\_list('}}~{\mathit{id}}_t~\mbox{\texttt{`)'}}
 \qquad
p~C~f~{\mathit{id}}_t \vdash {{\mathit{switchcase}}^\ast} : {f'}~{{\mathit{switchcaseIL}}^\ast}
}{
p~C~f \vdash {\mathsf{switch}~({\mathit{expr}})~\{}{{{\mathit{switchcase}}^\ast}}{\}} : C~{f'}~({\mathsf{switch}~({\mathit{exprIL}})~\{}{{{\mathit{switchcaseIL}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Stmt\_ok{-}switchs{-}tbl}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~\tau \vdash {\mathit{switchlabel}} : {\mathit{switchlabelIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, \tau)~{\mathit{to}}~{\tau}_s
}{
p~C~{\tau}_s \vdash {\mathit{expr}} : {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Switch\_gen\_label\_ok{-}exprl}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\tau}_s \vdash \mathsf{default} : \mathsf{default}
} \, {[\textsc{\scriptsize Switch\_gen\_label\_ok{-}defaultl}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}}~\tau \vdash {\mathit{switchcase}} : {\mathit{flow}}~{\mathit{switchcaseIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\tau}_s \vdash {\mathit{switchlabel}} : {\mathit{switchlabelIL}}
 \qquad
p~C~f~\mathsf{noinit} \vdash {\mathit{block}} : {C'}~{f'}~{\mathit{blockIL}}
}{
p~C~f~{\tau}_s \vdash \mathsf{case}~{\mathit{switchlabel}}~{\mathit{block}} : {f'}~(\mathsf{case}~{\mathit{switchlabelIL}}~{\mathit{blockIL}})
} \, {[\textsc{\scriptsize Switch\_gen\_case\_ok{-}matchc}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\tau}_s \vdash {\mathit{switchlabel}} : {\mathit{switchlabelIL}}
}{
p~C~f~{\tau}_s \vdash \mathsf{case}~{\mathit{switchlabel}} : f~(\mathsf{case}~{\mathit{switchlabelIL}})
} \, {[\textsc{\scriptsize Switch\_gen\_case\_ok{-}fallc}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{flow}}~\tau \vdash {{\mathit{switchcase}}^\ast} : {\mathit{flow}}~{{\mathit{switchcaseIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~f~{\tau}_s \vdash \epsilon : f~\epsilon
} \, {[\textsc{\scriptsize Switch\_gen\_cases\_ok{-}empty}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~f~{\tau}_s \vdash {\mathit{switchcase}}_h : {f'}~{\mathit{switchcaseIL}}_h
 \qquad
p~C~{f'}~{\tau}_s \vdash {{\mathit{switchcase}}_t^\ast} : {f''}~{{\mathit{switchcaseIL}}_t^\ast}
}{
p~C~f~{\tau}_s \vdash {\mathit{switchcase}}_h~{{\mathit{switchcase}}_t^\ast} : {f''}~({\mathit{switchcaseIL}}_h~{{\mathit{switchcaseIL}}_t^\ast})
} \, {[\textsc{\scriptsize Switch\_gen\_cases\_ok{-}seq}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \\
{\tau'} = {\tau}{|_{\mathtt{canon}}}
 \qquad
{\tau'} = {\mathsf{err}}{\mathsf{\_}}{\mathsf{t}} \lor {\tau'} = {\mathsf{fint}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle} \lor {\tau'} = {\mathsf{fbit}}{\mathsf{\_}}{\mathsf{t}}{\langle}{w}{\rangle} \lor {\tau'} = {{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}} \lor {\tau'} = {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau'}~\{}{{({\mathit{member}}, {\mathit{val}})^\ast}}{\}}
 \\
p~C~f~\tau \vdash {{\mathit{switchcase}}^\ast} : {f'}~{{\mathit{switchcaseIL}}^\ast}
\end{array}
}{
p~C~f \vdash {\mathsf{switch}~({\mathit{expr}})~\{}{{{\mathit{switchcase}}^\ast}}{\}} : C~{f'}~({\mathsf{switch}~({\mathit{exprIL}})~\{}{{{\mathit{switchcaseIL}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Stmt\_ok{-}switchs{-}gen}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}}_c : {\mathit{exprIL}}_c~{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{ctk}}_c
 \qquad
p~C~f \vdash {\mathit{stmt}}_t : C_t~f_t~{\mathit{stmtIL}}_t
 \qquad
p~C~f \vdash {\mathit{stmt}}_f : C_f~f_f~{\mathit{stmtIL}}_f
 \qquad
{f'} = f_t~\sqcup_\texttt{flow}~f_f
}{
p~C~f \vdash \mathsf{if}~({\mathit{expr}}_c)~\mathsf{then}~{\mathit{stmt}}_t~\mathsf{else}~{\mathit{stmt}}_f : C~{f'}~(\mathsf{if}~({\mathit{exprIL}}_c)~\mathsf{then}~{\mathit{stmtIL}}_t~\mathsf{else}~{\mathit{stmtIL}}_f)
} \, {[\textsc{\scriptsize Stmt\_ok{-}ifs}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~f \vdash {{\mathit{stmt}}^\ast} : {C'}~{f'}~{{\mathit{stmtIL}}^\ast}
}{
\mathsf{local}~C~f~\mathsf{init} \vdash {\{}{{{\mathit{stmt}}^\ast}}{\}} : {C'}~{f'}~({\{}{{{\mathit{stmtIL}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Block\_ok{-}init}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{C'} = \mathsf{enter}~C
 \qquad
p~{C'}~f \vdash {{\mathit{stmt}}^\ast} : {C''}~{f'}~{{\mathit{stmtIL}}^\ast}
 \qquad
{C'''} = \mathsf{exit}~{C''}
}{
\mathsf{local}~C~f~\mathsf{noinit} \vdash {\{}{{{\mathit{stmt}}^\ast}}{\}} : {C'''}~{f'}~({\{}{{{\mathit{stmtIL}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Block\_ok{-}noinit}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{local}~C~f~\mathsf{noinit} \vdash {\mathit{block}} : {C'}~{f'}~{\mathit{blockIL}}
}{
\mathsf{local}~C~f \vdash {\mathit{block}} : {C'}~{f'}~({\mathit{blockIL}})
} \, {[\textsc{\scriptsize Stmt\_ok{-}blocks}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~f \vdash \mathsf{exit} : C~f~\mathsf{exit}
} \, {[\textsc{\scriptsize Stmt\_ok{-}exits}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathsf{void}}{\mathsf{\_}}{\mathsf{t}} = \mathsf{return}~\mathsf{type}~\mathsf{of}~C{.}\mathsf{local}{.}\mathsf{kind}
}{
\mathsf{local}~C~f \vdash \mathsf{return}~\epsilon : C~\mathsf{ret}~(\mathsf{return}~\epsilon)
} \, {[\textsc{\scriptsize Stmt\_ok{-}rets{-}none}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
{\tau}_r = \mathsf{return}~\mathsf{type}~\mathsf{of}~C{.}\mathsf{local}{.}\mathsf{kind}
 \\
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, \tau)~{\mathit{to}}~{\tau}_r
\end{array}
}{
\mathsf{local}~C~f \vdash \mathsf{return}~{\mathit{expr}} : C~\mathsf{ret}~(\mathsf{return}~{\mathit{exprIL}'})
} \, {[\textsc{\scriptsize Stmt\_ok{-}rets{-}some}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
{{\mathit{tid}}_{\mathit{fresh}'}^\ast} = {\bigoplus}\, {{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}
 \\
p~C \vdash \tau_\texttt{f}~{{\mathit{tid}}_{\mathit{fresh}'}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
\end{array}
}{
p~C~f \vdash {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}{} : C~f~({{\mathit{name}}}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle}{({{\mathit{argIL}'}^\ast})}{})
} \, {[\textsc{\scriptsize Stmt\_ok{-}callfuncs}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{expr}}_b~{\mathit{member}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{\mathit{exprIL}}_b~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
{{\mathit{tid}}_{\mathit{fresh}'}^\ast} = {\bigoplus}\, {{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}
 \\
p~C \vdash \tau_\texttt{f}~{{\mathit{tid}}_{\mathit{fresh}'}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
\end{array}
}{
p~C~f \vdash {{\mathit{expr}}_b}{\langle}{{{\mathit{targ}}^\ast}}{\rangle} {.} {{\mathit{member}}}{({{\mathit{arg}}^\ast})}{} : C~f~({{\mathit{exprIL}}_b}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle} {.} {{\mathit{member}}}{({{\mathit{argIL}'}^\ast})}{})
} \, {[\textsc{\scriptsize Stmt\_ok{-}callmethods}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{name}}~\epsilon~\epsilon : \tau_\texttt{cons}~\epsilon~\epsilon
 \\
p~C \vdash \tau_\texttt{cons}~\epsilon~\epsilon~\epsilon~\epsilon : \tau~\epsilon~\epsilon
 \\
{\tau'} = {\tau}{|_{\mathtt{canon}}}
 \qquad
({\tau'} = {\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})) \lor ({\tau'} = {\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}))
 \\
({{.}}\, {\mathit{id}} = {\mathit{name}}) \lor ({\mathit{id}} = {\mathit{name}})
 \qquad
{C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{\tau~\mathsf{no}~\mathsf{ctk}~\epsilon}{\}}
 \\
p~{C'}~f \vdash {(({\mathit{id}}))}{\langle}{{{\mathit{targ}}^\ast}}{\rangle} {.} {\mbox{\texttt{`apply'}}}{({{\mathit{arg}}^\ast})}{} : {C'}~{f'}~{\mathit{stmtIL}}
\end{array}
}{
p~C~f \vdash {{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle{.}\mathsf{apply}}{({{\mathit{arg}}^\ast})}{} : C~f~({{\mathit{name}}~\langle}{{{\mathit{targIL}'}^\ast}}{\rangle{.}\mathsf{apply}}{({{\mathit{argIL}'}^\ast})}{}~/*~\tau~*/)
} \, {[\textsc{\scriptsize Stmt\_ok{-}callinsts}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~{\mathsf{state}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{ctk}}
}{
p~C~f \vdash \mathsf{transition}~{\mathit{expr}} : C~f~(\mathsf{transition}~{\mathit{exprIL}})
} \, {[\textsc{\scriptsize Stmt\_ok{-}transs}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{decl}} : {C'}~{\mathit{declIL}}
}{
p~C~f \vdash {\mathit{decl}} : {C'}~f~({\mathit{declIL}})
} \, {[\textsc{\scriptsize Stmt\_ok{-}decls}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~f \vdash \epsilon : C~f~\epsilon
} \, {[\textsc{\scriptsize Stmts\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~f \vdash {\mathit{stmt}}_h : {C'}~{f'}~{\mathit{stmtIL}}_h
 \qquad
p~{C'}~{f'} \vdash {{\mathit{stmt}}_t^\ast} : {C''}~{f''}~{{\mathit{stmtIL}}_t^\ast}
}{
p~C~f \vdash {\mathit{stmt}}_h~{{\mathit{stmt}}_t^\ast} : {C''}~{f''}~({\mathit{stmtIL}}_h~{{\mathit{stmtIL}}_t^\ast})
} \, {[\textsc{\scriptsize Stmts\_ok{-}cons}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{type}} : {\tau}_p~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
 \qquad
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}_e~{\tau}_e~\mathsf{lctk}
 \qquad
{\tau}_e \prec {\tau}_p
 \qquad
p~C \vdash {\mathit{exprIL}}_e \hookrightarrow {\mathit{val}}
}{
p~C \vdash {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~{{\mathit{expr}}^?} : ({\mathit{id}}~{\mathit{dir}}~{\tau}_p~{{\mathit{val}}^?})~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize Param\_ok{-}param{-}default}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{type}} : {\tau}_p~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
}{
p~C \vdash {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~\epsilon : ({\mathit{id}}~{\mathit{dir}}~{\tau}_p~\epsilon)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize Param\_ok{-}param{-}nodefault}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{type}} : {\tau}_p~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
 \qquad
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}_e~{\tau}_e~\mathsf{lctk}
 \qquad
{\tau}_e \prec {\tau}_p
 \qquad
p~C \vdash {\mathit{exprIL}}_e \hookrightarrow {\mathit{val}}
}{
p~C \vdash {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~{{\mathit{expr}}^?} : ({\mathit{id}}~{\mathit{dir}}~{\tau}_p~{{\mathit{val}}^?})~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize CParam\_ok{-}cparam{-}default}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{type}} : {\tau}_p~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
}{
p~C \vdash {\mathit{id}}~{\mathit{dir}}~{\mathit{type}}~\epsilon : ({\mathit{id}}~{\mathit{dir}}~{\tau}_p~\epsilon)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}
} \, {[\textsc{\scriptsize CParam\_ok{-}cparam{-}nodefault}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{type}} : {\tau}_c~\epsilon
 \\
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, \tau)~{\mathit{to}}~{\tau}_c
 \\
p~C \vdash {\mathit{exprIL}'} \hookrightarrow {\mathit{val}}
 \\
{C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\tau}_t~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}}{\}}
\end{array}
}{
p~C \vdash \mathsf{const}~{\mathit{type}}~{\mathit{id}} = {\mathit{expr}} : {C'}~(\mathsf{const}~{\tau}_c~{\mathit{id}} = {\mathit{val}})
} \, {[\textsc{\scriptsize Decl\_ok{-}constd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{type}} : {\tau}_v~\epsilon
 \qquad
{C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\tau}_t~\mathsf{inout}~\mathsf{dyn}~\epsilon}{\}}
}{
p~C \vdash {\mathit{type}}~{\mathit{id}} = \epsilon : {C'}~({\tau}_v~{\mathit{id}} = \epsilon)
} \, {[\textsc{\scriptsize Decl\_ok{-}vard{-}none}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{type}} : {\tau}_v~\epsilon
 \\
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, \tau)~{\mathit{to}}~{\tau}_v
 \\
{C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\tau}_t~\mathsf{inout}~\mathsf{dyn}~\epsilon}{\}}
\end{array}
}{
p~C \vdash {\mathit{type}}~{\mathit{id}} = {\mathit{expr}} : {C'}~({\tau}_v~{\mathit{id}} = {\mathit{exprIL}'})
} \, {[\textsc{\scriptsize Decl\_ok{-}vard{-}some}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~\Sigma~\Delta_\texttt{f} \vdash {\mathit{decl}} : \Sigma~\Delta_\texttt{f}~{\mathit{declIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash ({{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}~{\mathit{id}'} = {\{}{{{\mathit{decl}}^\ast}}{\}}) : {C'}~{\mathit{declIL}}
 \\
{\mathit{styp}'} = {{C'}}{@}{p{.}\mathsf{frame}}{(\mathsf{s})}{}~{}[ {\mathit{id}'} ]
 \qquad
{\Sigma'} = {\Sigma}{\{}~{\mathit{id}'}~\mapsto~{\mathit{styp}'}~\}
\end{array}
}{
p~C~\Sigma~\Delta_\texttt{f} \vdash ({{\mathit{name}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}~{\mathit{id}'} = {\{}{{{\mathit{decl}}^\ast}}{\}}) : {\Sigma'}~\Delta_\texttt{f}~{\mathit{declIL}}
} \, {[\textsc{\scriptsize Inst\_init\_decl\_ok{-}instd}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{fid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast})
 \qquad
C_1 = C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{extern}
 \\
C_2 = {C_1{.}\mathsf{block}}{\{}~\mathsf{frame} = {\mathrm{empty}}_{\mathit{frame}}~\}
 \\
C_2{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{extern}
 \qquad
C_3 = C_2 {.} {\mathsf{local}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
\mathsf{local}~C_3 \vdash {\mathit{type}}_r : {\tau}_r~\epsilon
 \\
C_4 = C_3{.}\mathsf{local} .. \mathsf{kind} = \mathsf{externabstractmethod}~{\tau}_r
 \\
(\mathsf{local}~C_4 \vdash {\mathit{param}} : {\mathit{paramIL}}~{\mathit{tid}}_{{\mathit{fresh}}_p})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
C_5 = C_4 {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
\mathsf{local}~C_5~\mathsf{cont}~\mathsf{init} \vdash {\mathit{block}} : C_6~f~{\mathit{blockIL}}
 \qquad
f = \mathsf{ret} \lor {\tau}_r = {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}
 \\
{\delta_\texttt{func}} = \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C_2) \vdash {\delta_\texttt{func}}
 \\
{\Delta_\texttt{f}'} = {\Delta_\texttt{f}}{\{}~{\mathit{fid}}~\mapsto~{\delta_\texttt{func}}~\}
\end{array}
}{
p~C_0~\Sigma~\Delta_\texttt{f} \vdash ({{\mathit{type}}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{}~{\mathit{block}}) : \Sigma~{\Delta_\texttt{f}'}~({{\tau}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{}~{\mathit{blockIL}})
} \, {[\textsc{\scriptsize Inst\_init\_decl\_ok{-}funcd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{context}}~\Sigma~\Delta_\texttt{f} \vdash {{\mathit{decl}}^\ast} : \Sigma~\Delta_\texttt{f}~{{\mathit{declIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
C~\Sigma~\Delta_\texttt{f} \vdash \epsilon : \Sigma~\Delta_\texttt{f}~\epsilon
} \, {[\textsc{\scriptsize Inst\_init\_decls\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{global}~C~\Sigma~\Delta_\texttt{f} \vdash {\mathit{decl}}_h : {\Sigma'}~{\Delta_\texttt{f}'}~{\mathit{declIL}}_h
 \qquad
C~{\Sigma'}~{\Delta_\texttt{f}'} \vdash {{\mathit{decl}}_t^\ast} : {\Sigma''}~{\Delta_\texttt{f}''}~{{\mathit{declIL}}_t^\ast}
}{
C~\Sigma~\Delta_\texttt{f} \vdash {\mathit{decl}}_h~{{\mathit{decl}}_t^\ast} : {\Sigma''}~{\Delta_\texttt{f}''}~({\mathit{declIL}}_h~{{\mathit{declIL}}_t^\ast})
} \, {[\textsc{\scriptsize Inst\_init\_decls\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{update\_fdenv\_extern}~(}{{\Delta_\texttt{f}}_{\mathit{ext}}}{, }{{{\tau}_a^\ast}}{, }{\epsilon}{, }{\epsilon}{)} & = & {\Delta_\texttt{f}}_{\mathit{ext}} \\
{\mathsf{update\_fdenv\_extern}~(}{{\Delta_\texttt{f}}_{\mathit{ext}}}{, }{{{\tau}_a^\ast}}{, }{{\mathit{fid}}_h~{{\mathit{fid}}_t^\ast}}{, }{{\delta_\texttt{func}}_h~{{\delta_\texttt{func}}_t^\ast}}{)} & = & {\mathsf{update\_fdenv\_extern}~(}{{\Delta_\texttt{f}}_{\mathit{ext}'}}{, }{{{\tau}_a^\ast}}{, }{{{\mathit{fid}}_t^\ast}}{, }{{{\delta_\texttt{func}}_t^\ast}}{)} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) = {{\Delta_\texttt{f}}_{\mathit{ext}}}{{}[ {\mathit{fid}}_h ]} \\
{\land}~ {\delta_\texttt{func}}_{\mathit{ext}} = \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r) \\
{\land}~ \theta = {\{}{{({\mathit{tparam}}~\mapsto~{\tau}_a)^\ast}}{\}} \\
{\land}~ {\delta_\texttt{func}}_{\mathit{ext}'} = {{\delta_\texttt{func}}_{\mathit{ext}}}{/}{\theta} \\
{\land}~ {\delta_\texttt{func}}_{\mathit{ext}'} \approx {\delta_\texttt{func}}_h \\
{\land}~ {\Delta_\texttt{f}}_{\mathit{ext}'} = {{\Delta_\texttt{f}}_{\mathit{ext}}}{\{}~{\mathit{fid}}_h~\mapsto~{\delta_\texttt{func}}_{\mathit{ext}'}~\} \\
\end{array} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{cons}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
p~C \vdash \tau_\texttt{cons}~({{\mathit{tid}}_{\mathit{fresh}}^\ast} \oplus {{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast})~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
 \\
\tau = {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~(\mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_{\mathit{ext}}~{\Delta_\texttt{f}}_{\mathit{ext}}))}{\langle}{{{\tau}_a^\ast}}{\rangle}
 \qquad
{C'} = C {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{\mbox{\texttt{`this'}}}{\mapsto}{\tau~\mathsf{no}~\mathsf{ctk}~\epsilon}{\}}
 \\
{C'}~{\mathrm{empty}}_{\mathit{frame}}~{\mathrm{empty}}_{\mathit{fdenv}} \vdash {{\mathit{decl}}^\ast} : {\Sigma}_{\mathit{abs}}~{\Delta_\texttt{f}}_{\mathit{abs}}~{{\mathit{declIL}}^\ast}
 \qquad
{\{}{{({\mathit{fid}}_{\mathit{abs}}~\mapsto~{\delta_\texttt{func}}_{\mathit{abs}})^\ast}}{\}} = {\Delta_\texttt{f}}_{\mathit{abs}}
 \\
{\Delta_\texttt{f}}_{\mathit{ext}'} = {\mathsf{update\_fdenv\_extern}~(}{{\Delta_\texttt{f}}_{\mathit{ext}}}{, }{{{\tau}_a^\ast}}{, }{{{\mathit{fid}}_{\mathit{abs}}^\ast}}{, }{{{\delta_\texttt{func}}_{\mathit{abs}}^\ast}}{)}
 \qquad
{\{}{{({\mathit{fid}}_{\mathit{ext}}~\mapsto~{\delta_\texttt{func}}_{\mathit{ext}})^\ast}}{\}} = {\Delta_\texttt{f}}_{\mathit{ext}'}
 \\
{(\mathsf{polyfd}~({{\mathit{tparam}'}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}'}^\ast}) \rightarrow {\tau_\texttt{f}})^\ast} = {{\delta_\texttt{func}}_{\mathit{ext}}^\ast}
 \qquad
({\neg{\tau_\texttt{f}}~\mathsf{is}~\mathsf{extern\_abstract\_method\_t}})^\ast
 \\
{\tau'} = {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~(\mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_{\mathit{ext}}~{\Delta_\texttt{f}}_{\mathit{ext}'}))}{\langle}{{{\tau}_a^\ast}}{\rangle}
 \qquad
{C''} = {C'} {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{{\tau'}~\mathsf{no}~\mathsf{ctk}~\epsilon}{\}}
\end{array}
}{
p~C \vdash {{\mathit{name}}_{\mathit{inst}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}~{\mathit{id}} = {\{}{{{\mathit{decl}}^\ast}}{\}} : C~({{\mathit{name}}_{\mathit{inst}}}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle}{{{\mathit{argIL}'}^\ast}}~{\mathit{id}} = {\{}{{{\mathit{declIL}}^\ast}}{\}}~/*~\tau~*/)
} \, {[\textsc{\scriptsize Decl\_ok{-}instd{-}some}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
(p~C \vdash {\mathit{targ}} : {\mathit{targIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast})^\ast
 \qquad
{{\mathit{tid}}_{\mathit{fresh}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_a}^\ast}^\ast}
 \\
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{cons}~{{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
 \\
p~C \vdash \tau_\texttt{cons}~({{\mathit{tid}}_{\mathit{fresh}}^\ast} \oplus {{\mathit{tid}}_{{\mathit{fresh}}_{\mathit{inserted}}}^\ast})~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : \tau~{{\mathit{targIL}'}^\ast}~{{\mathit{argIL}'}^\ast}
 \\
{C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{\tau~\mathsf{no}~\mathsf{ctk}~\epsilon}{\}}
\end{array}
}{
p~C \vdash {{\mathit{name}}_{\mathit{inst}}}{\langle}{{{\mathit{targ}}^\ast}}{\rangle}{{{\mathit{arg}}^\ast}}~{\mathit{id}} = {\{}{\epsilon}{\}} : {C'}~({{\mathit{name}}_{\mathit{inst}}}{\langle}{{{\mathit{targIL}'}^\ast}}{\rangle}{{{\mathit{argIL}'}^\ast}}~{\mathit{id}} = {\{}{\epsilon}{\}}~/*~\tau~*/)
} \, {[\textsc{\scriptsize Decl\_ok{-}instd{-}none}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \\
(({\mathit{id}}_e = \mbox{\texttt{`error.'}}~{\mathit{member}}))^\ast
 \qquad
(({\mathit{val}}_e = {\mathsf{err}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{member}}))^\ast
 \qquad
(({\mathit{styp}}_e = {\mathsf{err}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}_e))^\ast
 \\
{C'} = C {.} {\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_e^\ast}}{\mapsto^{*}}{{{\mathit{styp}}_e^\ast}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {\mathsf{error}~\{}{{{\mathit{member}}^\ast}}{\}} : {C'}~({\mathsf{error}~\{}{{{\mathit{member}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}errd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \\
(({\mathit{id}}_m = {\mathit{member}}))^\ast
 \qquad
(({\mathit{val}}_m = {\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{member}}))^\ast
 \qquad
(({\mathit{styp}}_e = {\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}_m))^\ast
 \\
{C'} = C {.} {\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_m^\ast}}{\mapsto^{*}}{{{\mathit{styp}}_m^\ast}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {{\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}~\{}{{{\mathit{member}}^\ast}}{\}} : {C'}~({{\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}~\{}{{{\mathit{member}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}matchkindd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(\mathsf{global}~C \vdash {\mathit{type}}_f : {\tau}_f~{{\mathit{tid}}_{{\mathit{fresh}}_f}^\ast})^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_f}^\ast}^\ast}
 \\
{\tau}_s = {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}_f, {\tau}_f)^\ast}}{\}}
 \qquad
{\delta_\texttt{typ}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau}_s
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C) \vdash {\delta_\texttt{typ}}
 \\
{C'} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {{\mathsf{struct}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{({\mathit{member}}_f, {\mathit{type}}_f)^\ast}}{\}} : {C'}~({\mathsf{struct}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}~\{}{{({\mathit{member}}_f, {\tau}_f)^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}structd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(\mathsf{global}~C \vdash {\mathit{type}}_f : {\tau}_f~{{\mathit{tid}}_{{\mathit{fresh}}_f}^\ast})^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_f}^\ast}^\ast}
 \\
{\tau}_s = {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}_f, {\tau}_f)^\ast}}{\}}
 \qquad
{\delta_\texttt{typ}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau}_s
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C) \vdash {\delta_\texttt{typ}}
 \\
{C'} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {{\mathsf{header}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{({\mathit{member}}_f, {\mathit{type}}_f)^\ast}}{\}} : {C'}~({\mathsf{header}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}~\{}{{({\mathit{member}}_f, {\tau}_f)^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}headerd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(\mathsf{global}~C \vdash {\mathit{type}}_f : {\tau}_f~{{\mathit{tid}}_{{\mathit{fresh}}_f}^\ast})^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_f}^\ast}^\ast}
 \\
{\tau}_s = {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{({\mathit{member}}_f, {\tau}_f)^\ast}}{\}}
 \qquad
{\delta_\texttt{typ}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow {\tau}_s
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C) \vdash {\delta_\texttt{typ}}
 \\
{C'} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {{\mathsf{union}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{({\mathit{member}}_f, {\mathit{type}}_f)^\ast}}{\}} : {C'}~({\mathsf{union}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}~\{}{{({\mathit{member}}_f, {\tau}_f)^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}uniond}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \\
(({\mathit{id}}_e = {\mathit{id}}~\mbox{\texttt{`.'}}~{\mathit{member}}))^\ast
 \qquad
(({\mathit{val}}_e = {\mathsf{enum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}} {.} {\mathit{member}}))^\ast
 \qquad
{\tau}_e = {{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}}
 \qquad
(({\mathit{styp}}_e = {\tau}_e~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}_e))^\ast
 \\
{C'} = {C'} {.} {\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_e^\ast}}{\mapsto^{*}}{{{\mathit{styp}}_e^\ast}}{\}}
 \\
{\delta_\texttt{typ}} = \mathsf{monod}~{\tau}_e
 \qquad
\mathcal{B} = {\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C)
 \qquad
\mathcal{B} \vdash {\delta_\texttt{typ}}
 \qquad
{C'} = {C'} {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {\mathsf{enum}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}} : {C'}~({\mathsf{enum}~{\mathit{id}}~\{}{{{\mathit{member}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}enumd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{context}}~{\mathit{id}}~\tau~{({\mathit{member}}, {\mathit{val}})^\ast} \vdash {\mathit{member}}~{\mathit{expr}} : {\mathit{context}}~{({\mathit{member}}, {\mathit{val}})^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
\mathsf{block}~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~\mathsf{lctk}
 \qquad
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, \tau)~{\mathit{to}}~{\tau}_s
 \qquad
\mathsf{block}~C \vdash {\mathit{exprIL}'} \hookrightarrow {\mathit{val}}_e
 \\
{\mathit{val}} = {\mathsf{senum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}_s {.} {\mathit{member}}~({\mathit{val}}_e)
 \\
{{\mathit{member}}_{s'}^\ast} = {{\mathit{member}}_s^\ast}~{\mathit{member}}
 \qquad
{{\mathit{val}}_{s'}^\ast} = {{\mathit{val}}_s^\ast}~{\mathit{val}}
 \qquad
{\tau}_f = {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_s~{\tau}_s~\{}{{({\mathit{member}}_{s'}, {\mathit{val}}_{s'})^\ast}}{\}}
 \\
{C'} = C {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{member}}}{\mapsto}{{\tau}_f~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}}{\}}
\end{array}
}{
C~{\mathit{id}}_s~{\tau}_s~{({\mathit{member}}_s, {\mathit{val}}_s)^\ast} \vdash {\mathit{member}}~{\mathit{expr}} : {C'}~{({\mathit{member}}_{s'}, {\mathit{val}}_{s'})^\ast}
} \, {[\textsc{\scriptsize SEnum\_field\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{context}}~{\mathit{id}}~\tau~{({\mathit{member}}, {\mathit{val}})^\ast} \vdash {({\mathit{member}}, {\mathit{expr}})^\ast} : {\mathit{context}}~{({\mathit{member}}, {\mathit{val}})^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
C~{\mathit{id}}~\tau~{({\mathit{member}}, {\mathit{val}})^\ast} \vdash \epsilon : C~{({\mathit{member}}, {\mathit{val}})^\ast}
} \, {[\textsc{\scriptsize SEnum\_fields\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
C~{\mathit{id}}~\tau~{({\mathit{member}}, {\mathit{val}})^\ast} \vdash {\mathit{member}}_h~{\mathit{expr}}_h : {C'}~{({\mathit{member}'}, {\mathit{val}'})^\ast}
 \\
{C'}~{\mathit{id}}~\tau~{({\mathit{member}'}, {\mathit{val}'})^\ast} \vdash {({\mathit{member}}_t, {\mathit{expr}}_t)^\ast} : {C''}~{({\mathit{member}''}, {\mathit{val}''})^\ast}
\end{array}
}{
C~{\mathit{id}}~\tau~{({\mathit{member}}, {\mathit{val}})^\ast} \vdash ({\mathit{member}}_h, {\mathit{expr}}_h)~{({\mathit{member}}_t, {\mathit{expr}}_t)^\ast} : {C''}~{({\mathit{member}''}, {\mathit{val}''})^\ast}
} \, {[\textsc{\scriptsize SEnum\_fields\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\mathit{member}}^\ast}~{\mathrm{distinct}}
 \\
\mathsf{global}~C_0 \vdash {\mathit{type}} : \tau~\epsilon
 \\
C_0~{\mathit{id}}~\tau~\epsilon \vdash {({\mathit{member}}, {\mathit{expr}})^\ast} : C_1~{({\mathit{member}}, {\mathit{val}}_s)^\ast}
 \\
(({\mathit{id}}_s = {\mathit{id}}~\mbox{\texttt{`.'}}~{\mathit{member}}))^\ast
 \qquad
{\tau}_s = {{\mathsf{senum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}}_s)^\ast}}{\}}
 \qquad
(({\mathit{styp}}_s = {\tau}_s~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}_s))^\ast
 \\
C_2 = C_1 {.} {\mathsf{global}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_s^\ast}}{\mapsto^{*}}{{{\mathit{styp}}_s^\ast}}{\}}
 \\
{\delta_\texttt{typ}} = \mathsf{monod}~{\tau}_s
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_0) \vdash {\delta_\texttt{typ}}
 \qquad
C_3 = C_2 {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C_0 \vdash {\mathsf{enum}~{\mathit{id}}~{\mathit{type}}~\{}{{({\mathit{member}}, {\mathit{expr}})^\ast}}{\}} : C_3~({\mathsf{enum}~{\mathit{id}}~\tau~\{}{{({\mathit{member}}, {\mathit{val}}_s)^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}senumd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathsf{global}~C \vdash {\mathit{type}} : \tau~\epsilon
 \qquad
{\tau}_n = {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~\tau
 \\
{\delta_\texttt{typ}} = \mathsf{monod}~{\tau}_n
 \qquad
\mathcal{B} = {\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C)
 \qquad
\mathcal{B} \vdash {\delta_\texttt{typ}}
 \qquad
{C'} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash \mathsf{type}~{\mathit{id}}~{\mathit{type}} : {C'}~(\mathsf{type}~{\mathit{id}}~\tau)
} \, {[\textsc{\scriptsize Decl\_ok{-}newtyped}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
\mathsf{global}~C \vdash {\mathit{type}} : \tau~\epsilon
 \qquad
{\tau}_d = {\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~\tau
 \\
{\delta_\texttt{typ}} = \mathsf{monod}~{\tau}_d
 \qquad
\mathcal{B} = {\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C)
 \qquad
\mathcal{B} \vdash {\delta_\texttt{typ}}
 \qquad
{C'} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash \mathsf{typedef}~{\mathit{id}}~{\mathit{type}} : {C'}~(\mathsf{typedef}~{\mathit{id}}~\tau)
} \, {[\textsc{\scriptsize Decl\_ok{-}typedefd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p = \mathsf{global} \lor (p = \mathsf{block} \land C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{control})
 \\
{\mathit{fid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast})
 \\
C_1 = C_0{.}\mathsf{local} .. \mathsf{kind} = \mathsf{action}
 \\
(\mathsf{local}~C_1 \vdash {\mathit{param}} : {\mathit{paramIL}})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \\
C_2 = C_1 {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
\mathsf{local}~C_2~\mathsf{cont}~\mathsf{init} \vdash {\mathit{block}} : C_3~\mathsf{cont}~{\mathit{blockIL}}
 \\
\delta_\texttt{func} = {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \\
\mathcal{B} = {\mathrm{bound}}_{\mathit{tid}}(p, C_0)
 \qquad
\mathcal{B} \vdash \delta_\texttt{func}
 \\
C_4 = C_0 {.} {p{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{\delta_\texttt{func}}{\}}
\end{array}
}{
p~C_0 \vdash \mathsf{action}~{\mathit{id}}~({{\mathit{param}}^\ast})~{\mathit{block}} : C_4~(\mathsf{action}~{\mathit{id}}~({{\mathit{paramIL}}^\ast})~{\mathit{blockIL}})
} \, {[\textsc{\scriptsize Decl\_ok{-}actiond}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{fid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast})
 \\
C_1 = C_0 {.} {\mathsf{local}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \qquad
\mathsf{local}~C_1 \vdash {\mathit{type}}_r : {\tau}_r~\epsilon
 \\
C_2 = C_1{.}\mathsf{local} .. \mathsf{kind} = \mathsf{func}~{\tau}_r
 \\
(\mathsf{local}~C_2 \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
C_3 = C_2 {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
\mathsf{local}~C_3~\mathsf{cont}~\mathsf{init} \vdash {\mathit{block}} : C_4~f~{\mathit{blockIL}}
 \qquad
f = \mathsf{ret} \lor (f = \mathsf{cont} \land {\tau}_r = {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}})
 \\
{\delta_\texttt{func}} = \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}) \rightarrow {\tau}_r)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C) \vdash {\delta_\texttt{func}}
 \\
C_5 = C_0 {.} {\mathsf{global}{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{{\delta_\texttt{func}}}{\}}
\end{array}
}{
\mathsf{global}~C_0 \vdash {{\mathit{type}}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{}~{\mathit{block}} : C_5~({{\tau}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{}~{\mathit{blockIL}})
} \, {[\textsc{\scriptsize Decl\_ok{-}funcd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{fid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast})
 \\
C_1 = C_0 {.} {\mathsf{local}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \qquad
\mathsf{local}~C_1 \vdash {\mathit{type}}_r : {\tau}_r~\epsilon
 \\
C_2 = C_1{.}\mathsf{local} .. \mathsf{kind} = \mathsf{externfunc}
 \\
(\mathsf{local}~C_2 \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
C_3 = C_2 {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
{\delta_\texttt{func}} = \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}) \rightarrow {\tau}_r)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_0) \vdash {\delta_\texttt{func}}
 \\
C_4 = C_0 {.} {\mathsf{global}{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{{\delta_\texttt{func}}}{\}}
\end{array}
}{
\mathsf{global}~C_0 \vdash {\mathsf{extern}~{\mathit{type}}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} : C_4~({\mathsf{extern}~{\tau}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{})
} \, {[\textsc{\scriptsize Decl\_ok{-}externfuncd}]}
\qquad
\end{array}
$$

\vspace{1ex}

\vspace{1ex}

$\boxed{{\mathit{context}}~{\mathit{id}} \vdash {\mathit{method}} : {\mathit{context}}~{\mathit{methodIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{cid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}_e, {{\mathit{cparam}}^\ast})
 \\
(\mathsf{block}~C \vdash {\mathit{cparam}} : {\mathit{cparamIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_c}^\ast})^\ast
 \qquad
(({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?} = {\mathit{cparamIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_c}^\ast}^\ast}
 \\
\mathsf{polyd}~({{\mathit{tparam}}_e^\ast}, \epsilon) \rightarrow {\tau}_e = {C}{@}{\mathsf{global}{.}\mathsf{tdenv}}~{}[ {\mathit{id}}_e ]
 \qquad
\tau = {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~(\mathsf{polyd}~({{\mathit{tparam}}_e^\ast}, \epsilon) \rightarrow {\tau}_e)}{\langle}{{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}_e)^\ast}}{\rangle}
 \qquad
\delta_\texttt{cons} = \mathsf{consd}~({{\mathit{tparam}}_e^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow \tau)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{block}, C) \vdash \delta_\texttt{cons}
 \\
{C'} = C {.} {\mathsf{global}{.}\mathsf{cdenv}}{\{}{{\mathit{cid}}}{\mapsto}{\delta_\texttt{cons}}{\}}
\end{array}
}{
C~{\mathit{id}}_e \vdash {\mathit{id}}_e~({{\mathit{cparam}}^\ast}) : {C'}~({{\mathit{id}}_e}{\langle}{{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{cparamIL}}^\ast})}{})
} \, {[\textsc{\scriptsize Method\_ok{-}externconsm}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{fid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast})
 \\
C_1 = C_0 {.} {\mathsf{local}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
\mathsf{local}~C_1 \vdash {\mathit{type}}_r : {\tau}_r~\epsilon
 \\
C_2 = C_1{.}\mathsf{local} .. \mathsf{kind} = \mathsf{externabstractmethod}~{\tau}_r
 \\
(\mathsf{local}~C_2 \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
C_3 = C_2 {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
{\delta_\texttt{func}} = \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{block}, C_0) \vdash {\delta_\texttt{func}}
 \\
C_4 = C_0 {.} {\mathsf{block}{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{{\delta_\texttt{func}}}{\}}
\end{array}
}{
C_0~{\mathit{id}}_e \vdash {\mathsf{abstract}~{\mathit{type}}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} : C_4~({\mathsf{abstract}~{\tau}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{})
} \, {[\textsc{\scriptsize Method\_ok{-}externabstractm}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{fid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{param}}^\ast})
 \\
C_1 = C_0 {.} {\mathsf{local}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
\mathsf{local}~C_1 \vdash {\mathit{type}}_r : {\tau}_r~\epsilon
 \\
C_2 = C_1{.}\mathsf{local} .. \mathsf{kind} = \mathsf{externmethod}
 \\
(\mathsf{local}~C_2 \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
C_3 = C_2 {.} {\mathsf{local}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
{\delta_\texttt{func}} = \mathsf{polyfd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) \rightarrow {\tau}_r)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{block}, C_0) \vdash {\delta_\texttt{func}}
 \\
C_4 = C_0 {.} {\mathsf{block}{.}\mathsf{fdenv}}{\{}{{\mathit{fid}}}{\mapsto}{{\delta_\texttt{func}}}{\}}
\end{array}
}{
C_0~{\mathit{id}}_e \vdash {{\mathit{type}}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} : C_4~({{\tau}_r~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{})
} \, {[\textsc{\scriptsize Method\_ok{-}externm}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{context}}~{\mathit{id}} \vdash {{\mathit{method}}^\ast} : {\mathit{context}}~{{\mathit{methodIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
C~{\mathit{id}}_e \vdash \epsilon : C~\epsilon
} \, {[\textsc{\scriptsize Methods\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
C~{\mathit{id}}_e \vdash {\mathit{method}}_h : {C'}~{\mathit{methodIL}}_h
 \qquad
{C'}~{\mathit{id}}_e \vdash {{\mathit{method}}_t^\ast} : {C''}~{{\mathit{methodIL}}_t^\ast}
}{
C~{\mathit{id}}_e \vdash {\mathit{method}}_h~{{\mathit{method}}_t^\ast} : {C''}~({\mathit{methodIL}}_h~{{\mathit{methodIL}}_t^\ast})
} \, {[\textsc{\scriptsize Methods\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
({{\mathit{method}}_c^\ast}, {{\mathit{method}}_m^\ast}) = {\mathrm{split}}_{\mathit{methods}}({{\mathit{method}}^\ast})
 \\
C_1 = C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{extern}
 \qquad
C_2 = C_1 {.} {\mathsf{block}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
C_2~{\mathit{id}} \vdash {{\mathit{method}}_m^\ast} : C_3~{{\mathit{methodIL}}_m^\ast}
 \\
{\delta_\texttt{typ}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, \epsilon) \rightarrow ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~C_3{.}\mathsf{block}{.}\mathsf{fdenv})
 \qquad
C_4 = C_0 {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
 \\
C_5 = C_4{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{extern}
 \qquad
C_6 = C_5 {.} {\mathsf{block}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparma}}))^\ast}}{\}}
 \\
C_6~{\mathit{id}} \vdash {{\mathit{method}}_c^\ast} : C_7~{{\mathit{methodIL}}_c^\ast}
 \\
C_8 = C_4{}[{.}\mathsf{global}{.}\mathsf{cdenv} = C_7{.}\mathsf{global}{.}\mathsf{cdenv}]
\end{array}
}{
\mathsf{global}~C_0 \vdash {{\mathsf{extern}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{{{\mathit{method}}^\ast}}{\}} : C_8~({{\mathsf{extern}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}~\{}{({{\mathit{methodIL}}_c^\ast}~{{\mathit{methodIL}}_m^\ast})}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}externobjectd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p = \mathsf{global} \lor (p = \mathsf{block} \land C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{parser})
 \\
p~C \vdash {\mathit{type}} : {\tau}_s~\epsilon
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_s
 \\
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
{\mathit{ctk}} = \mathsf{ctk} \lor {\mathit{ctk}} = \mathsf{lctk}
 \\
{C'} = C {.} {p{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_s)~\mathsf{no}~\mathsf{ctk}~\epsilon}{\}}
\end{array}
}{
p~C \vdash {\mathsf{value}}{\mathsf{\_}}{\mathsf{set}}{\langle}{{\mathit{type}}}{\rangle}{({\mathit{expr}})}{}~{\mathit{id}} : {C'}~({\mathsf{value}}{\mathsf{\_}}{\mathsf{set}}{\langle}{\tau}{\rangle}{({\mathit{exprIL}})}{}~{\mathit{id}})
} \, {[\textsc{\scriptsize Decl\_ok{-}valuesetd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
{C'} = C {.} {\mathsf{block}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
{C''} = C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{parser}
 \\
(\mathsf{local}~{C'} \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
{\delta_\texttt{typ}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \qquad
{C'''} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {\mathsf{parser}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} : {C'''}~({\mathsf{parser}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{paramIL}}^\ast})}{})
} \, {[\textsc{\scriptsize Decl\_ok{-}parsertyped}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{context}} \vdash {\mathit{parserstate}} : {\mathit{context}}~{\mathit{parserstateIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\mathsf{local}~C~\mathsf{cont}~\mathsf{init} \vdash {\mathit{block}} : {C'}~\mathsf{cont}~{\mathit{blockIL}}
}{
C \vdash {\mathit{statelabel}}~{\mathit{block}} : {C'}~({\mathit{statelabel}}~{\mathit{blockIL}})
} \, {[\textsc{\scriptsize ParserState\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{context}} \vdash {{\mathit{parserstate}}^\ast} : {\mathit{context}}~{{\mathit{parserstateIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
C \vdash \epsilon : C~\epsilon
} \, {[\textsc{\scriptsize ParserStates\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
C \vdash {\mathit{parserstate}}_h : {C'}~{\mathit{parserstateIL}}_h
 \qquad
{C'} \vdash {{\mathit{parserstate}}_t^\ast} : {C''}~{{\mathit{parserstateIL}}_t^\ast}
}{
C \vdash {\mathit{parserstate}}_h~{{\mathit{parserstate}}_t^\ast} : {C''}~({\mathit{parserstateIL}}_h~{{\mathit{parserstateIL}}_t^\ast})
} \, {[\textsc{\scriptsize ParserStates\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{cid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{cparam}}^\ast})
 \\
C_1 = C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{parser}
 \\
(\mathsf{local}~C_1 \vdash {\mathit{cparam}} : {\mathit{cparamIL}})^\ast
 \qquad
(({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?} = {\mathit{cparamIL}}))^\ast
 \\
C_2 = C_1 {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_c^\ast}}{\mapsto^{*}}{{({\tau}_c~{\mathit{dir}}_c~\mathsf{ctk}~\epsilon)^\ast}}{\}}
 \\
(\mathsf{local}~C_2 \vdash {\mathit{param}} : {\mathit{paramIL}})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \\
 \\
{\delta_\texttt{func}}_{\mathit{apply}} = {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_0) \vdash {\delta_\texttt{func}}_{\mathit{apply}}
 \\
C_3 = C_2 {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
\mathsf{block}~C_3 \vdash {{\mathit{decl}}^\ast} : C_4~{{\mathit{declIL}}^\ast}
 \\
(({\mathit{statelabel}}~{\mathit{block}} = {\mathit{parserstate}}))^\ast
 \\
{{\mathit{statelabel}}^\ast}~{\mathrm{distinct}}
 \qquad
\mbox{\texttt{`start'}}~\in~{\{~{{\mathit{statelabel}}^\ast}}{\}}
 \qquad
{\neg(\mbox{\texttt{`accept'}}~\in~{\{~{{\mathit{statelabel}}^\ast}}{\}})}
 \qquad
{\neg(\mbox{\texttt{`reject'}}~\in~{\{~{{\mathit{statelabel}}^\ast}}{\}})}
 \\
C_5 = C_4{.}\mathsf{local} .. \mathsf{kind} = \mathsf{parserstate}
 \\
C_6 = C_5 {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{statelabel}}^\ast}}{\mapsto^{*}}{{({\mathsf{state}}{\mathsf{\_}}{\mathsf{t}}~\mathsf{no}~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
C_6 \vdash {\mathit{parserstate}} : C_7~{{\mathit{parserstateIL}}^\ast}
 \\
{\delta_\texttt{polytyp}} = \mathsf{polyd}~(\epsilon, \epsilon) \rightarrow ({\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \qquad
\tau = {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{\epsilon}{\rangle}
 \qquad
\delta_\texttt{cons} = \mathsf{consd}~(\epsilon, \epsilon) \rightarrow ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?})^\ast}) \rightarrow \tau)
 \\
\mathcal{B} \vdash \delta_\texttt{cons}
 \\
C_8 = C_0 {.} {\mathsf{global}{.}\mathsf{cdenv}}{\{}{{\mathit{cid}}}{\mapsto}{\delta_\texttt{cons}}{\}}
\end{array}
}{
\mathsf{global}~C_0 \vdash {{\mathsf{parser}~{\mathit{id}}}{({{\mathit{param}}^\ast})}{({{\mathit{cparam}}^\ast})}{}~\{}{{{\mathit{decl}}^\ast}~{{\mathit{parserstate}}^\ast}}{\}} : C_8~({{\mathsf{parser}~{\mathit{id}}}{({{\mathit{paramIL}}^\ast})}{({{\mathit{cparamIL}}^\ast})}{}~\{}{{{\mathit{declIL}}^\ast}~{{\mathit{parserstateIL}}^\ast}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}parserd}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblkey}} : {\mathit{tblctx}}~{\mathit{tblkeyIL}}}$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{check\_table\_key}~({\mathit{matchkind}}, \tau) & = & \mathsf{true} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\tau'} = {\tau}{|_{\mathtt{canon}}} \\
{\land}~ {\mathit{matchkind}} = \mbox{\texttt{`exact'}} \lor {\mathit{matchkind}} = \mbox{\texttt{`optional'}} \\
{\land}~ {\tau'}~\mathsf{is}~\mathsf{err\_t} \lor {\tau'}~\mathsf{is}~\mathsf{bool\_t} \lor {\tau'}~\mathsf{is}~\mathsf{int\_t} \lor {\tau'}~\mathsf{is}~\mathsf{fint\_t} \lor {\tau'}~\mathsf{is}~\mathsf{fbit\_t} \lor {\tau'}~\mathsf{is}~\mathsf{vbit\_t} \lor {\tau'}~\mathsf{is}~\mathsf{enum\_t} \\
\end{array} \\
\mathsf{check\_table\_key}~({\mathit{matchkind}}, \tau) & = & \mathsf{check\_table\_key}~({\mathit{matchkind}}, {\tau''}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\tau'} = {\tau}{|_{\mathtt{canon}}} \\
{\land}~ {\mathit{matchkind}} = \mbox{\texttt{`exact'}} \lor {\mathit{matchkind}} = \mbox{\texttt{`optional'}} \\
{\land}~ {\tau'} = \mathsf{senumt}~{\mathit{id}}~{\tau''} \lor {\tau'} = {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau''} \\
\end{array} \\
\mathsf{check\_table\_key}~({\mathit{matchkind}}, \tau) & = & \mathsf{true} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\tau'} = {\tau}{|_{\mathtt{canon}}} \\
{\land}~ {\mathit{matchkind}} = \mbox{\texttt{`lpm'}} \lor {\mathit{matchkind}} = \mbox{\texttt{`ternary'}} \lor {\mathit{matchkind}} = \mbox{\texttt{`range'}} \\
{\land}~ {\tau'}~\mathsf{is}~\mathsf{int\_t} \lor {\tau'}~\mathsf{is}~\mathsf{fint\_t} \lor {\tau'}~\mathsf{is}~\mathsf{fbit\_t} \\
\end{array} \\
\mathsf{check\_table\_key}~({\mathit{matchkind}}, \tau) & = & \mathsf{check\_table\_key}~({\mathit{matchkind}}, {\tau''}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\tau'} = {\tau}{|_{\mathtt{canon}}} \\
{\land}~ {\mathit{matchkind}} = \mbox{\texttt{`lpm'}} \lor {\mathit{matchkind}} = \mbox{\texttt{`ternary'}} \lor {\mathit{matchkind}} = \mbox{\texttt{`range'}} \\
{\land}~ {\tau'} = \mathsf{senumt}~{\mathit{id}}~{\tau''} \lor {\tau'} = {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}~{\tau''} \\
\end{array} \\
\mathsf{check\_table\_key}~({\mathit{matchkind}}, \tau) & = & \mathsf{false} & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau
 \\
({\mathsf{match}}{\mathsf{\_}}{\mathsf{kind}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{matchkind}}) = {C}{@}{p{.}\mathsf{frame}}~{}[ {\mathit{matchkind}} ]
 \\
\mathsf{check\_table\_key}~({\mathit{matchkind}}, \tau)
 \qquad
{\mathit{tblctx}'} = {\mathrm{update}}_{\mathit{mode}}({\mathit{matchkind}}, \tau, {\mathit{tblctx}})
 \\
{\mathit{tblctx}''} = {\mathrm{add}}_{\mathit{key}}((\tau, {\mathit{matchkind}}), {\mathit{tblctx}'})
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathit{expr}}~{\mathit{matchkind}}) : {\mathit{tblctx}''}~({\mathit{exprIL}}~{\mathit{matchkind}})
} \, {[\textsc{\scriptsize Table\_key\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblkeyprop}} : {\mathit{tblctx}}~{\mathit{tblkeypropIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}} \vdash \epsilon : {\mathit{tblctx}}~\epsilon
} \, {[\textsc{\scriptsize Table\_keys\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblkey}}_h : {\mathit{tblctx}'}~{\mathit{tblkeyIL}}_h
 \qquad
p~C~{\mathit{tblctx}'} \vdash {{\mathit{tblkey}}_t^\ast} : {\mathit{tblctx}''}~{{\mathit{tblkeyIL}}_t^\ast}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathit{tblkey}}_h~{{\mathit{tblkey}}_t^\ast}) : {\mathit{tblctx}''}~({\mathit{tblkeyIL}}_h~{{\mathit{tblkeyIL}}_t^\ast})
} \, {[\textsc{\scriptsize Table\_keys\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{name}}~{\tau_\texttt{param}^\ast}~{({\mathit{argIL}}, \tau)^\ast} : {{\mathit{paramIL}}^\ast}~{{\mathit{paramIL}}^\ast}~{{\mathit{argIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\tau_\texttt{param}}))^\ast
 \qquad
({{\mathit{paramIL}}_d^\ast}, {{\mathit{paramIL}}_c^\ast}) = \mathsf{split\_directionless\_params}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast})
 \\
{|{{\mathit{paramIL}}_d^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
(({\mathit{id}}_d~{\mathit{dir}}_d~{\tau}_d~{{\mathit{val}}_d^?} = {\mathit{paramIL}}_d))^\ast
 \qquad
(p~C~\mathsf{act} \vdash ({\mathit{id}}_d~{\mathit{dir}}_d~{\tau}_d~{{\mathit{val}}_d^?}) \approx ({\mathit{argIL}}, {\tau}_a) : {\mathit{argIL}'})^\ast
\end{array}
}{
p~C \vdash {\mathit{name}}~{{\tau_\texttt{param}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast} : {{\mathit{paramIL}}_d^\ast}~{{\mathit{paramIL}}_c^\ast}~{{\mathit{argIL}'}^\ast}
} \, {[\textsc{\scriptsize Call\_action\_partial\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblaction}} : {\mathit{tblctx}}~{\mathit{tblactionIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~{\tau}_{\mathit{arg}})^\ast
 \\
({\mathit{fid}}, {\delta_\texttt{func}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) = {C}{@}{p{.}\mathsf{fdenv}}~{}[ {{\mathit{name}}}{({{\mathit{argIL}}^\ast})}{} ]
 \qquad
{\delta_\texttt{func}} = {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}))
 \\
p~C \vdash {\mathit{name}}~{{\tau_\texttt{param}}^\ast}~{({\mathit{argIL}}, {\tau}_{\mathit{arg}})^\ast} : {{\mathit{paramIL}}_d^\ast}~{{\mathit{paramIL}}_c^\ast}~{{\mathit{argIL}'}^\ast}
 \qquad
{\mathit{tblctx}'} = {\mathrm{add}}_{\mathit{action}}(({\mathit{name}}, {{\tau_\texttt{param}}^\ast}, {{\mathit{argIL}'}^\ast}), {\mathit{tblctx}})
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathit{name}}~{{\mathit{arg}}^\ast}) : {\mathit{tblctx}'}~({\mathit{name}}~{{\mathit{argIL}'}^\ast}~{{\mathit{paramIL}}_d^\ast}~{{\mathit{paramIL}}_c^\ast})
} \, {[\textsc{\scriptsize Table\_action\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblactionprop}} : {\mathit{tblctx}}~{\mathit{tblactionpropIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}} \vdash \epsilon : {\mathit{tblctx}}~\epsilon
} \, {[\textsc{\scriptsize Table\_actions\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C~{\mathit{tblctx}} \vdash {\mathit{tblaction}}_h : {\mathit{tblctx}'}~{\mathit{tblactionIL}}_h
 \qquad
p~C~{\mathit{tblctx}'} \vdash {{\mathit{tblaction}}_t^\ast} : {\mathit{tblctx}''}~{{\mathit{tblactionIL}}_t^\ast}
 \\
{{\mathit{tblactionIL}}^\ast} = {\mathit{tblactionIL}}_h~{{\mathit{tblactionIL}}_t^\ast}
 \qquad
(({\mathit{name}}~{{\mathit{argIL}}^\ast}~{{\mathit{paramIL}}_d^\ast}~{{\mathit{paramIL}}_c^\ast} = {\mathit{tblactionIL}}))^\ast
 \qquad
{{\mathit{name}}^\ast}~{\mathrm{distinct}}
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathit{tblaction}}_h~{{\mathit{tblaction}}_t^\ast}) : {\mathit{tblctx}''}~({\mathit{tblactionIL}}_h~{{\mathit{tblactionIL}}_t^\ast})
} \, {[\textsc{\scriptsize Table\_actions\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{key}}~{\mathit{keyset}} : {\mathit{tblstate}}~{\mathit{keysetIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash ({\mathit{expr}}_b~\&\&\&~{\mathit{expr}}_m) : {\mathit{exprIL}}~({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau)~{\mathit{ctk}}
 \qquad
{\mathit{tblctx}}{.}\mathsf{mode} = \mathsf{noprilpm}~i
 \\
p~C \vdash {\mathit{exprIL}}_m \hookrightarrow {\mathit{val}}_m
 \qquad
m = {\mathrm{get}}_{\mathit{num}}({\mathit{val}}_m)
 \\
{\mathit{state}}_e = {\mathrm{get}}_{{\mathit{lpm}}_{\mathit{prefix}}}({{\mathsf{fbit}}{\mathsf{\_}}{\mathsf{v}}~i}{\mathsf{w}}{{\mathrm{of}}_{{\mathit{two}}_{\mathit{complement}}}(m, i)})
 \qquad
\tau \prec {\tau}_k
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash ({\tau}_k, \mbox{\texttt{`lpm'}})~(({\mathit{expr}}_b~\&\&\&~{\mathit{expr}}_m)) : {\mathit{state}}_e~({\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_entry\_keyset\_ok{-}exprk{-}maske{-}lpm}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash ({\mathit{expr}}_b~\&\&\&~{\mathit{expr}}_m) : {\mathit{exprIL}}~({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau)~{\mathit{ctk}}
 \qquad
\tau \prec {\tau}_k
}{
p~C~{\mathit{tblctx}} \vdash ({\tau}_k, \mbox{\texttt{`ternary'}})~(({\mathit{expr}}_b~\&\&\&~{\mathit{expr}}_m)) : \mathsf{nolpm}~({\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_entry\_keyset\_ok{-}exprk{-}maske{-}ternary}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash ({\mathit{expr}}_l \ldots {\mathit{expr}}_r) : {\mathit{exprIL}}~({\mathsf{set}}{\mathsf{\_}}{\mathsf{t}}~\tau)~{\mathit{ctk}}
 \qquad
\tau \prec {\tau}_k
}{
p~C~{\mathit{tblctx}} \vdash ({\tau}_k, \mbox{\texttt{`range'}})~(({\mathit{expr}}_l \ldots {\mathit{expr}}_r)) : \mathsf{nolpm}~({\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_entry\_keyset\_ok{-}exprk{-}rangee}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\neg({\mathit{expr}}~\mathsf{is}~\mathsf{mask\_e} \lor {\mathit{expr}}~\mathsf{is}~\mathsf{range\_e})}
 \qquad
\mathsf{local}~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \\
\tau \prec {\tau}_k
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash ({\tau}_k, {\mathit{matchkind}})~({\mathit{expr}}) : \mathsf{nolpm}~({\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_entry\_keyset\_ok{-}exprk{-}else}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash {{\mathit{key}}^\ast}~{{\mathit{keyset}}^\ast} : {\mathit{tblstate}}~{{\mathit{keysetIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash \epsilon~\epsilon : {\mathit{tblstate}}
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_state\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}}_0 \vdash {\mathit{key}}_h~{\mathit{keyset}}_h : {\mathit{tblstate}}_1~{\mathit{keysetIL}}_h
 \qquad
{\mathit{tblstate}}_2 = {\mathrm{update}}_{\mathit{state}}({\mathit{tblstate}}_0, {\mathit{tblstate}}_1)
 \qquad
p~C~{\mathit{tblctx}}~{\mathit{tblstate}}_2 \vdash {{\mathit{key}}_t^\ast}~{{\mathit{keyset}}_t^\ast} : {\mathit{tblstate}}_3~{{\mathit{keysetIL}}_t^\ast}
}{
p~C~{\mathit{tblctx}}~{\mathit{tblstate}}_0 \vdash ({\mathit{key}}_h~{{\mathit{key}}_t^\ast})~({\mathit{keyset}}_h~{{\mathit{keyset}}_t^\ast}) : {\mathit{tblstate}}_3~({\mathit{keysetIL}}_h~{{\mathit{keysetIL}}_t^\ast})
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_state\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {{\mathit{keyset}}^\ast} : {\mathit{tblstate}}~{{\mathit{keysetIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{tblctx}}{.}\mathsf{mode} = \mathsf{noprilpm}~i
}{
p~C~{\mathit{tblctx}} \vdash \mathsf{default} : (\mathsf{lpm}~i)~\mathsf{default}
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_ok{-}noprilpm{-}defaultk}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}} \vdash \mathsf{default} : \mathsf{nolpm}~\mathsf{default}
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_ok{-}else{-}defaultk}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{tblctx}}{.}\mathsf{mode} = \mathsf{noprilpm}~i
}{
p~C~{\mathit{tblctx}} \vdash \mathsf{\_} : (\mathsf{lpm}~0)~\mathsf{\_}
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_ok{-}noprilpm{-}anyk}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}} \vdash \mathsf{\_} : \mathsf{nolpm}~\mathsf{\_}
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_ok{-}else{-}anyk}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{|{\mathit{tblctx}}{.}\mathsf{keys}|} = {|{{\mathit{keyset}}^\ast}|}
 \qquad
p~C~{\mathit{tblctx}}~\mathsf{nolpm} \vdash {\mathit{tblctx}}{.}\mathsf{keys}~{{\mathit{keyset}}^\ast} : {\mathit{tblstate}}~{{\mathit{keysetIL}}^\ast}
}{
p~C~{\mathit{tblctx}} \vdash {{\mathit{keyset}}^\ast} : {\mathit{tblstate}}~{{\mathit{keysetIL}}^\ast}
} \, {[\textsc{\scriptsize Table\_entry\_keysets\_ok{-}others}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}} \vdash {\mathit{name}}~{\tau_\texttt{param}^\ast}~{({\mathit{argIL}}, \tau)^\ast}~{{\mathit{argIL}}^\ast} : {{\mathit{argIL}}^\ast}}$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{filter\_directionless\_args}~(\epsilon, \epsilon) & = & \epsilon \\
\mathsf{filter\_directionless\_args}~({\tau_\texttt{param}}_h~{{\tau_\texttt{param}}_t^\ast}, {\mathit{argIL}}_h~{{\mathit{argIL}}_t^\ast}) & = & \mathsf{filter\_directionless\_args}~({{\tau_\texttt{param}}_t^\ast}, {{\mathit{argIL}}_t^\ast}) & \quad \mbox{if}~ {\mathit{id}}~\mathsf{no}~\tau~{{\mathit{val}}^?} = {\tau_\texttt{param}}_h \\
\mathsf{filter\_directionless\_args}~({\tau_\texttt{param}}_h~{{\tau_\texttt{param}}_t^\ast}, {\mathit{argIL}}_h~{{\mathit{argIL}}_t^\ast}) & = & {\mathit{argIL}}_h~\mathsf{filter\_directionless\_args}~({{\tau_\texttt{param}}_t^\ast}, {{\mathit{argIL}}_t^\ast}) & \quad \mbox{otherwise} \\
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{{\tau_\texttt{param}}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
{{\mathit{argIL}}_d^\ast} = \mathsf{filter\_directionless\_args}~({{\tau_\texttt{param}}^\ast}, {{\mathit{argIL}}^\ast})
 \\
(({\mathit{argIL}}_a = {\mathit{argIL}}_d))^\ast
 \qquad
(p~C~\mathsf{act} \vdash {\tau_\texttt{param}} \approx ({\mathit{argIL}}, \tau) : {\mathit{argIL}'})^\ast
\end{array}
}{
p~C \vdash {\mathit{name}}~{{\tau_\texttt{param}}^\ast}~{({\mathit{argIL}}, \tau)^\ast}~{{\mathit{argIL}}_a^\ast} : {{\mathit{argIL}'}^\ast}
} \, {[\textsc{\scriptsize Call\_default\_action\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblaction}} : {\mathit{tblactionIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
({{\tau_\texttt{param}}^\ast}, {{\mathit{argIL}}_a^\ast}) = {\mathrm{find}}_{\mathit{action}}({\mathit{tblctx}}, {\mathit{name}})
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\tau_\texttt{param}}))^\ast
 \\
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~\tau)^\ast
 \\
p~C \vdash {\mathit{name}}~{{\tau_\texttt{param}}^\ast}~{({\mathit{argIL}}, \tau)^\ast}~{{\mathit{argIL}}_a^\ast} : {{\mathit{argIL}'}^\ast}
 \\
{\mathit{tblactionIL}} = {\mathit{name}}~{{\mathit{argIL}'}^\ast}~{({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}~\epsilon
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathit{name}}~{{\mathit{arg}}^\ast}) : {\mathit{tblactionIL}}
} \, {[\textsc{\scriptsize Table\_entry\_action\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash {{\mathit{expr}}^?} : {\mathit{tblctx}}~{{\mathit{val}}^?}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{tblctx}}{.}\mathsf{mode} = \mathsf{nopri}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash \epsilon : {\mathit{tblctx}}~\epsilon
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}nopri}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{tblctx}}{.}\mathsf{mode} = \mathsf{noprilpm}~i
}{
\mathsf{local}~C~{\mathit{tblctx}}~(\mathsf{lpm}~{\mathit{prefix}}) \vdash \epsilon : {\mathit{tblctx}}~\epsilon
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}noprilpm}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\neg{\mathit{tblctx}}{.}\mathsf{entries}{.}\mathsf{const}}
 \qquad
{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{values} = \epsilon
 \\
\mathsf{local}~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
\mathsf{local}~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \\
i = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
 \qquad
i \geq 0
 \\
{\mathit{tblctx}'} = {\mathrm{set}}_{{\mathit{priority}}_{\mathit{init}}}(\mathsf{true}, {\mathit{tblctx}})
 \qquad
{\mathit{tblctx}''} = {\mathrm{add}}_{\mathit{priority}}(i, {\mathit{tblctx}'})
\end{array}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash {\mathit{expr}} : {\mathit{tblctx}''}~({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~i)
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}priority{-}values{-}nil{-}somep}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{values} = \epsilon
 \qquad
{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{largest\_wins}
 \\
{\mathit{size}} = {\mathit{tblctx}}{.}\mathsf{entries}{.}\mathsf{size}
 \qquad
{\mathit{delta}} = {\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{delta}
 \\
i = ({\mathit{size}} - 1) \cdot {\mathit{delta}} + 1
 \qquad
i \geq 0
 \\
{\mathit{tblctx}'} = {\mathrm{set}}_{{\mathit{priority}}_{\mathit{init}}}(\mathsf{true}, {\mathit{tblctx}})
 \qquad
{\mathit{tblctx}''} = {\mathrm{add}}_{\mathit{priority}}(i, {\mathit{tblctx}'})
\end{array}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash \epsilon : {\mathit{tblctx}''}~({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~i)
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}priority{-}values{-}nil{-}none{-}lw}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{values} = \epsilon
 \qquad
{\neg{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{largest\_wins}}
 \\
i = 1
 \qquad
{\mathit{tblctx}'} = {\mathrm{set}}_{{\mathit{priority}}_{\mathit{init}}}(\mathsf{true}, {\mathit{tblctx}})
 \\
{\mathit{tblctx}''} = {\mathrm{add}}_{\mathit{priority}}(i, {\mathit{tblctx}'})
\end{array}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash \epsilon : {\mathit{tblctx}''}~({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~i)
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}priority{-}values{-}nil{-}none{-}no{-}lw}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\neg{\mathit{tblctx}}{.}\mathsf{entries}{.}\mathsf{const}}
 \qquad
{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{init}
 \\
\mathsf{local}~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
\mathsf{local}~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \\
i = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
 \qquad
i \geq 0
 \\
{\mathit{tblctx}'} = {\mathrm{add}}_{\mathit{priority}}(i, {\mathit{tblctx}})
\end{array}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash {\mathit{expr}} : {\mathit{tblctx}'}~({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~i)
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}else{-}somep}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{delta}} = {\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{delta}
 \qquad
i = {\mathrm{find}}_{{\mathit{last}}_{\mathit{priority}}}({\mathit{tblctx}})
 \\
{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{largest\_wins}
 \qquad
{i'} = i - {\mathit{delta}}
 \\
{i'} \geq 0
 \qquad
{\mathit{tblctx}'} = {\mathrm{add}}_{\mathit{priority}}({i'}, {\mathit{tblctx}})
\end{array}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash \epsilon : {\mathit{tblctx}'}~({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~{i'})
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}else{-}none{-}lw}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{delta}} = {\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{delta}
 \qquad
i = {\mathrm{find}}_{{\mathit{last}}_{\mathit{priority}}}({\mathit{tblctx}})
 \\
{\neg{\mathit{tblctx}}{.}\mathsf{priorities}{.}\mathsf{largest\_wins}}
 \qquad
{i'} = i + {\mathit{delta}}
 \\
{i'} \geq 0
 \qquad
{\mathit{tblctx}'} = {\mathrm{add}}_{\mathit{priority}}({i'}, {\mathit{tblctx}})
\end{array}
}{
\mathsf{local}~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash \epsilon : {\mathit{tblctx}'}~({\mathsf{int}}{\mathsf{\_}}{\mathsf{v}}~{i'})
} \, {[\textsc{\scriptsize Table\_entry\_priority\_ok{-}else{-}none{-}no{-}lw}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblentry}} : {\mathit{tblctx}}~{\mathit{tblentryIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C~{\mathit{tblctx}} \vdash {{\mathit{keyset}}^\ast} : {\mathit{tblstate}}~{{\mathit{keysetIL}}^\ast}
 \\
p~C~{\mathit{tblctx}} \vdash {\mathit{tblaction}} : {\mathit{tblactionIL}}
 \\
p~C~{\mathit{tblctx}}~{\mathit{tblstate}} \vdash {{\mathit{expr}}^?} : {\mathit{tblctx}'}~{{\mathit{val}}^?}
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash (\mathbb{B}~{{\mathit{keyset}}^\ast}~{\mathit{tblaction}}~{{\mathit{expr}}^?}) : {\mathit{tblctx}'}~(\mathbb{B}~{{\mathit{keysetIL}}^\ast}~{\mathit{tblactionIL}}~{{\mathit{val}}^?})
} \, {[\textsc{\scriptsize Table\_entry\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {{\mathit{tblentry}}^\ast} : {\mathit{tblctx}}~{{\mathit{tblentryIL}}^\ast}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}} \vdash \epsilon : {\mathit{tblctx}}~\epsilon
} \, {[\textsc{\scriptsize Table\_entries\_fold\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblentry}}_h : {\mathit{tblctx}'}~{\mathit{tblentryIL}}_h
 \qquad
p~C~{\mathit{tblctx}'} \vdash {{\mathit{tblentry}}_t^\ast} : {\mathit{tblctx}''}~{{\mathit{tblentryIL}}_t^\ast}
}{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblentry}}_h~{{\mathit{tblentry}}_t^\ast} : {\mathit{tblctx}''}~({\mathit{tblentryIL}}_h~{{\mathit{tblentryIL}}_t^\ast})
} \, {[\textsc{\scriptsize Table\_entries\_fold\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblentryprop}} : {\mathit{tblctx}}~{\mathit{tblentrypropIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{|{\mathit{tblctx}}_0{.}\mathsf{keys}|} = 0~\Rightarrow~{|{{\mathit{tblentry}}^\ast}|} = 0
 \qquad
{\mathit{tblctx}}_1 = {\mathrm{set}}_{{\mathit{entries}}_{\mathit{size}}}({|{{\mathit{tblentry}}^\ast}|}, {\mathit{tblctx}}_0)
 \\
{\mathit{tblctx}}_2 = {\mathrm{set}}_{{\mathit{entries}}_{\mathit{const}}}(\mathbb{B}, {\mathit{tblctx}}_1)
 \\
p~C~{\mathit{tblctx}}_2 \vdash {{\mathit{tblentry}}^\ast} : {\mathit{tblctx}}_3~{{\mathit{tblentryIL}}^\ast}
\end{array}
}{
p~C~{\mathit{tblctx}}_0 \vdash (\mathbb{B}~{{\mathit{tblentry}}^\ast}) : {\mathit{tblctx}}_3~(\mathbb{B}~{{\mathit{tblentryIL}}^\ast})
} \, {[\textsc{\scriptsize Table\_entries\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tbldefaultprop}} : {\mathit{tbldefaultpropIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
({{\tau_\texttt{param}}^\ast}, {{\mathit{argIL}}_a^\ast}) = {\mathrm{find}}_{\mathit{action}}({\mathit{tblctx}}, {\mathit{name}})
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\tau_\texttt{param}}))^\ast
 \\
(p~C \vdash {\mathit{arg}} : {\mathit{argIL}}~\tau)^\ast
 \\
p~C \vdash {\mathit{name}}~{{\tau_\texttt{param}}^\ast}~{({\mathit{argIL}}, \tau)^\ast}~{{\mathit{argIL}}_a^\ast} : {{\mathit{argIL}'}^\ast}
 \\
{\mathit{tblactionIL}} = {\mathit{name}}~{{\mathit{argIL}'}^\ast}~{({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}~\epsilon
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash \mathbb{B}~({\mathit{name}}~{{\mathit{arg}}^\ast}) : \mathbb{B}~{\mathit{tblactionIL}}
} \, {[\textsc{\scriptsize Table\_default\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblcustomprop}} : {\mathit{tblctx}}~{\mathit{tblcustompropIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
\tau~\mathsf{is}~\mathsf{int\_t} \lor \tau~\mathsf{is}~\mathsf{fint\_t} \lor \tau~\mathsf{is}~\mathsf{fbit\_t}
}{
p~C~{\mathit{tblctx}} \vdash (\mathbb{B}~\mbox{\texttt{`size'}}~{\mathit{expr}}) : {\mathit{tblctx}}~(\mathbb{B}~\mbox{\texttt{`size'}}~{\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_custom\_ok{-}size}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~{\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{ctk}}
 \\
p~C \vdash {\mathit{exprIL}} \hookrightarrow ({\mathsf{bool}}{\mathsf{\_}}{\mathsf{v}}~b)
 \qquad
{\mathit{tblctx}'} = {\mathrm{set}}_{{\mathit{largest}}_{{\mathit{priority}}_{\mathit{wins}}}}(b, {\mathit{tblctx}})
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash (\mathbb{B}~\mbox{\texttt{`largest\_priority\_wins'}}~{\mathit{expr}}) : {\mathit{tblctx}'}~(\mathbb{B}~\mbox{\texttt{`largest\_priority\_wins'}}~{\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_custom\_ok{-}largest\_priority\_wins}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~\tau~{\mathit{ctk}}
 \qquad
\tau~\mathsf{is}~\mathsf{int\_t} \lor \tau~\mathsf{is}~\mathsf{fint\_t} \lor \tau~\mathsf{is}~\mathsf{fbit\_t}
 \\
p~C \vdash {\mathit{exprIL}} \hookrightarrow {\mathit{val}}
 \\
i = {\mathrm{get}}_{\mathit{num}}({\mathit{val}})
 \qquad
i > 0
 \qquad
{\mathit{tblctx}'} = {\mathrm{set}}_{{\mathit{priority}}_{\mathit{delta}}}(i, {\mathit{tblctx}})
\end{array}
}{
p~C~{\mathit{tblctx}} \vdash (\mathbb{B}~\mbox{\texttt{`priority\_delta'}}~{\mathit{expr}}) : {\mathit{tblctx}'}~(\mathbb{B}~\mbox{\texttt{`priority\_delta'}}~{\mathit{exprIL}})
} \, {[\textsc{\scriptsize Table\_custom\_ok{-}priority\_delta}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tblprop}} : {\mathit{tblctx}}~{\mathit{tblpropIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblkeyprop}} : {\mathit{tblctx}'}~{\mathit{tblkeypropIL}}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathsf{keys}~\{}{{\mathit{tblkeyprop}}}{\}}) : {\mathit{tblctx}'}~({\mathsf{keys}~\{}{{\mathit{tblkeypropIL}}}{\}})
} \, {[\textsc{\scriptsize Table\_prop\_ok{-}keyp}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblactionprop}} : {\mathit{tblctx}'}~{\mathit{tblactionpropIL}}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathsf{actions}~\{}{{\mathit{tblactionprop}}}{\}}) : {\mathit{tblctx}'}~({\mathsf{actions}~\{}{{\mathit{tblactionpropIL}}}{\}})
} \, {[\textsc{\scriptsize Table\_prop\_ok{-}actionp}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblentryprop}} : {\mathit{tblctx}'}~{\mathit{tblentrypropIL}}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathsf{entries}~\{}{{\mathit{tblentryprop}}}{\}}) : {\mathit{tblctx}'}~({\mathsf{entries}~\{}{{\mathit{tblentrypropIL}}}{\}})
} \, {[\textsc{\scriptsize Table\_prop\_ok{-}entryp}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tbldefaultprop}} : {\mathit{tbldefaultpropIL}}
}{
p~C~{\mathit{tblctx}} \vdash ({{\mathsf{default}}{\mathsf{\_}}{\mathsf{action}}~\{}{{\mathit{tbldefaultprop}}}{\}}) : {\mathit{tblctx}}~({{\mathsf{default}}{\mathsf{\_}}{\mathsf{action}}~\{}{{\mathit{tbldefaultpropIL}}}{\}})
} \, {[\textsc{\scriptsize Table\_prop\_ok{-}defaultp}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblcustomprop}} : {\mathit{tblctx}'}~{\mathit{tblcustompropIL}}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathsf{custom}~\{}{{\mathit{tblcustomprop}}}{\}}) : {\mathit{tblctx}'}~({\mathsf{custom}~\{}{{\mathit{tblcustompropIL}}}{\}})
} \, {[\textsc{\scriptsize Table\_prop\_ok{-}customp}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{tbl}} : {\mathit{tblctx}}~{\mathit{tblIL}}}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C~{\mathit{tblctx}} \vdash \epsilon : {\mathit{tblctx}}~\epsilon
} \, {[\textsc{\scriptsize Table\_props\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{tblctx}} \vdash {\mathit{tblprop}}_h : {\mathit{tblctx}'}~{\mathit{tblpropIL}}_h
 \qquad
p~C~{\mathit{tblctx}'} \vdash {{\mathit{tblprop}}_t^\ast} : {\mathit{tblctx}''}~{{\mathit{tblpropIL}}_t^\ast}
}{
p~C~{\mathit{tblctx}} \vdash ({\mathit{tblprop}}_h~{{\mathit{tblprop}}_t^\ast}) : {\mathit{tblctx}''}~({\mathit{tblpropIL}}_h~{{\mathit{tblpropIL}}_t^\ast})
} \, {[\textsc{\scriptsize Table\_props\_ok{-}cons}]}
\qquad
\end{array}
$$

\vspace{1ex}

$\boxed{{\mathit{cursor}}~{\mathit{context}}~{\mathit{tblctx}} \vdash {\mathit{id}} : {\mathit{context}}~\tau}$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{id}}_e = \mbox{\texttt{`action\_list('}}~{\mathit{id}}~\mbox{\texttt{`)'}}
 \qquad
{({\mathit{name}}, {{\tau_\texttt{param}}^\ast}, {{\mathit{argIL}}^\ast})^\ast} = {\mathit{tblctx}}{.}\mathsf{actions}
 \\
(({\mathit{member}} = {\mathit{name}}))^\ast
 \qquad
{\tau}_e = {{\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_e~\{}{{{\mathit{member}}^\ast}}{\}}
 \\
(({\mathit{val}}_e = {\mathsf{table}}{\mathsf{\_}}{\mathsf{enum}}{\mathsf{\_}}{\mathsf{field}}{\mathsf{\_}}{\mathsf{v}}~{\mathit{id}}_e {.} {\mathit{member}}))^\ast
 \qquad
(({\mathit{id}}_f = {\mathit{id}}_e~\mbox{\texttt{`.'}}~{\mathit{member}}))^\ast
 \\
{C'} = C {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_f^\ast}}{\mapsto^{*}}{{({\tau}_e~\mathsf{no}~\mathsf{lctk}~{\mathit{val}}_e)^\ast}}{\}}
 \\
{\mathit{id}}_s = \mbox{\texttt{`apply\_result('}}~{\mathit{id}}~\mbox{\texttt{`)'}}
 \\
{\tau}_s = {{\mathsf{table}}{\mathsf{\_}}{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_s~\{}{(\mbox{\texttt{`hit'}}, {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}})}{\}}
\end{array}
}{
\mathsf{block}~C~{\mathit{tblctx}} \vdash {\mathit{id}} : {C'}~{\tau}_s
} \, {[\textsc{\scriptsize Table\_type\_decl\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{control}
 \\
{|{\mathrm{keys}}_{{\mathit{of}}_{\mathit{table}}}({\mathit{tbl}})|} \leq 1
 \qquad
{|{\mathrm{actions}}_{{\mathit{of}}_{\mathit{table}}}({\mathit{tbl}})|} = 1
 \\
C_1 = C_0{.}\mathsf{local} .. \mathsf{kind} = \mathsf{tableapplymethod}
 \qquad
\mathsf{local}~C_1~{\mathrm{empty}}_{\mathit{tblctx}} \vdash {\mathit{tbl}} : {\mathit{tblctx}'}~{\mathit{tblIL}}
 \\
\mathsf{block}~C_1~{\mathit{tblctx}'} \vdash {\mathit{id}} : C_2~{\tau}_{\mathit{tbl}}
 \qquad
\tau = {\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{block}, C_2) \vdash \tau
 \\
C_3 = C_2 {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{\mathit{id}}}{\mapsto}{\tau~\mathsf{no}~\mathsf{dyn}~\epsilon}{\}}
\end{array}
}{
\mathsf{block}~C_0 \vdash {\mathsf{table}~{\mathit{id}}~\{}{{\mathit{tbl}}}{\}} : C_3~({\mathsf{table}~{\mathit{id}}~\{}{{\mathit{tblIL}}}{\}}~/*~\tau~*/)
} \, {[\textsc{\scriptsize Decl\_ok{-}tabled}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{C'} = C {.} {\mathsf{block}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
{C''} = C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{control}
 \\
(\mathsf{local}~{C'} \vdash {\mathit{param}} : {\mathit{paramIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_p}^\ast}^\ast}
 \\
{\delta_\texttt{typ}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \qquad
{C'''} = C {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{typ}}}{\}}
\end{array}
}{
\mathsf{global}~C \vdash {\mathsf{control}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{param}}^\ast})}{} : {C'''}~({\mathsf{control}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{(\epsilon)}{})
} \, {[\textsc{\scriptsize Decl\_ok{-}controltyped}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{cid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{cparam}}^\ast})
 \\
C_1 = C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{control}
 \\
(\mathsf{local}~C_1 \vdash {\mathit{cparam}} : {\mathit{cparamIL}})^\ast
 \qquad
(({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?} = {\mathit{cparamIL}}))^\ast
 \\
C_2 = C_1 {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_c^\ast}}{\mapsto^{*}}{{({\tau}_c~{\mathit{dir}}_c~\mathsf{ctk}~\epsilon)^\ast}}{\}}
 \\
(\mathsf{local}~C_2 \vdash {\mathit{param}} : {\mathit{paramIL}})^\ast
 \qquad
(({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\mathit{paramIL}}))^\ast
 \\
{\delta_\texttt{func}}_{\mathit{apply}} = {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~({\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_0) \vdash {\delta_\texttt{func}}_{\mathit{apply}}
 \\
C_3 = C_2 {.} {\mathsf{block}{.}\mathsf{frame}}{(\mathsf{s})}{\{}{{{\mathit{id}}_p^\ast}}{\mapsto^{*}}{{({\tau}_p~{\mathit{dir}}_p~\mathsf{dyn}~\epsilon)^\ast}}{\}}
 \\
\mathsf{block}~C_3 \vdash {{\mathit{decl}}^\ast} : C_4~{{\mathit{declIL}}^\ast}
 \\
C_5 = C_4{.}\mathsf{local} .. \mathsf{kind} = \mathsf{controlapplymethod}
 \\
\mathsf{local}~C_5~\mathsf{cont}~\mathsf{init} \vdash {\mathit{block}} : C_6~f~{\mathit{blockIL}}
 \\
{\delta_\texttt{polytyp}} = \mathsf{polyd}~(\epsilon, \epsilon) \rightarrow ({\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast}))
 \qquad
\tau = {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{\epsilon}{\rangle}
 \qquad
\delta_\texttt{cons} = \mathsf{consd}~(\epsilon, \epsilon) \rightarrow ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?})^\ast}) \rightarrow \tau)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_0) \vdash \delta_\texttt{cons}
 \\
C_7 = C_0 {.} {\mathsf{global}{.}\mathsf{cdenv}}{\{}{{\mathit{cid}}}{\mapsto}{\delta_\texttt{cons}}{\}}
\end{array}
}{
\mathsf{global}~C_0 \vdash {{{\mathsf{control}~{\mathit{id}}}{({{\mathit{param}}^\ast})}{({{\mathit{cparam}}^\ast})}{}~\{}{{{\mathit{decl}}^\ast}}~\mathsf{apply}~{\mathit{block}}}{\}} : C_7~({{{\mathsf{control}~{\mathit{id}}}{({{\mathit{paramIL}}^\ast})}{({{\mathit{cparamIL}}^\ast})}{}~\{}{{{\mathit{declIL}}^\ast}}~\mathsf{apply}~{\mathit{blockIL}}}{\}})
} \, {[\textsc{\scriptsize Decl\_ok{-}controld}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{cid}} = {\mathrm{to}}_{\mathit{fid}}({\mathit{id}}, {{\mathit{cparam}}^\ast})
 \\
C_1 = C_0 {.} {\mathsf{block}{.}\mathsf{tdenv}}{\{}{{{\mathit{tparam}}^\ast}}{\mapsto^{*}}{{(\mathsf{monod}~({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}}))^\ast}}{\}}
 \\
C_2 = C_1{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{package}
 \\
(\mathsf{block}~C_2 \vdash {\mathit{cparam}} : {\mathit{cparamIL}}~{{\mathit{tid}}_{{\mathit{fresh}}_c}^\ast})^\ast
 \qquad
(({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?} = {\mathit{cparamIL}}))^\ast
 \qquad
{{\mathit{tparam}}_{\mathit{hidden}}^\ast} = {\bigoplus}\, {{{\mathit{tid}}_{{\mathit{fresh}}_c}^\ast}^\ast}
 \\
{\delta_\texttt{polytyp}} = \mathsf{polyd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_c^\ast})
 \qquad
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_0) \vdash {\delta_\texttt{polytyp}}
 \\
{{\mathit{tparam}'}^\ast} = {{\mathit{tparam}}^\ast}~{{\mathit{tparam}}_{\mathit{hidden}}^\ast}
 \qquad
\tau = {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}}{\langle}{{({\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tparam}'})^\ast}}{\rangle}
 \qquad
{\delta_\texttt{cons}} = \mathsf{consd}~({{\mathit{tparam}}^\ast}, {{\mathit{tparam}}_{\mathit{hidden}}^\ast}) \rightarrow ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({({\mathit{id}}_c~{\mathit{dir}}_c~{\tau}_c~{{\mathit{val}}_c^?})^\ast}) \rightarrow \tau)
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_1) \vdash {\delta_\texttt{cons}}
 \\
C_3 = C_0 {.} {\mathsf{global}{.}\mathsf{tdenv}}{\{}{{\mathit{id}}}{\mapsto}{{\delta_\texttt{polytyp}}}{\}}
 \\
C_4 = C_3 {.} {\mathsf{global}{.}\mathsf{cdenv}}{\{}{{\mathit{cid}}}{\mapsto}{{\delta_\texttt{cons}}}{\}}
\end{array}
}{
\mathsf{global}~C_0 \vdash {\mathsf{package}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}{\rangle}{({{\mathit{cparam}}^\ast})}{} : {C''''}~({\mathsf{package}~{\mathit{id}}}{\langle}{{{\mathit{tparam}}^\ast}}, {{{\mathit{tparam}}_{\mathit{hidden}}^\ast}}{\rangle}{({{\mathit{cparamIL}}^\ast})}{})
} \, {[\textsc{\scriptsize Decl\_ok{-}packagetyped}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
}{
p~C \vdash \epsilon : C~\epsilon
} \, {[\textsc{\scriptsize Decls\_ok{-}nil}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C \vdash {\mathit{decl}}_h : {C'}~{\mathit{declIL}}_h
 \qquad
p~{C'} \vdash {{\mathit{decl}}_t^\ast} : {C''}~{{\mathit{declIL}}_t^\ast}
}{
p~C \vdash {\mathit{decl}}_h~{{\mathit{decl}}_t^\ast} : {C''}~({\mathit{declIL}}_h~{{\mathit{declIL}}_t^\ast})
} \, {[\textsc{\scriptsize Decls\_ok{-}cons}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, {\tau}_a)~{\mathit{to}}~{\tau}_p
}{
p~C~{\mathit{actctxt}} \vdash ({\mathit{id}}~\mathsf{in}~{\tau}_p~{{\mathit{val}}^?}) \approx ({\mathit{exprIL}}, {\tau}_a) : {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Call\_convention\_ok{-}in}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{dir}} = \mathsf{out} \lor {\mathit{dir}} = \mathsf{inout}
 \qquad
{\tau}_a \approx {\tau}_p
 \qquad
p~C \vdash {\mathit{exprIL}}
}{
p~C~{\mathit{actctxt}} \vdash ({\mathit{id}}~{\mathit{dir}}~{\tau}_p~{{\mathit{val}}^?}) \approx ({\mathit{exprIL}}, {\tau}_a) : {\mathit{exprIL}}
} \, {[\textsc{\scriptsize Call\_convention\_ok{-}out{-}inout}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{exprIL}'} = \mathsf{coerce}~({\mathit{exprIL}}, {\tau}_a)~{\mathit{to}}~{\tau}_p
}{
p~C~\mathsf{act} \vdash ({\mathit{id}}~\mathsf{no}~{\tau}_p~{{\mathit{val}}^?}) \approx ({\mathit{exprIL}}, {\tau}_a) : {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Call\_convention\_ok{-}no{-}action}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau'} \approx \tau
 \qquad
p~C \vdash {\mathit{expr}} : {\mathit{exprIL}}~{\tau''}~{\mathit{ctk}}
 \qquad
{\mathit{ctk}} = \mathsf{ctk} \lor {\mathit{ctk}} = \mathsf{lctk}
}{
p~C~\mathsf{noact} \vdash ({\mathit{id}}~\mathsf{no}~\tau~{{\mathit{val}}^?}) \approx ({\mathit{exprIL}}, {\tau'}) : {\mathit{exprIL}}
} \, {[\textsc{\scriptsize Call\_convention\_ok{-}no{-}not{-}action}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{actctxt}} \vdash {\tau_\texttt{param}} \approx ({\mathit{exprIL}}, \tau) : {\mathit{exprIL}'}
}{
p~C~{\mathit{actctxt}} \vdash {\tau_\texttt{param}} \approx ({\mathit{exprIL}}, \tau) : {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Call\_convention\_arg\_ok{-}expra}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
p~C~{\mathit{actctxt}} \vdash {\tau_\texttt{param}} \approx ({\mathit{exprIL}}, \tau) : {\mathit{exprIL}'}
}{
p~C~{\mathit{actctxt}} \vdash {\tau_\texttt{param}} \approx ({\mathit{id}} = {\mathit{exprIL}}, \tau) : {\mathit{id}} = {\mathit{exprIL}'}
} \, {[\textsc{\scriptsize Call\_convention\_arg\_ok{-}some{-}namea}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\mathit{argIL}} = ({\mathit{id}'} = \epsilon) \lor {\mathit{argIL}} = \mathsf{\_}
}{
p~C~{\mathit{actctxt}} \vdash ({\mathit{id}}~\mathsf{out}~\tau~{{\mathit{val}}^?}) \approx ({\mathit{argIL}}, \tau) : {\mathit{argIL}}
} \, {[\textsc{\scriptsize Call\_convention\_arg\_ok{-}none{-}namea{-}anya}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\mathit{fid}}, \delta_\texttt{func}, {{\mathit{id}}_{\mathit{deft}}^\ast}) = {C}{@}{\mathsf{global}{.}\mathsf{fdenv}}~{}[ {{\mathit{name}}}{({{\mathit{argIL}}^\ast})}{} ]
 \qquad
(\tau_\texttt{f}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) = {\delta_\texttt{func}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}
}{
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
} \, {[\textsc{\scriptsize FuncType\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \\
{\mathit{member}}~\in~{\{~\mbox{\texttt{`minSizeInBits'}}}{\}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{\mathit{member}}~\epsilon~\epsilon : ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~(\epsilon) \rightarrow {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}})~{\mathit{exprIL}}_b~\epsilon~\epsilon~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}builtin{-}size}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{member}} = \mbox{\texttt{`push\_front'}} \lor {\mathit{member}} = \mbox{\texttt{`pop\_back'}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_{b_{\mathit{in}}}}{{}[ {\mathit{size}}_b ]} = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
\tau_\texttt{param} = \mbox{\texttt{`count'}}~\mathsf{no}~{\mathsf{int}}{\mathsf{\_}}{\mathsf{t}}~\epsilon
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{\mathit{member}}~\epsilon~{{\mathit{argIL}}^\ast} : ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~(\tau_\texttt{param}) \rightarrow {\mathsf{int}}{\mathsf{\_}}{\mathsf{t}})~{\mathit{exprIL}}_b~\epsilon~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}builtin{-}stackt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}, {\tau}_{b_{\mathit{in}}})^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~\mbox{\texttt{`isValid'}}~\epsilon~{{\mathit{argIL}}^\ast} : ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~(\epsilon) \rightarrow {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}})~{\mathit{exprIL}}_b~\epsilon~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}builtin{-}headert{-}isvalid}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathit{member}} = \mbox{\texttt{`setValid'}} \lor {\mathit{member}} = \mbox{\texttt{`setInvalid'}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}, {\tau}_{b_{\mathit{in}}})^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{\mathit{member}}~\epsilon~{{\mathit{argIL}}^\ast} : ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~(\epsilon) \rightarrow {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}})~{\mathit{exprIL}}_b~\epsilon~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}builtin{-}headert{-}setvalid{-}invalid}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~\{}{{({\mathit{member}}, {\tau}_{b_{\mathit{in}}})^\ast}}{\}} = {{\tau}_b}{|_{\mathtt{canon}}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~\mbox{\texttt{`isValid'}}~\epsilon~{{\mathit{argIL}}^\ast} : ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~(\epsilon) \rightarrow {\mathsf{bool}}{\mathsf{\_}}{\mathsf{t}})~{\mathit{exprIL}}_b~\epsilon~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}builtin{-}uniont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_b~{\mathit{fmap}}_b = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
({\mathit{fid}}, \delta_\texttt{func}, {{\mathit{id}}_{\mathit{deft}}^\ast}) = {\mathit{fmap}}_b~{}[ {{\mathit{member}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ]
 \qquad
(\tau_\texttt{f}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) = {\delta_\texttt{func}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~{\mathit{member}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{f}~{\mathit{exprIL}}_b~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
} \, {[\textsc{\scriptsize MethodType\_ok{-}externt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
\tau_\texttt{f} = {\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
 \qquad
\delta_\texttt{func} = {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~\tau_\texttt{f}
 \\
({\mathit{fid}}, {\delta_\texttt{func}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) = {\{}{{(\mbox{\texttt{`apply'}}~\mapsto~\delta_\texttt{func})^{1}}}{\}}~{}[ {\mbox{\texttt{`apply'}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ]
 \qquad
{\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}'} = {\delta_\texttt{func}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~\mbox{\texttt{`apply'}}~\epsilon~{{\mathit{argIL}}^\ast} : {\tau_\texttt{f}'}~{\mathit{exprIL}}_b~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}parsert}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast}) = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
\tau_\texttt{f} = {\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({\tau_\texttt{param}^\ast})
 \qquad
\delta_\texttt{func} = {\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~\tau_\texttt{f}
 \\
({\mathit{fid}}, {\delta_\texttt{func}}, {{\mathit{id}}_{\mathit{deft}}^\ast}) = {\{}{{(\mbox{\texttt{`apply'}}~\mapsto~\delta_\texttt{func})^{1}}}{\}}~{}[ {\mbox{\texttt{`apply'}}}{({\mathrm{to}}_{\mathit{fkey}}({{\mathit{argIL}}^\ast}))}{} ]
 \qquad
{\mathsf{mono}}{\mathsf{\_}}{\mathsf{fd}}~{\tau_\texttt{f}'} = {\delta_\texttt{func}}
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~\mbox{\texttt{`apply'}}~\epsilon~{{\mathit{argIL}}^\ast} : {\tau_\texttt{f}'}~{\mathit{exprIL}}_b~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}controlt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
 \\
p~C \vdash {\mathit{expr}}_b : {\mathit{exprIL}}_b~{\tau}_b~{\mathit{ctk}}_b
 \qquad
{\mathsf{table}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}} = {{\tau}_b}{|_{\mathtt{canon}}}
 \\
\tau_\texttt{f} = {\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_t
\end{array}
}{
p~C \vdash {\mathit{expr}}_b~\mbox{\texttt{`apply'}}~\epsilon~\epsilon : \tau_\texttt{f}~{\mathit{exprIL}}_b~\epsilon
} \, {[\textsc{\scriptsize MethodType\_ok{-}tablet}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{filter\_default\_args}~(}{\epsilon}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)} & = & \epsilon \\
{\mathsf{filter\_default\_args}~(}{{\tau_\texttt{param}}_h~{{\tau_\texttt{param}}_t^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)} & = & {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}_t^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?} = {\tau_\texttt{param}}_h \\
{\land}~ {\mathit{id}}_p \in {{\mathit{id}}_{\mathit{deft}}^\ast} \\
\end{array} \\
{\mathsf{filter\_default\_args}~(}{{\tau_\texttt{param}}_h~{{\tau_\texttt{param}}_t^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)} & = & {\tau_\texttt{param}}_h~{\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}_t^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)} & \quad \mbox{otherwise} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lrrl@{}l@{}}
& {\mathit{pmap}} & ::= & {{\{(}{{\mathit{id}}}~\mapsto~\tau_\texttt{param}}{)^*\}} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{align\_params\_with\_args}~(}{{\tau_\texttt{param}^\ast}}{, }{{({\mathit{argIL}}, \tau)^\ast}}{)} & = & ({{\tau_\texttt{param}'}^\ast}, {({\mathit{argIL}'}, {\tau'})^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}~{\mathit{dir}}~\tau~{{\mathit{val}}^?})^\ast} = {\tau_\texttt{param}^\ast} \\
{\land}~ {\mathit{pmap}} = {\{}{{({\mathit{id}}~\mapsto~\tau_\texttt{param})^\ast}}{\}} \\
{\land}~ (({\tau_\texttt{param}'}, ({\mathit{argIL}'}, {\tau'})) = {\mathsf{align\_params\_with\_args'}~(}{{\mathit{pmap}}}{, }{\tau_\texttt{param}}{, }{({\mathit{argIL}}, \tau)}{)})^\ast \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
{\mathsf{align\_params\_with\_args'}~(}{{\mathit{pmap}}}{, }{\tau_\texttt{param}}{, }{({\mathit{exprIL}}, \tau)}{)} & = & (\tau_\texttt{param}, ({\mathit{exprIL}}, \tau)) \\
{\mathsf{align\_params\_with\_args'}~(}{{\mathit{pmap}}}{, }{\tau_\texttt{param}}{, }{({\mathit{id}} = {{\mathit{exprIL}}^?}, \tau)}{)} & = & ({\tau_\texttt{param}'}, ({\mathit{id}} = {{\mathit{exprIL}}^?}, \tau)) & \quad \mbox{if}~ {\tau_\texttt{param}'} = {{\mathit{pmap}}}{{}[ {\mathit{id}} ]} \\
{\mathsf{align\_params\_with\_args'}~(}{{\mathit{pmap}}}{, }{\tau_\texttt{param}}{, }{(\mathsf{\_}, \tau)}{)} & = & (\tau_\texttt{param}, (\mathsf{\_}, \tau)) \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{empty\_cstr}~(\epsilon) & = & {\{}{\epsilon}{\}} \\
\mathsf{empty\_cstr}~({\mathit{tid}}_h~{{\mathit{tid}}_t^\ast}) & = & {\mathit{cstr}'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{cstr}} = \mathsf{empty\_cstr}~({{\mathit{tid}}_t^\ast}) \\
{\land}~ {\mathit{cstr}'} = {{\mathit{cstr}}}{\{}~{\mathit{tid}}_h~\mapsto~\epsilon~\} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{gen\_cstr\_fd}~({\mathit{cstr}}, {\delta_\texttt{func}}_p, {\delta_\texttt{func}}_a) & = & {\mathit{cstr}''} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {({\mathit{id}}_p~{\mathit{dir}}_p~{\tau}_p~{{\mathit{val}}_p^?})^\ast} = \mathsf{get\_params\_funcdef}~({\delta_\texttt{func}}_p) \\
{\land}~ {({\mathit{id}}_a~{\mathit{dir}}_a~{\tau}_a~{{\mathit{val}}_a^?})^\ast} = \mathsf{get\_params\_funcdef}~({\delta_\texttt{func}}_a) \\
{\land}~ {\mathit{cstr}'} = \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_p^\ast}, {{\tau}_a^\ast}) \\
{\land}~ {\mathit{cstr}''} = \mathsf{gen\_cstr}~({\mathit{cstr}'}, \mathsf{get\_typ\_ret\_funcdef}~({\delta_\texttt{func}}_p), \mathsf{get\_typ\_ret\_funcdef}~({\delta_\texttt{func}}_a)) \\
\end{array} \\
\end{array}
$$

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{gen\_cstr\_fd'}~({\mathit{cstr}}, \epsilon, {\Delta_\texttt{f}}_p, {\Delta_\texttt{f}}_a) & = & {\mathit{cstr}} \\
\mathsf{gen\_cstr\_fd'}~({\mathit{cstr}}, {\mathit{fid}}_h~{{\mathit{fid}}_t^\ast}, {\Delta_\texttt{f}}_p, {\Delta_\texttt{f}}_a) & = & \mathsf{gen\_cstr\_fd'}~({\mathit{cstr}'}, {{\mathit{fid}}_t^\ast}, {\Delta_\texttt{f}}_p, {\Delta_\texttt{f}}_a) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\delta_\texttt{func}}_p = {{\Delta_\texttt{f}}_p}{{}[ {\mathit{fid}}_h ]} \\
{\land}~ {\delta_\texttt{func}}_a = {{\Delta_\texttt{f}}_a}{{}[ {\mathit{fid}}_h ]} \\
{\land}~ {\mathit{cstr}'} = \mathsf{gen\_cstr\_fd}~({\mathit{cstr}}, {\delta_\texttt{func}}_p, {\delta_\texttt{func}}_a) \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{var}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{tid}}, {\tau}_a) & = & {{\mathit{cstr}}}{\{}~{\mathit{tid}}~\mapsto~{\tau}_a~\} & \quad \mbox{if}~ {\mathit{tid}}~\in~{\texttt{Dom}(}{{\mathit{cstr}}}{)} \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_p}{\langle}{{{\tau}_{p'}^\ast}}{\rangle}, {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_{a'}^\ast}}{\rangle}) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}'}, {{\tau}_{p'}^\ast}, {{\tau}_{a'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\tau}_{p''} = {{\delta_\texttt{polytyp}}_p}{\langle}{{{\tau}_{p'}^\ast}}{\rangle} \\
{\land}~ {\tau}_{a''} = {{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_{a'}^\ast}}{\rangle} \\
{\land}~ {\mathit{cstr}'} = \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_{p''}, {\tau}_{a''}) \\
{\land}~ {\tau}_{p''}~{\mathrm{nominal}} \land {\tau}_{a''}~{\mathrm{nominal}} \\
\end{array} \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_p}{\langle}{{{\tau}_{p'}^\ast}}{\rangle}, {{\mathsf{spec}}{\mathsf{\_}}{\mathsf{t}}~{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_{a'}^\ast}}{\rangle}) & = & {\mathit{cstr}'} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\tau}_{p''} = {{\delta_\texttt{polytyp}}_p}{\langle}{{{\tau}_{p'}^\ast}}{\rangle} \\
{\land}~ {\tau}_{a''} = {{\delta_\texttt{polytyp}}_a}{\langle}{{{\tau}_{a'}^\ast}}{\rangle} \\
{\land}~ {\mathit{cstr}'} = \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_{p''}, {\tau}_{a''}) \\
{\land}~ {\neg({\tau}_{p''}~{\mathrm{nominal}} \land {\tau}_{a''}~{\mathrm{nominal}})} \\
\end{array} \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_{p'}, {\tau}_a) & = & \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_{p'}, {\tau}_a) \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_p, {\mathsf{def}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_{a'}) & = & \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_p, {\tau}_{a'}) \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_p~{\tau}_{p'}, {\mathsf{new}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~{\tau}_{a'}) & = & \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_{p'}, {\tau}_{a'}) & \quad \mbox{if}~ {\mathit{id}}_p = {\mathit{id}}_a \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_p, {\mathsf{list}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_a) & = & \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_p, {\tau}_a) \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_p^\ast}, {\mathsf{tuple}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_a^\ast}) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_p^\ast}, {{\tau}_a^\ast}) \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_{p'}}{{}[ {\mathit{size}}_p ]}, {{\mathsf{stack}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_{a'}}{{}[ {\mathit{size}}_a ]}) & = & \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_{p'}, {\tau}_{a'}) & \quad \mbox{if}~ {\mathit{size}}_p = {\mathit{size}}_a \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_p~\{}{{({\mathit{member}}_p, {\tau}_{p'})^\ast}}{\}}, {{\mathsf{struct}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_{a'})^\ast}}{\}}) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_{p'}^\ast}, {{\tau}_{a'}^\ast}) & \quad \mbox{if}~ {\mathit{id}}_p = {\mathit{id}}_a \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_p~\{}{{({\mathit{member}}_p, {\tau}_{p'})^\ast}}{\}}, {{\mathsf{header}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_{a'})^\ast}}{\}}) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_{p'}^\ast}, {{\tau}_{a'}^\ast}) & \quad \mbox{if}~ {\mathit{id}}_p = {\mathit{id}}_a \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_p~\{}{{({\mathit{member}}_p, {\tau}_{p'})^\ast}}{\}}, {{\mathsf{union}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~\{}{{({\mathit{member}}_a, {\tau}_{a'})^\ast}}{\}}) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_{p'}^\ast}, {{\tau}_{a'}^\ast}) & \quad \mbox{if}~ {\mathit{id}}_p = {\mathit{id}}_a \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_p~{\Delta_\texttt{f}}_p, {\mathsf{extern}}{\mathsf{\_}}{\mathsf{t}}~{\mathit{id}}_a~{\Delta_\texttt{f}}_a) & = & \mathsf{gen\_cstr\_fd'}~({\mathit{cstr}}, {{\mathit{fid}}_p^\ast}, {\Delta_\texttt{f}}_p, {\Delta_\texttt{f}}_a) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\{}{{({\mathit{fid}}_p~\mapsto~{\delta_\texttt{func}}_p)^\ast}}{\}} = {\Delta_\texttt{f}}_p \\
{\land}~ {\{}{{({\mathit{fid}}_a~\mapsto~{\delta_\texttt{func}}_a)^\ast}}{\}} = {\Delta_\texttt{f}}_a \\
{\land}~ {\mathit{id}}_p = {\mathit{id}}_a \\
{\land}~ {\{~{{\mathit{fid}}_p^\ast}}{\}}~=~{\{~{{\mathit{fid}}_a^\ast}}{\}} \\
\end{array} \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_p^\ast}), {\mathsf{parser}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_{p'}^\ast}, {{\tau}_{a'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ (({\mathit{id}}_p~{\mathit{dir}}~{\tau}_{p'}~{{\mathit{val}}_p^?} = {\tau_\texttt{param}}_p))^\ast \\
{\land}~ (({\mathit{id}}_a~{\mathit{dir}}~{\tau}_{a'}~{{\mathit{val}}_a^?} = {\tau_\texttt{param}}_a))^\ast \\
\end{array} \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_p^\ast}), {\mathsf{control}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}_a^\ast})) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_{p'}^\ast}, {{\tau}_{a'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ (({\mathit{id}}_p~{\mathit{dir}}~{\tau}_{p'}~{{\mathit{val}}_p^?} = {\tau_\texttt{param}}_p))^\ast \\
{\land}~ (({\mathit{id}}_a~{\mathit{dir}}~{\tau}_{a'}~{{\mathit{val}}_a^?} = {\tau_\texttt{param}}_a))^\ast \\
\end{array} \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_p^\ast}, {\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_a^\ast}) & = & \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_p^\ast}, {{\tau}_a^\ast}) \\
\mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_p, {\tau}_a) & = & {\mathit{cstr}} & \quad \mbox{otherwise} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, \epsilon, {\mathit{cstr}}) & = & {\mathit{cstr}} \\
\mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {\mathit{tid}}_h~{{\mathit{tid}}_t^\ast}, {\mathit{cstr}}) & = & \mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {{\mathit{tid}}_t^\ast}, {\mathit{cstr}'}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{cstr}}_o}{{}[ {\mathit{tid}}_h ]} = \epsilon \\
{\land}~ {{\mathit{cstr}}_n}{{}[ {\mathit{tid}}_h ]} = {\tau}_n \\
{\land}~ {\mathit{cstr}'} = {{\mathit{cstr}}}{\{}~{\mathit{tid}}_h~\mapsto~{\tau}_n~\} \\
\end{array} \\
\mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {\mathit{tid}}_h~{{\mathit{tid}}_t^\ast}, {\mathit{cstr}}) & = & \mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {{\mathit{tid}}_t^\ast}, {\mathit{cstr}'}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{cstr}}_o}{{}[ {\mathit{tid}}_h ]} = {\tau}_o \\
{\land}~ {{\mathit{cstr}}_n}{{}[ {\mathit{tid}}_h ]} = \epsilon \\
{\land}~ {\mathit{cstr}'} = {{\mathit{cstr}}}{\{}~{\mathit{tid}}_h~\mapsto~{\tau}_o~\} \\
\end{array} \\
\mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {\mathit{tid}}_h~{{\mathit{tid}}_t^\ast}, {\mathit{cstr}}) & = & \mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {{\mathit{tid}}_t^\ast}, {\mathit{cstr}'}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{cstr}}_o}{{}[ {\mathit{tid}}_h ]} = {\tau}_o \\
{\land}~ {{\mathit{cstr}}_n}{{}[ {\mathit{tid}}_h ]} = {\tau}_n \\
{\land}~ {\tau}_o \prec {\tau}_n \\
{\land}~ {\mathit{cstr}'} = {{\mathit{cstr}}}{\{}~{\mathit{tid}}_h~\mapsto~{\tau}_n~\} \\
\end{array} \\
\mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {\mathit{tid}}_h~{{\mathit{tid}}_t^\ast}, {\mathit{cstr}}) & = & \mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {{\mathit{tid}}_t^\ast}, {\mathit{cstr}'}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {{\mathit{cstr}}_o}{{}[ {\mathit{tid}}_h ]} = {\tau}_o \\
{\land}~ {{\mathit{cstr}}_n}{{}[ {\mathit{tid}}_h ]} = {\tau}_n \\
{\land}~ {\tau}_n \prec {\tau}_o \\
{\land}~ {\mathit{cstr}'} = {{\mathit{cstr}}}{\{}~{\mathit{tid}}_h~\mapsto~{\tau}_o~\} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{merge\_cstr}~({\mathit{cstr}}_o, {\mathit{cstr}}_n) & = & \mathsf{merge\_cstr'}~({\mathit{cstr}}_o, {\mathit{cstr}}_n, {{\mathit{tid}}_o^\ast}, {\{}{\epsilon}{\}}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\{}{{({\mathit{tid}}_o~\mapsto~{{\tau}_o^?})^\ast}}{\}} = {\mathit{cstr}}_o \\
{\land}~ {\{}{{({\mathit{tid}}_n~\mapsto~{{\tau}_n^?})^\ast}}{\}} = {\mathit{cstr}}_n \\
{\land}~ {\{~{{\mathit{tid}}_o^\ast}}{\}}~=~{\{~{{\mathit{tid}}_n^\ast}}{\}} \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{merge\_cstrs}~({\{}{{({\mathit{tid}}~\mapsto~{\tau^?})^\ast}}{\}}, \epsilon) & = & {\{}{{({\mathit{tid}}~\mapsto~{\tau^?})^\ast}}{\}} \\
\mathsf{merge\_cstrs}~({\mathit{cstr}}, {\mathit{cstr}}_{h'}~{{\mathit{cstr}}_{t'}^\ast}) & = & {\mathit{cstr}'''} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{cstr}''} = \mathsf{merge\_cstr}~({\mathit{cstr}}, {\mathit{cstr}}_{h'}) \\
{\land}~ {\mathit{cstr}'''} = \mathsf{merge\_cstrs}~({\mathit{cstr}''}, {{\mathit{cstr}}_{t'}^\ast}) \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_p^\ast}, {{\tau}_a^\ast}) & = & \mathsf{merge\_cstrs}~({\mathit{cstr}}, {{\mathit{cstr}'}^\ast}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {|{{\tau}_p^\ast}|} = {|{{\tau}_a^\ast}|} \\
{\land}~ (({\mathit{cstr}'} = \mathsf{gen\_cstr}~({\mathit{cstr}}, {\tau}_p, {\tau}_a)))^\ast \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{resolve\_cstrs}~({\{}{\epsilon}{\}}) & = & {\{}{\epsilon}{\}} \\
\mathsf{resolve\_cstrs}~({\{}{{({\mathit{tid}}~\mapsto~{\tau^?})^{+}}}{\}}) & = & {{\{}{{({\mathit{tid}}_{t'}~\mapsto~{\tau}_{t'})^\ast}}{\}}}{\{}~{\mathit{tid}}_h~\mapsto~{\tau}_{h'}~\} & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{tid}}_h~{{\mathit{tid}}_t^\ast} = {{\mathit{tid}}^\ast} \\
{\land}~ {{\tau}_h^?}~{{{\tau}_t^?}^\ast} = {{\tau^?}^\ast} \\
{\land}~ {{\tau}_h^?} = {\tau}_{h'} \\
{\land}~ {\tau}_{h'} \neq {\mathsf{any}}{\mathsf{\_}}{\mathsf{t}} \\
{\land}~ {\{}{{({\mathit{tid}}_{t'}~\mapsto~{\tau}_{t'})^\ast}}{\}} = \mathsf{resolve\_cstrs}~({\{}{{({\mathit{tid}}_t~\mapsto~{{\tau}_t^?})^\ast}}{\}}) \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}[t]{@{}lcl@{}l@{}}
\mathsf{infer\_targs}~({{\mathit{tid}}^\ast}, {({\mathit{id}}~{\mathit{dir}}~{\tau}_p~{{\mathit{val}}^?})^\ast}, {{\tau}_a^\ast}) & = & \mathsf{resolve\_cstrs}~({\mathit{cstr}'}) & \quad
\begin{array}[t]{@{}l@{}}
\mbox{if}~ {\mathit{cstr}} = \mathsf{empty\_cstr}~({{\mathit{tid}}^\ast}) \\
{\land}~ {\mathit{cstr}'} = \mathsf{gen\_cstrs}~({\mathit{cstr}}, {{\tau}_p^\ast}, {{\tau}_a^\ast}) \\
\end{array} \\
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})
 \\
p~C \vdash {\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) : \mathsf{callsite\_ok}
 \qquad
(({\neg{\mathit{argIL}'}~\mathsf{contains}~\mathsf{table{.}apply}~\mathsf{call}}))^\ast
 \\
(p~C~\mathsf{act} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{action}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}))~\epsilon~\epsilon~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}~\epsilon~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}actiont}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r
 \\
p~C \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~\epsilon~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_r~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}extern{-}funct{-}no{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
\theta = \mathsf{infer\_targs}~({{\mathit{tid}}_{\mathit{fresh}}^\ast}, {{\tau_\texttt{param}''}^\ast}, {{\tau}_{a'}^\ast})
 \\
(({\mathit{targIL}'} = {\theta}{{}[ {\mathit{tid}}_{\mathit{fresh}} ]}))^\ast
 \qquad
{{\mathit{targIL}''}^\ast} = {{\mathit{targIL}}^\ast} \oplus {{\mathit{targIL}'}^\ast}
 \\
{\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} = {{\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r}{/}{\theta}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'}
 \\
p~C \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}'''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_{r'}~{{\mathit{targIL}''}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}extern{-}funct{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash ({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)
 \\
p~C \vdash {\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~\epsilon~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_r~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}funct{-}no{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
\theta = \mathsf{infer\_targs}~({{\mathit{tid}}_{\mathit{fresh}}^\ast}, {{\tau_\texttt{param}''}^\ast}, {{\tau}_{a'}^\ast})
 \\
(({\mathit{targIL}'} = {\theta}{{}[ {\mathit{tid}}_{\mathit{fresh}} ]}))^\ast
 \qquad
{{\mathit{targIL}''}^\ast} = {{\mathit{targIL}}^\ast} \oplus {{\mathit{targIL}'}^\ast}
 \\
{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} = {{\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r}{/}{\theta}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash ({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'})
 \\
p~C \vdash {\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}'''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{function}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_{r'}~{{\mathit{targIL}''}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}funct{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r
 \\
p~C \vdash {\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r : \mathsf{callsite\_ok}
 \qquad
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{builtin}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~\epsilon~\epsilon~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_r~\epsilon~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}builtin{-}methodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r
 \\
p~C \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~\epsilon~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_r~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}extern{-}methodt{-}no{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
\theta = \mathsf{infer\_targs}~({{\mathit{tid}}_{\mathit{fresh}}^\ast}, {{\tau_\texttt{param}''}^\ast}, {{\tau}_{a'}^\ast})
 \\
(({\mathit{targIL}'} = {\theta}{{}[ {\mathit{tid}}_{\mathit{fresh}} ]}))^\ast
 \qquad
{{\mathit{targIL}''}^\ast} = {{\mathit{targIL}}^\ast} \oplus {{\mathit{targIL}'}^\ast}
 \\
{\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} = {{\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r}{/}{\theta}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'}
 \\
p~C \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}'''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_{r'}~{{\mathit{targIL}''}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}extern{-}methodt{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r
 \\
p~C \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~\epsilon~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_r~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}extern{-}abstract{-}methodt{-}no{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
\theta = \mathsf{infer\_targs}~({{\mathit{tid}}_{\mathit{fresh}}^\ast}, {{\tau_\texttt{param}''}^\ast}, {{\tau}_{a'}^\ast})
 \\
(({\mathit{targIL}'} = {\theta}{{}[ {\mathit{tid}}_{\mathit{fresh}} ]}))^\ast
 \qquad
{{\mathit{targIL}''}^\ast} = {{\mathit{targIL}}^\ast} \oplus {{\mathit{targIL}'}^\ast}
 \\
{\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} = {{\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r}{/}{\theta}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'}
 \\
p~C \vdash {\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{r'} : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}'''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{extern}}{\mathsf{\_}}{\mathsf{abstract}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_r)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_{r'}~{{\mathit{targIL}''}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}extern{-}abstract{-}methodt{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash ({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}))
 \\
p~C \vdash {\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{parser}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}))~\epsilon~\epsilon~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}~\epsilon~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}parser{-}apply{-}methodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast})
 \\
p~C \vdash {\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) : \mathsf{callsite\_ok}
 \\
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{control}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}))~\epsilon~\epsilon~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\mathsf{void}}{\mathsf{\_}}{\mathsf{t}}~\epsilon~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Call\_ok{-}control{-}apply{-}methodt}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash {\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_r
 \\
p~C \vdash {\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_r : \mathsf{callsite\_ok}
\end{array}
}{
p~C \vdash ({\mathsf{table}}{\mathsf{\_}}{\mathsf{apply}}{\mathsf{\_}}{\mathsf{method}}{\mathsf{\_}}{\mathsf{t}}~{\tau}_r)~\epsilon~\epsilon~\epsilon : {\tau}_r~\epsilon~\epsilon
} \, {[\textsc{\scriptsize Call\_ok{-}table{-}apply{-}methodt}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
({\mathit{cid}}, \delta_\texttt{cons}, {{\mathit{id}}_{\mathit{deft}}^\ast}) = {C}{@}{\mathsf{global}{.}\mathsf{cdenv}}~{}[ {{\mathit{name}}}{({{\mathit{argIL}}^\ast})}{} ]
 \qquad
(\tau_\texttt{cons}, {{\mathit{tid}}_{\mathit{fresh}}^\ast}) = {\delta_\texttt{cons}}{\langle}{{{\mathit{targIL}}^\ast}}{\rangle}
}{
p~C \vdash {\mathit{name}}~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}}^\ast} : \tau_\texttt{cons}~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast}
} \, {[\textsc{\scriptsize ConsType\_ok}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
{\tau}_{i'} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
{\tau}_{i'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{package\_t}
}{
\mathsf{global}~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
} \, {[\textsc{\scriptsize Inst\_site\_ok{-}global}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\tau}_{i'} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{package}
 \\
{\tau}_{i'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{parser\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{control\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{package\_t}
\end{array}
}{
\mathsf{block}~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
} \, {[\textsc{\scriptsize Inst\_site\_ok{-}block{-}package}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\tau}_{i'} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{parser}
 \\
{\tau}_{i'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{parser\_t}
\end{array}
}{
\mathsf{block}~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
} \, {[\textsc{\scriptsize Inst\_site\_ok{-}block{-}parser}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\tau}_{i'} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{control}
 \\
{\tau}_{i'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{control\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{table\_t}
\end{array}
}{
\mathsf{block}~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
} \, {[\textsc{\scriptsize Inst\_site\_ok{-}block{-}control}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\tau}_{i'} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C{.}\mathsf{local}{.}\mathsf{kind} = \mathsf{parserstate}
 \\
{\tau}_{i'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{parser\_t}
\end{array}
}{
\mathsf{local}~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
} \, {[\textsc{\scriptsize Inst\_site\_ok{-}local{-}parserstate}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\tau}_{i'} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C{.}\mathsf{local}{.}\mathsf{kind} = \mathsf{controlapplymethod}
 \\
{\tau}_{i'}~\mathsf{is}~\mathsf{extern\_t} \lor {\tau}_{i'}~\mathsf{is}~\mathsf{control\_t}
\end{array}
}{
\mathsf{local}~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
} \, {[\textsc{\scriptsize Inst\_site\_ok{-}local{-}controlapplymethod}]}
\qquad
\end{array}
$$

\vspace{1ex}

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_{i'}^\ast} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C_1 = C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{package}
 \\
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_1) \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i)
 \\
\mathsf{block}~C_1 \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
 \qquad
(\mathsf{block}~C_1~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
\mathsf{global}~C_0 \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i)~\epsilon~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_i~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Inst\_ok{-}global{-}packaget{-}no{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{\mathsf{package}}{\mathsf{\_}}{\mathsf{t}}~{{\tau}_{i'}^\ast} = {{\tau}_i}{|_{\mathtt{canon}}}
 \qquad
C_1 = C_0{.}\mathsf{block}{.}\mathsf{kind} = \mathsf{package}
 \\
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
\theta = \mathsf{infer\_targs}~({{\mathit{tid}}_{\mathit{fresh}}^\ast}, {{\tau_\texttt{param}''}^\ast}, {{\tau}_{a'}^\ast})
 \\
(({\mathit{targIL}'} = {\theta}{{}[ {\mathit{tid}}_{\mathit{fresh}} ]}))^\ast
 \qquad
{{\mathit{targIL}''}^\ast} = {{\mathit{targIL}}^\ast} \oplus {{\mathit{targIL}'}^\ast}
 \\
{\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{i'} = {{\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i}{/}{\theta}
 \\
{\mathrm{bound}}_{\mathit{tid}}(\mathsf{global}, C_1) \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{i'})
 \\
\mathsf{block}~C_1 \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{i'}) : \mathsf{instsite\_ok}
 \qquad
(\mathsf{block}~C_1~\mathsf{noact} \vdash {\tau_\texttt{param}'''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
\mathsf{global}~C_0 \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_{i'}~{{\mathit{targIL}''}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Inst\_ok{-}global{-}packaget{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i)
 \\
p~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i) : \mathsf{instsite\_ok}
 \qquad
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i)~\epsilon~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_i~{{\mathit{targIL}}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Inst\_ok{-}else{-}no{-}targsinfer}]}
\qquad
\end{array}
$$

$$
\begin{array}{@{}c@{}}\displaystyle
\frac{
\begin{array}{@{}c@{}}
{{\tau_\texttt{param}'}^\ast} = {\mathsf{filter\_default\_args}~(}{{{\tau_\texttt{param}}^\ast}}{, }{{{\mathit{id}}_{\mathit{deft}}^\ast}}{)}
 \\
{|{{\tau_\texttt{param}'}^\ast}|} = {|{{\mathit{argIL}}^\ast}|}
 \qquad
({{\tau_\texttt{param}''}^\ast}, {({\mathit{argIL}'}, {\tau}_{a'})^\ast}) = {\mathsf{align\_params\_with\_args}~(}{{{\tau_\texttt{param}'}^\ast}}{, }{{({\mathit{argIL}}, {\tau}_a)^\ast}}{)}
 \\
\theta = \mathsf{infer\_targs}~({{\mathit{tid}}_{\mathit{fresh}}^\ast}, {{\tau_\texttt{param}''}^\ast}, {{\tau}_{a'}^\ast})
 \\
(({\mathit{targIL}'} = {\theta}{{}[ {\mathit{tid}}_{\mathit{fresh}} ]}))^\ast
 \qquad
{{\mathit{targIL}''}^\ast} = {{\mathit{targIL}}^\ast} \oplus {{\mathit{targIL}'}^\ast}
 \\
{\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{i'} = {{\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i}{/}{\theta}
 \\
{\mathrm{bound}}_{\mathit{tid}}(p, C) \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{i'})
 \\
p~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}'''}^\ast}) \rightarrow {\tau}_{i'}) : \mathsf{instsite\_ok}
 \qquad
(p~C~\mathsf{noact} \vdash {\tau_\texttt{param}'''} \approx ({\mathit{argIL}'}, {\tau}_{a'}) : {\mathit{argIL}''})^\ast
\end{array}
}{
p~C \vdash ({\mathsf{cons}}{\mathsf{\_}}{\mathsf{t}}~({{\tau_\texttt{param}}^\ast}) \rightarrow {\tau}_i)~{{\mathit{tid}}_{\mathit{fresh}}^\ast}~{{\mathit{targIL}}^\ast}~{({\mathit{argIL}}, {\tau}_a)^\ast}~{{\mathit{id}}_{\mathit{deft}}^\ast} : {\tau}_{i'}~{{\mathit{targIL}''}^\ast}~{{\mathit{argIL}''}^\ast}
} \, {[\textsc{\scriptsize Inst\_ok{-}else{-}targsinfer}]}
\qquad
\end{array}
$$


